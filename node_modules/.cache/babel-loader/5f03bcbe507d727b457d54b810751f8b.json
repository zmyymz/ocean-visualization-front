{"ast":null,"code":"import \"core-js/modules/es.error.cause.js\";\n\nvar __extends = this && this.__extends || function () {\n  var _extendStatics = function extendStatics(d, b) {\n    _extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) {\n        if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p];\n      }\n    };\n\n    return _extendStatics(d, b);\n  };\n\n  return function (d, b) {\n    if (typeof b !== \"function\" && b !== null) throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\n\n    _extendStatics(d, b);\n\n    function __() {\n      this.constructor = d;\n    }\n\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\n/**\n * @module ol/render/canvas/ImageBuilder\n */\n\n\nimport CanvasBuilder from './Builder.js';\nimport CanvasInstruction from './Instruction.js';\n\nvar CanvasImageBuilder =\n/** @class */\nfunction (_super) {\n  __extends(CanvasImageBuilder, _super);\n  /**\n   * @param {number} tolerance Tolerance.\n   * @param {import(\"../../extent.js\").Extent} maxExtent Maximum extent.\n   * @param {number} resolution Resolution.\n   * @param {number} pixelRatio Pixel ratio.\n   */\n\n\n  function CanvasImageBuilder(tolerance, maxExtent, resolution, pixelRatio) {\n    var _this = _super.call(this, tolerance, maxExtent, resolution, pixelRatio) || this;\n    /**\n     * @private\n     * @type {HTMLCanvasElement|HTMLVideoElement|HTMLImageElement}\n     */\n\n\n    _this.hitDetectionImage_ = null;\n    /**\n     * @private\n     * @type {HTMLCanvasElement|HTMLVideoElement|HTMLImageElement}\n     */\n\n    _this.image_ = null;\n    /**\n     * @private\n     * @type {number|undefined}\n     */\n\n    _this.imagePixelRatio_ = undefined;\n    /**\n     * @private\n     * @type {number|undefined}\n     */\n\n    _this.anchorX_ = undefined;\n    /**\n     * @private\n     * @type {number|undefined}\n     */\n\n    _this.anchorY_ = undefined;\n    /**\n     * @private\n     * @type {number|undefined}\n     */\n\n    _this.height_ = undefined;\n    /**\n     * @private\n     * @type {number|undefined}\n     */\n\n    _this.opacity_ = undefined;\n    /**\n     * @private\n     * @type {number|undefined}\n     */\n\n    _this.originX_ = undefined;\n    /**\n     * @private\n     * @type {number|undefined}\n     */\n\n    _this.originY_ = undefined;\n    /**\n     * @private\n     * @type {boolean|undefined}\n     */\n\n    _this.rotateWithView_ = undefined;\n    /**\n     * @private\n     * @type {number|undefined}\n     */\n\n    _this.rotation_ = undefined;\n    /**\n     * @private\n     * @type {import(\"../../size.js\").Size|undefined}\n     */\n\n    _this.scale_ = undefined;\n    /**\n     * @private\n     * @type {number|undefined}\n     */\n\n    _this.width_ = undefined;\n    /**\n     * Data shared with a text builder for combined decluttering.\n     * @private\n     * @type {import(\"../canvas.js\").DeclutterImageWithText}\n     */\n\n    _this.declutterImageWithText_ = undefined;\n    return _this;\n  }\n  /**\n   * @param {import(\"../../geom/Point.js\").default|import(\"../Feature.js\").default} pointGeometry Point geometry.\n   * @param {import(\"../../Feature.js\").FeatureLike} feature Feature.\n   */\n\n\n  CanvasImageBuilder.prototype.drawPoint = function (pointGeometry, feature) {\n    if (!this.image_) {\n      return;\n    }\n\n    this.beginGeometry(pointGeometry, feature);\n    var flatCoordinates = pointGeometry.getFlatCoordinates();\n    var stride = pointGeometry.getStride();\n    var myBegin = this.coordinates.length;\n    var myEnd = this.appendFlatPointCoordinates(flatCoordinates, stride);\n    this.instructions.push([CanvasInstruction.DRAW_IMAGE, myBegin, myEnd, this.image_, // Remaining arguments to DRAW_IMAGE are in alphabetical order\n    this.anchorX_ * this.imagePixelRatio_, this.anchorY_ * this.imagePixelRatio_, Math.ceil(this.height_ * this.imagePixelRatio_), this.opacity_, this.originX_, this.originY_, this.rotateWithView_, this.rotation_, [this.scale_[0] * this.pixelRatio / this.imagePixelRatio_, this.scale_[1] * this.pixelRatio / this.imagePixelRatio_], Math.ceil(this.width_ * this.imagePixelRatio_), this.declutterImageWithText_]);\n    this.hitDetectionInstructions.push([CanvasInstruction.DRAW_IMAGE, myBegin, myEnd, this.hitDetectionImage_, // Remaining arguments to DRAW_IMAGE are in alphabetical order\n    this.anchorX_, this.anchorY_, this.height_, this.opacity_, this.originX_, this.originY_, this.rotateWithView_, this.rotation_, this.scale_, this.width_, this.declutterImageWithText_]);\n    this.endGeometry(feature);\n  };\n  /**\n   * @param {import(\"../../geom/MultiPoint.js\").default|import(\"../Feature.js\").default} multiPointGeometry MultiPoint geometry.\n   * @param {import(\"../../Feature.js\").FeatureLike} feature Feature.\n   */\n\n\n  CanvasImageBuilder.prototype.drawMultiPoint = function (multiPointGeometry, feature) {\n    if (!this.image_) {\n      return;\n    }\n\n    this.beginGeometry(multiPointGeometry, feature);\n    var flatCoordinates = multiPointGeometry.getFlatCoordinates();\n    var stride = multiPointGeometry.getStride();\n    var myBegin = this.coordinates.length;\n    var myEnd = this.appendFlatPointCoordinates(flatCoordinates, stride);\n    this.instructions.push([CanvasInstruction.DRAW_IMAGE, myBegin, myEnd, this.image_, // Remaining arguments to DRAW_IMAGE are in alphabetical order\n    this.anchorX_ * this.imagePixelRatio_, this.anchorY_ * this.imagePixelRatio_, Math.ceil(this.height_ * this.imagePixelRatio_), this.opacity_, this.originX_, this.originY_, this.rotateWithView_, this.rotation_, [this.scale_[0] * this.pixelRatio / this.imagePixelRatio_, this.scale_[1] * this.pixelRatio / this.imagePixelRatio_], Math.ceil(this.width_ * this.imagePixelRatio_), this.declutterImageWithText_]);\n    this.hitDetectionInstructions.push([CanvasInstruction.DRAW_IMAGE, myBegin, myEnd, this.hitDetectionImage_, // Remaining arguments to DRAW_IMAGE are in alphabetical order\n    this.anchorX_, this.anchorY_, this.height_, this.opacity_, this.originX_, this.originY_, this.rotateWithView_, this.rotation_, this.scale_, this.width_, this.declutterImageWithText_]);\n    this.endGeometry(feature);\n  };\n  /**\n   * @return {import(\"../canvas.js\").SerializableInstructions} the serializable instructions.\n   */\n\n\n  CanvasImageBuilder.prototype.finish = function () {\n    this.reverseHitDetectionInstructions(); // FIXME this doesn't really protect us against further calls to draw*Geometry\n\n    this.anchorX_ = undefined;\n    this.anchorY_ = undefined;\n    this.hitDetectionImage_ = null;\n    this.image_ = null;\n    this.imagePixelRatio_ = undefined;\n    this.height_ = undefined;\n    this.scale_ = undefined;\n    this.opacity_ = undefined;\n    this.originX_ = undefined;\n    this.originY_ = undefined;\n    this.rotateWithView_ = undefined;\n    this.rotation_ = undefined;\n    this.width_ = undefined;\n    return _super.prototype.finish.call(this);\n  };\n  /**\n   * @param {import(\"../../style/Image.js\").default} imageStyle Image style.\n   * @param {Object} [opt_sharedData] Shared data.\n   */\n\n\n  CanvasImageBuilder.prototype.setImageStyle = function (imageStyle, opt_sharedData) {\n    var anchor = imageStyle.getAnchor();\n    var size = imageStyle.getSize();\n    var hitDetectionImage = imageStyle.getHitDetectionImage();\n    var image = imageStyle.getImage(this.pixelRatio);\n    var origin = imageStyle.getOrigin();\n    this.imagePixelRatio_ = imageStyle.getPixelRatio(this.pixelRatio);\n    this.anchorX_ = anchor[0];\n    this.anchorY_ = anchor[1];\n    this.hitDetectionImage_ = hitDetectionImage;\n    this.image_ = image;\n    this.height_ = size[1];\n    this.opacity_ = imageStyle.getOpacity();\n    this.originX_ = origin[0] * this.imagePixelRatio_;\n    this.originY_ = origin[1] * this.imagePixelRatio_;\n    this.rotateWithView_ = imageStyle.getRotateWithView();\n    this.rotation_ = imageStyle.getRotation();\n    this.scale_ = imageStyle.getScaleArray();\n    this.width_ = size[0];\n    this.declutterImageWithText_ = opt_sharedData;\n  };\n\n  return CanvasImageBuilder;\n}(CanvasBuilder);\n\nexport default CanvasImageBuilder;","map":{"version":3,"mappings":"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","names":["CanvasBuilder","CanvasInstruction","__extends","tolerance","maxExtent","resolution","pixelRatio","_super","_this","hitDetectionImage_","image_","imagePixelRatio_","undefined","anchorX_","anchorY_","height_","opacity_","originX_","originY_","rotateWithView_","rotation_","scale_","width_","declutterImageWithText_","CanvasImageBuilder","pointGeometry","feature","beginGeometry","flatCoordinates","getFlatCoordinates","stride","getStride","myBegin","coordinates","length","myEnd","appendFlatPointCoordinates","instructions","push","DRAW_IMAGE","Math","ceil","hitDetectionInstructions","endGeometry","multiPointGeometry","reverseHitDetectionInstructions","finish","call","imageStyle","opt_sharedData","anchor","getAnchor","size","getSize","hitDetectionImage","getHitDetectionImage","image","getImage","origin","getOrigin","getPixelRatio","getOpacity","getRotateWithView","getRotation","getScaleArray"],"sourceRoot":"","sources":["../../src/render/canvas/ImageBuilder.js"],"sourcesContent":[null]},"metadata":{},"sourceType":"module"}