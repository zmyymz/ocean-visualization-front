{"ast":null,"code":"import \"core-js/modules/es.error.cause.js\";\n\n/**\n * @module ol/style/IconImage\n */\nvar __extends = this && this.__extends || function () {\n  var _extendStatics = function extendStatics(d, b) {\n    _extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) {\n        if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p];\n      }\n    };\n\n    return _extendStatics(d, b);\n  };\n\n  return function (d, b) {\n    if (typeof b !== \"function\" && b !== null) throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\n\n    _extendStatics(d, b);\n\n    function __() {\n      this.constructor = d;\n    }\n\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\n\nimport EventTarget from '../events/Target.js';\nimport EventType from '../events/EventType.js';\nimport ImageState from '../ImageState.js';\nimport { asString } from '../color.js';\nimport { createCanvasContext2D } from '../dom.js';\nimport { shared as iconImageCache } from './IconImageCache.js';\nimport { listenImage } from '../Image.js';\n/**\n * @type {CanvasRenderingContext2D}\n */\n\nvar taintedTestContext = null;\n\nvar IconImage =\n/** @class */\nfunction (_super) {\n  __extends(IconImage, _super);\n  /**\n   * @param {HTMLImageElement|HTMLCanvasElement} image Image.\n   * @param {string|undefined} src Src.\n   * @param {import(\"../size.js\").Size} size Size.\n   * @param {?string} crossOrigin Cross origin.\n   * @param {import(\"../ImageState.js\").default} imageState Image state.\n   * @param {import(\"../color.js\").Color} color Color.\n   */\n\n\n  function IconImage(image, src, size, crossOrigin, imageState, color) {\n    var _this = _super.call(this) || this;\n    /**\n     * @private\n     * @type {HTMLImageElement|HTMLCanvasElement}\n     */\n\n\n    _this.hitDetectionImage_ = null;\n    /**\n     * @private\n     * @type {HTMLImageElement|HTMLCanvasElement}\n     */\n\n    _this.image_ = !image ? new Image() : image;\n\n    if (crossOrigin !== null) {\n      /** @type {HTMLImageElement} */\n      _this.image_.crossOrigin = crossOrigin;\n    }\n    /**\n     * @private\n     * @type {Object<number, HTMLCanvasElement>}\n     */\n\n\n    _this.canvas_ = {};\n    /**\n     * @private\n     * @type {import(\"../color.js\").Color}\n     */\n\n    _this.color_ = color;\n    /**\n     * @private\n     * @type {?function():void}\n     */\n\n    _this.unlisten_ = null;\n    /**\n     * @private\n     * @type {import(\"../ImageState.js\").default}\n     */\n\n    _this.imageState_ = imageState;\n    /**\n     * @private\n     * @type {import(\"../size.js\").Size}\n     */\n\n    _this.size_ = size;\n    /**\n     * @private\n     * @type {string|undefined}\n     */\n\n    _this.src_ = src;\n    /**\n     * @private\n     */\n\n    _this.tainted_;\n    return _this;\n  }\n  /**\n   * @private\n   * @return {boolean} The image canvas is tainted.\n   */\n\n\n  IconImage.prototype.isTainted_ = function () {\n    if (this.tainted_ === undefined && this.imageState_ === ImageState.LOADED) {\n      if (!taintedTestContext) {\n        taintedTestContext = createCanvasContext2D(1, 1);\n      }\n\n      taintedTestContext.drawImage(this.image_, 0, 0);\n\n      try {\n        taintedTestContext.getImageData(0, 0, 1, 1);\n        this.tainted_ = false;\n      } catch (e) {\n        taintedTestContext = null;\n        this.tainted_ = true;\n      }\n    }\n\n    return this.tainted_ === true;\n  };\n  /**\n   * @private\n   */\n\n\n  IconImage.prototype.dispatchChangeEvent_ = function () {\n    this.dispatchEvent(EventType.CHANGE);\n  };\n  /**\n   * @private\n   */\n\n\n  IconImage.prototype.handleImageError_ = function () {\n    this.imageState_ = ImageState.ERROR;\n    this.unlistenImage_();\n    this.dispatchChangeEvent_();\n  };\n  /**\n   * @private\n   */\n\n\n  IconImage.prototype.handleImageLoad_ = function () {\n    this.imageState_ = ImageState.LOADED;\n\n    if (this.size_) {\n      this.image_.width = this.size_[0];\n      this.image_.height = this.size_[1];\n    } else {\n      this.size_ = [this.image_.width, this.image_.height];\n    }\n\n    this.unlistenImage_();\n    this.dispatchChangeEvent_();\n  };\n  /**\n   * @param {number} pixelRatio Pixel ratio.\n   * @return {HTMLImageElement|HTMLCanvasElement} Image or Canvas element.\n   */\n\n\n  IconImage.prototype.getImage = function (pixelRatio) {\n    this.replaceColor_(pixelRatio);\n    return this.canvas_[pixelRatio] ? this.canvas_[pixelRatio] : this.image_;\n  };\n  /**\n   * @param {number} pixelRatio Pixel ratio.\n   * @return {number} Image or Canvas element.\n   */\n\n\n  IconImage.prototype.getPixelRatio = function (pixelRatio) {\n    this.replaceColor_(pixelRatio);\n    return this.canvas_[pixelRatio] ? pixelRatio : 1;\n  };\n  /**\n   * @return {import(\"../ImageState.js\").default} Image state.\n   */\n\n\n  IconImage.prototype.getImageState = function () {\n    return this.imageState_;\n  };\n  /**\n   * @return {HTMLImageElement|HTMLCanvasElement} Image element.\n   */\n\n\n  IconImage.prototype.getHitDetectionImage = function () {\n    if (!this.hitDetectionImage_) {\n      if (this.isTainted_()) {\n        var width = this.size_[0];\n        var height = this.size_[1];\n        var context = createCanvasContext2D(width, height);\n        context.fillRect(0, 0, width, height);\n        this.hitDetectionImage_ = context.canvas;\n      } else {\n        this.hitDetectionImage_ = this.image_;\n      }\n    }\n\n    return this.hitDetectionImage_;\n  };\n  /**\n   * Get the size of the icon (in pixels).\n   * @return {import(\"../size.js\").Size} Image size.\n   */\n\n\n  IconImage.prototype.getSize = function () {\n    return this.size_;\n  };\n  /**\n   * @return {string|undefined} Image src.\n   */\n\n\n  IconImage.prototype.getSrc = function () {\n    return this.src_;\n  };\n  /**\n   * Load not yet loaded URI.\n   */\n\n\n  IconImage.prototype.load = function () {\n    if (this.imageState_ == ImageState.IDLE) {\n      this.imageState_ = ImageState.LOADING;\n\n      try {\n        /** @type {HTMLImageElement} */\n        this.image_.src = this.src_;\n      } catch (e) {\n        this.handleImageError_();\n      }\n\n      this.unlisten_ = listenImage(this.image_, this.handleImageLoad_.bind(this), this.handleImageError_.bind(this));\n    }\n  };\n  /**\n   * @param {number} pixelRatio Pixel ratio.\n   * @private\n   */\n\n\n  IconImage.prototype.replaceColor_ = function (pixelRatio) {\n    if (!this.color_ || this.canvas_[pixelRatio] || this.imageState_ !== ImageState.LOADED) {\n      return;\n    }\n\n    var canvas = document.createElement('canvas');\n    this.canvas_[pixelRatio] = canvas;\n    canvas.width = Math.ceil(this.image_.width * pixelRatio);\n    canvas.height = Math.ceil(this.image_.height * pixelRatio);\n    var ctx = canvas.getContext('2d');\n    ctx.scale(pixelRatio, pixelRatio);\n    ctx.drawImage(this.image_, 0, 0);\n    ctx.globalCompositeOperation = 'multiply'; // Internet Explorer 11 does not support the multiply operation.\n    // If the canvas is tainted in Internet Explorer this still produces\n    // a solid color image with the shape of the icon.\n\n    if (ctx.globalCompositeOperation === 'multiply' || this.isTainted_()) {\n      ctx.fillStyle = asString(this.color_);\n      ctx.fillRect(0, 0, canvas.width / pixelRatio, canvas.height / pixelRatio);\n      ctx.globalCompositeOperation = 'destination-in';\n      ctx.drawImage(this.image_, 0, 0);\n    } else {\n      var imgData = ctx.getImageData(0, 0, canvas.width, canvas.height);\n      var data = imgData.data;\n      var r = this.color_[0] / 255.0;\n      var g = this.color_[1] / 255.0;\n      var b = this.color_[2] / 255.0;\n      var a = this.color_[3];\n\n      for (var i = 0, ii = data.length; i < ii; i += 4) {\n        data[i] *= r;\n        data[i + 1] *= g;\n        data[i + 2] *= b;\n        data[i + 3] *= a;\n      }\n\n      ctx.putImageData(imgData, 0, 0);\n    }\n  };\n  /**\n   * Discards event handlers which listen for load completion or errors.\n   *\n   * @private\n   */\n\n\n  IconImage.prototype.unlistenImage_ = function () {\n    if (this.unlisten_) {\n      this.unlisten_();\n      this.unlisten_ = null;\n    }\n  };\n\n  return IconImage;\n}(EventTarget);\n/**\n * @param {HTMLImageElement|HTMLCanvasElement} image Image.\n * @param {string} src Src.\n * @param {import(\"../size.js\").Size} size Size.\n * @param {?string} crossOrigin Cross origin.\n * @param {import(\"../ImageState.js\").default} imageState Image state.\n * @param {import(\"../color.js\").Color} color Color.\n * @return {IconImage} Icon image.\n */\n\n\nexport function get(image, src, size, crossOrigin, imageState, color) {\n  var iconImage = iconImageCache.get(src, crossOrigin, color);\n\n  if (!iconImage) {\n    iconImage = new IconImage(image, src, size, crossOrigin, imageState, color);\n    iconImageCache.set(src, crossOrigin, color, iconImage);\n  }\n\n  return iconImage;\n}\nexport default IconImage;","map":{"version":3,"mappings":"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","names":["EventTarget","EventType","ImageState","asString","createCanvasContext2D","shared","iconImageCache","listenImage","taintedTestContext","__extends","image","src","size","crossOrigin","imageState","color","_super","_this","hitDetectionImage_","image_","Image","canvas_","color_","unlisten_","imageState_","size_","src_","tainted_","IconImage","undefined","LOADED","drawImage","getImageData","e","dispatchEvent","CHANGE","ERROR","unlistenImage_","dispatchChangeEvent_","width","height","pixelRatio","replaceColor_","isTainted_","context","fillRect","canvas","IDLE","LOADING","handleImageError_","handleImageLoad_","bind","document","createElement","Math","ceil","ctx","getContext","scale","globalCompositeOperation","fillStyle","imgData","data","r","g","b","a","i","ii","length","putImageData","get","iconImage","set"],"sourceRoot":"","sources":["../src/style/IconImage.js"],"sourcesContent":[null]},"metadata":{},"sourceType":"module"}