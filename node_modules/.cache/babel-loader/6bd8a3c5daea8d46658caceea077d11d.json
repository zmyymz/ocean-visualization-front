{"ast":null,"code":"import \"core-js/modules/es.error.cause.js\";\nimport \"core-js/modules/es.array.sort.js\";\nimport \"core-js/modules/es.array.splice.js\";\nimport \"core-js/modules/es.object.to-string.js\";\nimport \"core-js/modules/es.array.map.js\";\nimport \"core-js/modules/es.array.slice.js\";\nimport \"core-js/modules/es.regexp.to-string.js\";\nimport \"core-js/modules/es.array.concat.js\";\nimport \"core-js/modules/es.array.filter.js\";\n\nvar __extends = this && this.__extends || function () {\n  var _extendStatics = function extendStatics(d, b) {\n    _extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) {\n        if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p];\n      }\n    };\n\n    return _extendStatics(d, b);\n  };\n\n  return function (d, b) {\n    if (typeof b !== \"function\" && b !== null) throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\n\n    _extendStatics(d, b);\n\n    function __() {\n      this.constructor = d;\n    }\n\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\n/**\n * @module ol/renderer/canvas/VectorTileLayer\n */\n\n\nimport CanvasBuilderGroup from '../../render/canvas/BuilderGroup.js';\nimport CanvasExecutorGroup from '../../render/canvas/ExecutorGroup.js';\nimport CanvasTileLayerRenderer from './TileLayer.js';\nimport ReplayType from '../../render/canvas/BuilderType.js';\nimport TileState from '../../TileState.js';\nimport VectorTileRenderType from '../../layer/VectorTileRenderType.js';\nimport ViewHint from '../../ViewHint.js';\nimport { HIT_DETECT_RESOLUTION, createHitDetectionImageData, hitDetect } from '../../render/canvas/hitdetect.js';\nimport { apply as applyTransform, create as createTransform, multiply, reset as resetTransform, scale, scale as scaleTransform, translate as translateTransform } from '../../transform.js';\nimport { boundingExtent, buffer, containsExtent, equals, getIntersection, getTopLeft, intersects } from '../../extent.js';\nimport { getSquaredTolerance as getSquaredRenderTolerance, renderFeature } from '../vector.js';\nimport { getUid } from '../../util.js';\nimport { toSize } from '../../size.js';\nimport { wrapX } from '../../coordinate.js';\n/**\n * @type {!Object<string, Array<import(\"../../render/canvas/BuilderType.js\").default>>}\n */\n\nvar IMAGE_REPLAYS = {\n  'image': [ReplayType.POLYGON, ReplayType.CIRCLE, ReplayType.LINE_STRING, ReplayType.IMAGE, ReplayType.TEXT],\n  'hybrid': [ReplayType.POLYGON, ReplayType.LINE_STRING],\n  'vector': []\n};\n/**\n * @type {!Object<string, Array<import(\"../../render/canvas/BuilderType.js\").default>>}\n */\n\nvar VECTOR_REPLAYS = {\n  'hybrid': [ReplayType.IMAGE, ReplayType.TEXT, ReplayType.DEFAULT],\n  'vector': [ReplayType.POLYGON, ReplayType.CIRCLE, ReplayType.LINE_STRING, ReplayType.IMAGE, ReplayType.TEXT, ReplayType.DEFAULT]\n};\n/**\n * @classdesc\n * Canvas renderer for vector tile layers.\n * @api\n * @extends {CanvasTileLayerRenderer<import(\"../../layer/VectorTile.js\").default>}\n */\n\nvar CanvasVectorTileLayerRenderer =\n/** @class */\nfunction (_super) {\n  __extends(CanvasVectorTileLayerRenderer, _super);\n  /**\n   * @param {import(\"../../layer/VectorTile.js\").default} layer VectorTile layer.\n   */\n\n\n  function CanvasVectorTileLayerRenderer(layer) {\n    var _this = _super.call(this, layer) || this;\n    /** @private */\n\n\n    _this.boundHandleStyleImageChange_ = _this.handleStyleImageChange_.bind(_this);\n    /**\n     * @private\n     * @type {boolean}\n     */\n\n    _this.dirty_ = false;\n    /**\n     * @private\n     * @type {number}\n     */\n\n    _this.renderedLayerRevision_;\n    /**\n     * @private\n     * @type {import(\"../../transform\").Transform}\n     */\n\n    _this.renderedPixelToCoordinateTransform_ = null;\n    /**\n     * @private\n     * @type {number}\n     */\n\n    _this.renderedRotation_;\n    /**\n     * @private\n     * @type {import(\"../../transform.js\").Transform}\n     */\n\n    _this.tmpTransform_ = createTransform();\n    return _this;\n  }\n  /**\n   * @param {import(\"../../VectorRenderTile.js\").default} tile Tile.\n   * @param {number} pixelRatio Pixel ratio.\n   * @param {import(\"../../proj/Projection\").default} projection Projection.\n   * @return {boolean|undefined} Tile needs to be rendered.\n   */\n\n\n  CanvasVectorTileLayerRenderer.prototype.prepareTile = function (tile, pixelRatio, projection) {\n    var render;\n    var state = tile.getState();\n\n    if (state === TileState.LOADED || state === TileState.ERROR) {\n      this.updateExecutorGroup_(tile, pixelRatio, projection);\n\n      if (this.tileImageNeedsRender_(tile)) {\n        render = true;\n      }\n    }\n\n    return render;\n  };\n  /**\n   * @param {number} z Tile coordinate z.\n   * @param {number} x Tile coordinate x.\n   * @param {number} y Tile coordinate y.\n   * @param {import(\"../../PluggableMap.js\").FrameState} frameState Frame state.\n   * @return {!import(\"../../Tile.js\").default} Tile.\n   */\n\n\n  CanvasVectorTileLayerRenderer.prototype.getTile = function (z, x, y, frameState) {\n    var pixelRatio = frameState.pixelRatio;\n    var viewState = frameState.viewState;\n    var resolution = viewState.resolution;\n    var projection = viewState.projection;\n    var layer = this.getLayer();\n    var tile = layer.getSource().getTile(z, x, y, pixelRatio, projection);\n    var viewHints = frameState.viewHints;\n    var hifi = !(viewHints[ViewHint.ANIMATING] || viewHints[ViewHint.INTERACTING]);\n\n    if (hifi || !tile.wantedResolution) {\n      tile.wantedResolution = resolution;\n    }\n\n    var render = this.prepareTile(tile, pixelRatio, projection);\n\n    if (render && (hifi || Date.now() - frameState.time < 8) && layer.getRenderMode() !== VectorTileRenderType.VECTOR) {\n      this.renderTileImage_(tile, frameState);\n    }\n\n    return _super.prototype.getTile.call(this, z, x, y, frameState);\n  };\n  /**\n   * @param {import(\"../../VectorRenderTile.js\").default} tile Tile.\n   * @return {boolean} Tile is drawable.\n   */\n\n\n  CanvasVectorTileLayerRenderer.prototype.isDrawableTile = function (tile) {\n    var layer = this.getLayer();\n    return _super.prototype.isDrawableTile.call(this, tile) && (layer.getRenderMode() === VectorTileRenderType.VECTOR ? getUid(layer) in tile.executorGroups : tile.hasContext(layer));\n  };\n  /**\n   * @inheritDoc\n   */\n\n\n  CanvasVectorTileLayerRenderer.prototype.getTileImage = function (tile) {\n    return tile.getImage(this.getLayer());\n  };\n  /**\n   * Determine whether render should be called.\n   * @param {import(\"../../PluggableMap.js\").FrameState} frameState Frame state.\n   * @return {boolean} Layer is ready to be rendered.\n   */\n\n\n  CanvasVectorTileLayerRenderer.prototype.prepareFrame = function (frameState) {\n    var layerRevision = this.getLayer().getRevision();\n\n    if (this.renderedLayerRevision_ != layerRevision) {\n      this.renderedTiles.length = 0;\n    }\n\n    this.renderedLayerRevision_ = layerRevision;\n    return _super.prototype.prepareFrame.call(this, frameState);\n  };\n  /**\n   * @param {import(\"../../VectorRenderTile.js\").default} tile Tile.\n   * @param {number} pixelRatio Pixel ratio.\n   * @param {import(\"../../proj/Projection.js\").default} projection Projection.\n   * @private\n   */\n\n\n  CanvasVectorTileLayerRenderer.prototype.updateExecutorGroup_ = function (tile, pixelRatio, projection) {\n    var layer =\n    /** @type {import(\"../../layer/VectorTile.js\").default} */\n    this.getLayer();\n    var revision = layer.getRevision();\n    var renderOrder = layer.getRenderOrder() || null;\n    var resolution = tile.wantedResolution;\n    var builderState = tile.getReplayState(layer);\n\n    if (!builderState.dirty && builderState.renderedResolution === resolution && builderState.renderedRevision == revision && builderState.renderedRenderOrder == renderOrder) {\n      return;\n    }\n\n    var source = layer.getSource();\n    var declutter = layer.getDeclutter();\n    var sourceTileGrid = source.getTileGrid();\n    var tileGrid = source.getTileGridForProjection(projection);\n    var tileExtent = tileGrid.getTileCoordExtent(tile.wrappedTileCoord);\n    var sourceTiles = source.getSourceTiles(pixelRatio, projection, tile);\n    var layerUid = getUid(layer);\n    delete tile.hitDetectionImageData[layerUid];\n    tile.executorGroups[layerUid] = [];\n\n    if (declutter) {\n      tile.declutterExecutorGroups[layerUid] = [];\n    }\n\n    var _loop_1 = function _loop_1(t, tt) {\n      var sourceTile = sourceTiles[t];\n\n      if (sourceTile.getState() != TileState.LOADED) {\n        return \"continue\";\n      }\n\n      var sourceTileCoord = sourceTile.tileCoord;\n      var sourceTileExtent = sourceTileGrid.getTileCoordExtent(sourceTileCoord);\n      var sharedExtent = getIntersection(tileExtent, sourceTileExtent);\n      var builderExtent = buffer(sharedExtent, layer.getRenderBuffer() * resolution, this_1.tmpExtent);\n      var bufferedExtent = equals(sourceTileExtent, sharedExtent) ? null : builderExtent;\n      builderState.dirty = false;\n      var builderGroup = new CanvasBuilderGroup(0, builderExtent, resolution, pixelRatio);\n      var declutterBuilderGroup = declutter ? new CanvasBuilderGroup(0, sharedExtent, resolution, pixelRatio) : undefined;\n      var squaredTolerance = getSquaredRenderTolerance(resolution, pixelRatio);\n      /**\n       * @param {import(\"../../Feature.js\").FeatureLike} feature Feature.\n       * @this {CanvasVectorTileLayerRenderer}\n       */\n\n      var render = function render(feature) {\n        var styles;\n        var styleFunction = feature.getStyleFunction() || layer.getStyleFunction();\n\n        if (styleFunction) {\n          styles = styleFunction(feature, resolution);\n        }\n\n        if (styles) {\n          var dirty = this.renderFeature(feature, squaredTolerance, styles, builderGroup, declutterBuilderGroup);\n          this.dirty_ = this.dirty_ || dirty;\n          builderState.dirty = builderState.dirty || dirty;\n        }\n      };\n\n      var features = sourceTile.getFeatures();\n\n      if (renderOrder && renderOrder !== builderState.renderedRenderOrder) {\n        features.sort(renderOrder);\n      }\n\n      for (var i = 0, ii = features.length; i < ii; ++i) {\n        var feature = features[i];\n\n        if (!bufferedExtent || intersects(bufferedExtent, feature.getGeometry().getExtent())) {\n          render.call(this_1, feature);\n        }\n      }\n\n      var executorGroupInstructions = builderGroup.finish(); // no need to clip when the render tile is covered by a single source tile\n\n      var replayExtent = layer.getRenderMode() !== VectorTileRenderType.VECTOR && declutter && sourceTiles.length === 1 ? null : sharedExtent;\n      var renderingReplayGroup = new CanvasExecutorGroup(replayExtent, resolution, pixelRatio, source.getOverlaps(), executorGroupInstructions, layer.getRenderBuffer());\n      tile.executorGroups[layerUid].push(renderingReplayGroup);\n\n      if (declutterBuilderGroup) {\n        var declutterExecutorGroup = new CanvasExecutorGroup(null, resolution, pixelRatio, source.getOverlaps(), declutterBuilderGroup.finish(), layer.getRenderBuffer());\n        tile.declutterExecutorGroups[layerUid].push(declutterExecutorGroup);\n      }\n    };\n\n    var this_1 = this;\n\n    for (var t = 0, tt = sourceTiles.length; t < tt; ++t) {\n      _loop_1(t, tt);\n    }\n\n    builderState.renderedRevision = revision;\n    builderState.renderedRenderOrder = renderOrder;\n    builderState.renderedResolution = resolution;\n  };\n  /**\n   * @param {import(\"../../coordinate.js\").Coordinate} coordinate Coordinate.\n   * @param {import(\"../../PluggableMap.js\").FrameState} frameState Frame state.\n   * @param {number} hitTolerance Hit tolerance in pixels.\n   * @param {import(\"../vector.js\").FeatureCallback<T>} callback Feature callback.\n   * @param {Array<import(\"../Map.js\").HitMatch<T>>} matches The hit detected matches with tolerance.\n   * @return {T|undefined} Callback result.\n   * @template T\n   */\n\n\n  CanvasVectorTileLayerRenderer.prototype.forEachFeatureAtCoordinate = function (coordinate, frameState, hitTolerance, callback, matches) {\n    var resolution = frameState.viewState.resolution;\n    var rotation = frameState.viewState.rotation;\n    hitTolerance = hitTolerance == undefined ? 0 : hitTolerance;\n    var layer = this.getLayer();\n    var source = layer.getSource();\n    var tileGrid = source.getTileGridForProjection(frameState.viewState.projection);\n    var hitExtent = boundingExtent([coordinate]);\n    buffer(hitExtent, resolution * hitTolerance, hitExtent);\n    /** @type {!Object<string, import(\"../Map.js\").HitMatch<T>|true>} */\n\n    var features = {};\n    /**\n     * @param {import(\"../../Feature.js\").FeatureLike} feature Feature.\n     * @param {import(\"../../geom/SimpleGeometry.js\").default} geometry Geometry.\n     * @param {number} distanceSq The squared distance to the click position.\n     * @return {T|undefined} Callback result.\n     */\n\n    var featureCallback = function featureCallback(feature, geometry, distanceSq) {\n      var key = feature.getId();\n\n      if (key === undefined) {\n        key = getUid(feature);\n      }\n\n      var match = features[key];\n\n      if (!match) {\n        if (distanceSq === 0) {\n          features[key] = true;\n          return callback(feature, layer, geometry);\n        }\n\n        matches.push(features[key] = {\n          feature: feature,\n          layer: layer,\n          geometry: geometry,\n          distanceSq: distanceSq,\n          callback: callback\n        });\n      } else if (match !== true && distanceSq < match.distanceSq) {\n        if (distanceSq === 0) {\n          features[key] = true;\n          matches.splice(matches.lastIndexOf(match), 1);\n          return callback(feature, layer, geometry);\n        }\n\n        match.geometry = geometry;\n        match.distanceSq = distanceSq;\n      }\n\n      return undefined;\n    };\n\n    var renderedTiles =\n    /** @type {Array<import(\"../../VectorRenderTile.js\").default>} */\n    this.renderedTiles;\n    var found;\n\n    var _loop_2 = function _loop_2(i, ii) {\n      var tile = renderedTiles[i];\n      var tileExtent = tileGrid.getTileCoordExtent(tile.wrappedTileCoord);\n\n      if (!intersects(tileExtent, hitExtent)) {\n        return \"continue\";\n      }\n\n      var layerUid = getUid(layer);\n      var executorGroups = [tile.executorGroups[layerUid]];\n      var declutterExecutorGroups = tile.declutterExecutorGroups[layerUid];\n\n      if (declutterExecutorGroups) {\n        executorGroups.push(declutterExecutorGroups);\n      }\n\n      executorGroups.some(function (executorGroups) {\n        var declutteredFeatures = executorGroups === declutterExecutorGroups ? frameState.declutterTree.all().map(function (item) {\n          return item.value;\n        }) : null;\n\n        for (var t = 0, tt = executorGroups.length; t < tt; ++t) {\n          var executorGroup = executorGroups[t];\n          found = executorGroup.forEachFeatureAtCoordinate(coordinate, resolution, rotation, hitTolerance, featureCallback, declutteredFeatures);\n\n          if (found) {\n            return true;\n          }\n        }\n      });\n    };\n\n    for (var i = 0, ii = renderedTiles.length; !found && i < ii; ++i) {\n      _loop_2(i, ii);\n    }\n\n    return found;\n  };\n  /**\n   * Asynchronous layer level hit detection.\n   * @param {import(\"../../pixel.js\").Pixel} pixel Pixel.\n   * @return {Promise<Array<import(\"../../Feature\").default>>} Promise that resolves with an array of features.\n   */\n\n\n  CanvasVectorTileLayerRenderer.prototype.getFeatures = function (pixel) {\n    return new Promise(function (resolve, reject) {\n      var layer =\n      /** @type {import(\"../../layer/VectorTile.js\").default} */\n      this.getLayer();\n      var layerUid = getUid(layer);\n      var source = layer.getSource();\n      var projection = this.renderedProjection;\n      var projectionExtent = projection.getExtent();\n      var resolution = this.renderedResolution;\n      var tileGrid = source.getTileGridForProjection(projection);\n      var coordinate = applyTransform(this.renderedPixelToCoordinateTransform_, pixel.slice());\n      var tileCoord = tileGrid.getTileCoordForCoordAndResolution(coordinate, resolution);\n      var tile;\n\n      for (var i = 0, ii = this.renderedTiles.length; i < ii; ++i) {\n        if (tileCoord.toString() === this.renderedTiles[i].tileCoord.toString()) {\n          tile = this.renderedTiles[i];\n\n          if (tile.getState() === TileState.LOADED) {\n            var extent_1 = tileGrid.getTileCoordExtent(tile.tileCoord);\n\n            if (source.getWrapX() && projection.canWrapX() && !containsExtent(projectionExtent, extent_1)) {\n              wrapX(coordinate, projection);\n            }\n\n            break;\n          }\n\n          tile = undefined;\n        }\n      }\n\n      if (!tile || tile.loadingSourceTiles > 0) {\n        resolve([]);\n        return;\n      }\n\n      var extent = tileGrid.getTileCoordExtent(tile.wrappedTileCoord);\n      var corner = getTopLeft(extent);\n      var tilePixel = [(coordinate[0] - corner[0]) / resolution, (corner[1] - coordinate[1]) / resolution];\n      var features = tile.getSourceTiles().reduce(function (accumulator, sourceTile) {\n        return accumulator.concat(sourceTile.getFeatures());\n      }, []);\n      var hitDetectionImageData = tile.hitDetectionImageData[layerUid];\n\n      if (!hitDetectionImageData && !this.animatingOrInteracting_) {\n        var tileSize = toSize(tileGrid.getTileSize(tileGrid.getZForResolution(resolution)));\n        var rotation = this.renderedRotation_;\n        var transforms = [this.getRenderTransform(tileGrid.getTileCoordCenter(tile.wrappedTileCoord), resolution, 0, HIT_DETECT_RESOLUTION, tileSize[0] * HIT_DETECT_RESOLUTION, tileSize[1] * HIT_DETECT_RESOLUTION, 0)];\n        hitDetectionImageData = createHitDetectionImageData(tileSize, transforms, features, layer.getStyleFunction(), tileGrid.getTileCoordExtent(tile.wrappedTileCoord), tile.getReplayState(layer).renderedResolution, rotation);\n        tile.hitDetectionImageData[layerUid] = hitDetectionImageData;\n      }\n\n      resolve(hitDetect(tilePixel, features, hitDetectionImageData));\n    }.bind(this));\n  };\n  /**\n   * Perform action necessary to get the layer rendered after new fonts have loaded\n   */\n\n\n  CanvasVectorTileLayerRenderer.prototype.handleFontsChanged = function () {\n    var layer = this.getLayer();\n\n    if (layer.getVisible() && this.renderedLayerRevision_ !== undefined) {\n      layer.changed();\n    }\n  };\n  /**\n   * Handle changes in image style state.\n   * @param {import(\"../../events/Event.js\").default} event Image style change event.\n   * @private\n   */\n\n\n  CanvasVectorTileLayerRenderer.prototype.handleStyleImageChange_ = function (event) {\n    this.renderIfReadyAndVisible();\n  };\n  /**\n   * Render declutter items for this layer\n   * @param {import(\"../../PluggableMap.js\").FrameState} frameState Frame state.\n   */\n\n\n  CanvasVectorTileLayerRenderer.prototype.renderDeclutter = function (frameState) {\n    var context = this.context;\n    var alpha = context.globalAlpha;\n    context.globalAlpha = this.getLayer().getOpacity();\n    var viewHints = frameState.viewHints;\n    var hifi = !(viewHints[ViewHint.ANIMATING] || viewHints[ViewHint.INTERACTING]);\n    var tiles =\n    /** @type {Array<import(\"../../VectorRenderTile.js\").default>} */\n    this.renderedTiles;\n\n    for (var i = 0, ii = tiles.length; i < ii; ++i) {\n      var tile = tiles[i];\n      var declutterExecutorGroups = tile.declutterExecutorGroups[getUid(this.getLayer())];\n\n      if (declutterExecutorGroups) {\n        for (var j = declutterExecutorGroups.length - 1; j >= 0; --j) {\n          declutterExecutorGroups[j].execute(this.context, 1, this.getTileRenderTransform(tile, frameState), frameState.viewState.rotation, hifi, undefined, frameState.declutterTree);\n        }\n      }\n    }\n\n    context.globalAlpha = alpha;\n  };\n\n  CanvasVectorTileLayerRenderer.prototype.getTileRenderTransform = function (tile, frameState) {\n    var pixelRatio = frameState.pixelRatio;\n    var viewState = frameState.viewState;\n    var center = viewState.center;\n    var resolution = viewState.resolution;\n    var rotation = viewState.rotation;\n    var size = frameState.size;\n    var width = Math.round(size[0] * pixelRatio);\n    var height = Math.round(size[1] * pixelRatio);\n    var source = this.getLayer().getSource();\n    var tileGrid = source.getTileGridForProjection(frameState.viewState.projection);\n    var tileCoord = tile.tileCoord;\n    var tileExtent = tileGrid.getTileCoordExtent(tile.wrappedTileCoord);\n    var worldOffset = tileGrid.getTileCoordExtent(tileCoord, this.tmpExtent)[0] - tileExtent[0];\n    var transform = multiply(scale(this.inversePixelTransform.slice(), 1 / pixelRatio, 1 / pixelRatio), this.getRenderTransform(center, resolution, rotation, pixelRatio, width, height, worldOffset));\n    return transform;\n  };\n  /**\n   * Render the layer.\n   * @param {import(\"../../PluggableMap.js\").FrameState} frameState Frame state.\n   * @param {HTMLElement} target Target that may be used to render content to.\n   * @return {HTMLElement} The rendered element.\n   */\n\n\n  CanvasVectorTileLayerRenderer.prototype.renderFrame = function (frameState, target) {\n    var viewHints = frameState.viewHints;\n    var hifi = !(viewHints[ViewHint.ANIMATING] || viewHints[ViewHint.INTERACTING]);\n\n    _super.prototype.renderFrame.call(this, frameState, target);\n\n    this.renderedPixelToCoordinateTransform_ = frameState.pixelToCoordinateTransform.slice();\n    this.renderedRotation_ = frameState.viewState.rotation;\n    var layer =\n    /** @type {import(\"../../layer/VectorTile.js\").default} */\n    this.getLayer();\n    var renderMode = layer.getRenderMode();\n    var context = this.context;\n    var alpha = context.globalAlpha;\n    context.globalAlpha = layer.getOpacity();\n    var replayTypes = VECTOR_REPLAYS[renderMode];\n    var viewState = frameState.viewState;\n    var rotation = viewState.rotation;\n    var tileSource = layer.getSource();\n    var tileGrid = tileSource.getTileGridForProjection(viewState.projection);\n    var z = tileGrid.getZForResolution(viewState.resolution, tileSource.zDirection);\n    var tiles = this.renderedTiles;\n    var clips = [];\n    var clipZs = [];\n\n    for (var i = tiles.length - 1; i >= 0; --i) {\n      var tile =\n      /** @type {import(\"../../VectorRenderTile.js\").default} */\n      tiles[i];\n      var executorGroups = tile.executorGroups[getUid(layer)].filter(function (group) {\n        return group.hasExecutors(replayTypes);\n      });\n\n      if (executorGroups.length === 0) {\n        continue;\n      }\n\n      var transform = this.getTileRenderTransform(tile, frameState);\n      var currentZ = tile.tileCoord[0];\n      var contextSaved = false; // Clip mask for regions in this tile that already filled by a higher z tile\n\n      var currentClip = executorGroups[0].getClipCoords(transform);\n\n      for (var j = 0, jj = clips.length; j < jj; ++j) {\n        if (z !== currentZ && currentZ < clipZs[j]) {\n          var clip = clips[j];\n\n          if (intersects([currentClip[0], currentClip[3], currentClip[4], currentClip[7]], [clip[0], clip[3], clip[4], clip[7]])) {\n            if (!contextSaved) {\n              context.save();\n              contextSaved = true;\n            }\n\n            context.beginPath(); // counter-clockwise (outer ring) for current tile\n\n            context.moveTo(currentClip[0], currentClip[1]);\n            context.lineTo(currentClip[2], currentClip[3]);\n            context.lineTo(currentClip[4], currentClip[5]);\n            context.lineTo(currentClip[6], currentClip[7]); // clockwise (inner ring) for higher z tile\n\n            context.moveTo(clip[6], clip[7]);\n            context.lineTo(clip[4], clip[5]);\n            context.lineTo(clip[2], clip[3]);\n            context.lineTo(clip[0], clip[1]);\n            context.clip();\n          }\n        }\n      }\n\n      clips.push(currentClip);\n      clipZs.push(currentZ);\n\n      for (var t = 0, tt = executorGroups.length; t < tt; ++t) {\n        var executorGroup = executorGroups[t];\n        executorGroup.execute(context, 1, transform, rotation, hifi, replayTypes);\n      }\n\n      if (contextSaved) {\n        context.restore();\n      }\n    }\n\n    context.globalAlpha = alpha;\n    return this.container;\n  };\n  /**\n   * @param {import(\"../../Feature.js\").FeatureLike} feature Feature.\n   * @param {number} squaredTolerance Squared tolerance.\n   * @param {import(\"../../style/Style.js\").default|Array<import(\"../../style/Style.js\").default>} styles The style or array of styles.\n   * @param {import(\"../../render/canvas/BuilderGroup.js\").default} builderGroup Replay group.\n   * @param {import(\"../../render/canvas/BuilderGroup.js\").default} [opt_declutterBuilderGroup] Builder group for decluttering.\n   * @return {boolean} `true` if an image is loading.\n   */\n\n\n  CanvasVectorTileLayerRenderer.prototype.renderFeature = function (feature, squaredTolerance, styles, builderGroup, opt_declutterBuilderGroup) {\n    if (!styles) {\n      return false;\n    }\n\n    var loading = false;\n\n    if (Array.isArray(styles)) {\n      for (var i = 0, ii = styles.length; i < ii; ++i) {\n        loading = renderFeature(builderGroup, feature, styles[i], squaredTolerance, this.boundHandleStyleImageChange_, undefined, opt_declutterBuilderGroup) || loading;\n      }\n    } else {\n      loading = renderFeature(builderGroup, feature, styles, squaredTolerance, this.boundHandleStyleImageChange_, undefined, opt_declutterBuilderGroup);\n    }\n\n    return loading;\n  };\n  /**\n   * @param {import(\"../../VectorRenderTile.js\").default} tile Tile.\n   * @return {boolean} A new tile image was rendered.\n   * @private\n   */\n\n\n  CanvasVectorTileLayerRenderer.prototype.tileImageNeedsRender_ = function (tile) {\n    var layer =\n    /** @type {import(\"../../layer/VectorTile.js\").default} */\n    this.getLayer();\n\n    if (layer.getRenderMode() === VectorTileRenderType.VECTOR) {\n      return false;\n    }\n\n    var replayState = tile.getReplayState(layer);\n    var revision = layer.getRevision();\n    var resolution = tile.wantedResolution;\n    return replayState.renderedTileResolution !== resolution || replayState.renderedTileRevision !== revision;\n  };\n  /**\n   * @param {import(\"../../VectorRenderTile.js\").default} tile Tile.\n   * @param {import(\"../../PluggableMap\").FrameState} frameState Frame state.\n   * @private\n   */\n\n\n  CanvasVectorTileLayerRenderer.prototype.renderTileImage_ = function (tile, frameState) {\n    var layer =\n    /** @type {import(\"../../layer/VectorTile.js\").default} */\n    this.getLayer();\n    var replayState = tile.getReplayState(layer);\n    var revision = layer.getRevision();\n    var executorGroups = tile.executorGroups[getUid(layer)];\n    replayState.renderedTileRevision = revision;\n    var tileCoord = tile.wrappedTileCoord;\n    var z = tileCoord[0];\n    var source = layer.getSource();\n    var pixelRatio = frameState.pixelRatio;\n    var viewState = frameState.viewState;\n    var projection = viewState.projection;\n    var tileGrid = source.getTileGridForProjection(projection);\n    var tileResolution = tileGrid.getResolution(tile.tileCoord[0]);\n    var renderPixelRatio = frameState.pixelRatio / tile.wantedResolution * tileResolution;\n    var resolution = tileGrid.getResolution(z);\n    var context = tile.getContext(layer); // Increase tile size when overzooming for low pixel ratio, to avoid blurry tiles\n\n    pixelRatio = Math.round(Math.max(pixelRatio, renderPixelRatio / pixelRatio));\n    var size = source.getTilePixelSize(z, pixelRatio, projection);\n    context.canvas.width = size[0];\n    context.canvas.height = size[1];\n    var renderScale = pixelRatio / renderPixelRatio;\n\n    if (renderScale !== 1) {\n      var canvasTransform = resetTransform(this.tmpTransform_);\n      scaleTransform(canvasTransform, renderScale, renderScale);\n      context.setTransform.apply(context, canvasTransform);\n    }\n\n    var tileExtent = tileGrid.getTileCoordExtent(tileCoord, this.tmpExtent);\n    var pixelScale = renderPixelRatio / resolution;\n    var transform = resetTransform(this.tmpTransform_);\n    scaleTransform(transform, pixelScale, -pixelScale);\n    translateTransform(transform, -tileExtent[0], -tileExtent[3]);\n\n    for (var i = 0, ii = executorGroups.length; i < ii; ++i) {\n      var executorGroup = executorGroups[i];\n      executorGroup.execute(context, renderScale, transform, 0, true, IMAGE_REPLAYS[layer.getRenderMode()]);\n    }\n\n    replayState.renderedTileResolution = tile.wantedResolution;\n  };\n\n  return CanvasVectorTileLayerRenderer;\n}(CanvasTileLayerRenderer);\n\nexport default CanvasVectorTileLayerRenderer;","map":{"version":3,"mappings":"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","names":["CanvasBuilderGroup","CanvasExecutorGroup","CanvasTileLayerRenderer","ReplayType","TileState","VectorTileRenderType","ViewHint","HIT_DETECT_RESOLUTION","createHitDetectionImageData","hitDetect","apply","applyTransform","create","createTransform","multiply","reset","resetTransform","scale","scaleTransform","translate","translateTransform","boundingExtent","buffer","containsExtent","equals","getIntersection","getTopLeft","intersects","getSquaredTolerance","getSquaredRenderTolerance","renderFeature","getUid","toSize","wrapX","IMAGE_REPLAYS","POLYGON","CIRCLE","LINE_STRING","IMAGE","TEXT","VECTOR_REPLAYS","DEFAULT","__extends","layer","_super","_this","boundHandleStyleImageChange_","handleStyleImageChange_","bind","dirty_","renderedLayerRevision_","renderedPixelToCoordinateTransform_","renderedRotation_","tmpTransform_","CanvasVectorTileLayerRenderer","tile","pixelRatio","projection","render","state","getState","LOADED","ERROR","updateExecutorGroup_","tileImageNeedsRender_","z","x","y","frameState","viewState","resolution","getLayer","getSource","getTile","viewHints","hifi","ANIMATING","INTERACTING","wantedResolution","prepareTile","Date","now","time","getRenderMode","VECTOR","renderTileImage_","call","isDrawableTile","executorGroups","hasContext","getImage","layerRevision","getRevision","renderedTiles","length","prepareFrame","revision","renderOrder","getRenderOrder","builderState","getReplayState","dirty","renderedResolution","renderedRevision","renderedRenderOrder","source","declutter","getDeclutter","sourceTileGrid","getTileGrid","tileGrid","getTileGridForProjection","tileExtent","getTileCoordExtent","wrappedTileCoord","sourceTiles","getSourceTiles","layerUid","hitDetectionImageData","declutterExecutorGroups","t","tt","sourceTile","sourceTileCoord","tileCoord","sourceTileExtent","sharedExtent","builderExtent","getRenderBuffer","this_1","tmpExtent","bufferedExtent","builderGroup","declutterBuilderGroup","undefined","squaredTolerance","feature","styles","styleFunction","getStyleFunction","features","getFeatures","sort","i","ii","getGeometry","getExtent","executorGroupInstructions","finish","replayExtent","renderingReplayGroup","getOverlaps","push","declutterExecutorGroup","coordinate","hitTolerance","callback","matches","rotation","hitExtent","featureCallback","geometry","distanceSq","key","getId","match","splice","lastIndexOf","found","some","declutteredFeatures","declutterTree","all","map","item","value","executorGroup","forEachFeatureAtCoordinate","pixel","Promise","resolve","reject","renderedProjection","projectionExtent","slice","getTileCoordForCoordAndResolution","toString","extent_1","getWrapX","canWrapX","loadingSourceTiles","extent","corner","tilePixel","reduce","accumulator","concat","animatingOrInteracting_","tileSize","getTileSize","getZForResolution","transforms","getRenderTransform","getTileCoordCenter","getVisible","changed","event","renderIfReadyAndVisible","context","alpha","globalAlpha","getOpacity","tiles","j","execute","getTileRenderTransform","center","size","width","Math","round","height","worldOffset","transform","inversePixelTransform","target","renderFrame","pixelToCoordinateTransform","renderMode","replayTypes","tileSource","zDirection","clips","clipZs","filter","group","hasExecutors","currentZ","contextSaved","currentClip","getClipCoords","jj","clip","save","beginPath","moveTo","lineTo","restore","container","opt_declutterBuilderGroup","loading","Array","isArray","replayState","renderedTileResolution","renderedTileRevision","tileResolution","getResolution","renderPixelRatio","getContext","max","getTilePixelSize","canvas","renderScale","canvasTransform","setTransform","pixelScale"],"sourceRoot":"","sources":["../../src/renderer/canvas/VectorTileLayer.js"],"sourcesContent":[null]},"metadata":{},"sourceType":"module"}