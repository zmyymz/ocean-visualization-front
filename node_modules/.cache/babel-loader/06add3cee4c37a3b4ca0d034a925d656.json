{"ast":null,"code":"import _typeof from \"D:/Java/JavaEE/IdeaProjects/ocean-vis/node_modules/@babel/runtime/helpers/esm/typeof.js\";\nimport \"core-js/modules/es.error.cause.js\";\nimport \"core-js/modules/es.object.to-string.js\";\nimport \"core-js/modules/es.string.iterator.js\";\nimport \"core-js/modules/web.dom-collections.iterator.js\";\nimport \"core-js/modules/web.url.js\";\nimport \"core-js/modules/web.url-search-params.js\";\nimport \"core-js/modules/es.array.filter.js\";\nimport \"core-js/modules/es.regexp.exec.js\";\nimport \"core-js/modules/es.string.search.js\";\nimport \"core-js/modules/es.array.concat.js\";\nimport \"core-js/modules/es.array.slice.js\";\nimport \"core-js/modules/es.string.replace.js\";\nimport \"core-js/modules/es.string.trim.js\";\nimport \"core-js/modules/es.object.keys.js\";\nimport \"core-js/modules/es.regexp.test.js\";\nimport \"core-js/modules/es.array.fill.js\";\nimport \"core-js/modules/es.regexp.to-string.js\";\nimport \"core-js/modules/es.array.join.js\";\nimport \"core-js/modules/es.function.name.js\";\nimport \"core-js/modules/es.number.constructor.js\";\nimport \"core-js/modules/web.dom-collections.for-each.js\";\nimport \"core-js/modules/es.array.sort.js\";\n\nvar __extends = this && this.__extends || function () {\n  var _extendStatics = function extendStatics(d, b) {\n    _extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) {\n        if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p];\n      }\n    };\n\n    return _extendStatics(d, b);\n  };\n\n  return function (d, b) {\n    if (typeof b !== \"function\" && b !== null) throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\n\n    _extendStatics(d, b);\n\n    function __() {\n      this.constructor = d;\n    }\n\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\n/**\n * @module ol/format/KML\n */\n\n\nimport Feature from '../Feature.js';\nimport Fill from '../style/Fill.js';\nimport GeometryCollection from '../geom/GeometryCollection.js';\nimport GeometryLayout from '../geom/GeometryLayout.js';\nimport GeometryType from '../geom/GeometryType.js';\nimport Icon from '../style/Icon.js';\nimport IconAnchorUnits from '../style/IconAnchorUnits.js';\nimport IconOrigin from '../style/IconOrigin.js';\nimport ImageState from '../ImageState.js';\nimport LineString from '../geom/LineString.js';\nimport MultiLineString from '../geom/MultiLineString.js';\nimport MultiPoint from '../geom/MultiPoint.js';\nimport MultiPolygon from '../geom/MultiPolygon.js';\nimport Point from '../geom/Point.js';\nimport Polygon from '../geom/Polygon.js';\nimport Stroke from '../style/Stroke.js';\nimport Style from '../style/Style.js';\nimport Text from '../style/Text.js';\nimport XMLFeature from './XMLFeature.js';\nimport { OBJECT_PROPERTY_NODE_FACTORY, XML_SCHEMA_INSTANCE_URI, createElementNS, getAllTextContent, isDocument, makeArrayExtender, makeArrayPusher, makeChildAppender, makeObjectPropertySetter, makeReplacer, makeSequence, makeSimpleNodeFactory, makeStructureNS, parse, parseNode, pushParseAndPop, pushSerializeAndPop } from '../xml.js';\nimport { asArray } from '../color.js';\nimport { assert } from '../asserts.js';\nimport { extend, includes } from '../array.js';\nimport { get as getProjection } from '../proj.js';\nimport { readBoolean, readDecimal, readString, writeBooleanTextNode, writeCDATASection, writeDecimalTextNode, writeStringTextNode } from './xsd.js';\nimport { toRadians } from '../math.js';\nimport { transformGeometryWithOptions } from './Feature.js';\n/**\n * @typedef {Object} Vec2\n * @property {number} x X coordinate.\n * @property {import(\"../style/IconAnchorUnits\").default} xunits Units of x.\n * @property {number} y Y coordinate.\n * @property {import(\"../style/IconAnchorUnits\").default} yunits Units of Y.\n * @property {import(\"../style/IconOrigin.js\").default} [origin] Origin.\n */\n\n/**\n * @typedef {Object} GxTrackObject\n * @property {Array<Array<number>>} coordinates Coordinates.\n * @property {Array<number>} whens Whens.\n */\n\n/**\n * @const\n * @type {Array<string>}\n */\n\nvar GX_NAMESPACE_URIS = ['http://www.google.com/kml/ext/2.2'];\n/**\n * @const\n * @type {Array<null|string>}\n */\n\nvar NAMESPACE_URIS = [null, 'http://earth.google.com/kml/2.0', 'http://earth.google.com/kml/2.1', 'http://earth.google.com/kml/2.2', 'http://www.opengis.net/kml/2.2'];\n/**\n * @const\n * @type {string}\n */\n\nvar SCHEMA_LOCATION = 'http://www.opengis.net/kml/2.2 ' + 'https://developers.google.com/kml/schema/kml22gx.xsd';\n/**\n * @type {Object<string, import(\"../style/IconAnchorUnits\").default>}\n */\n\nvar ICON_ANCHOR_UNITS_MAP = {\n  'fraction': IconAnchorUnits.FRACTION,\n  'pixels': IconAnchorUnits.PIXELS,\n  'insetPixels': IconAnchorUnits.PIXELS\n};\n/**\n * @const\n * @type {Object<string, Object<string, import(\"../xml.js\").Parser>>}\n */\n// @ts-ignore\n\nvar PLACEMARK_PARSERS = makeStructureNS(NAMESPACE_URIS, {\n  'ExtendedData': extendedDataParser,\n  'Region': regionParser,\n  'MultiGeometry': makeObjectPropertySetter(readMultiGeometry, 'geometry'),\n  'LineString': makeObjectPropertySetter(readLineString, 'geometry'),\n  'LinearRing': makeObjectPropertySetter(readLinearRing, 'geometry'),\n  'Point': makeObjectPropertySetter(readPoint, 'geometry'),\n  'Polygon': makeObjectPropertySetter(readPolygon, 'geometry'),\n  'Style': makeObjectPropertySetter(readStyle),\n  'StyleMap': placemarkStyleMapParser,\n  'address': makeObjectPropertySetter(readString),\n  'description': makeObjectPropertySetter(readString),\n  'name': makeObjectPropertySetter(readString),\n  'open': makeObjectPropertySetter(readBoolean),\n  'phoneNumber': makeObjectPropertySetter(readString),\n  'styleUrl': makeObjectPropertySetter(readStyleURL),\n  'visibility': makeObjectPropertySetter(readBoolean)\n}, makeStructureNS(GX_NAMESPACE_URIS, {\n  'MultiTrack': makeObjectPropertySetter(readGxMultiTrack, 'geometry'),\n  'Track': makeObjectPropertySetter(readGxTrack, 'geometry')\n}));\n/**\n * @const\n * @type {Object<string, Object<string, import(\"../xml.js\").Parser>>}\n */\n// @ts-ignore\n\nvar NETWORK_LINK_PARSERS = makeStructureNS(NAMESPACE_URIS, {\n  'ExtendedData': extendedDataParser,\n  'Region': regionParser,\n  'Link': linkParser,\n  'address': makeObjectPropertySetter(readString),\n  'description': makeObjectPropertySetter(readString),\n  'name': makeObjectPropertySetter(readString),\n  'open': makeObjectPropertySetter(readBoolean),\n  'phoneNumber': makeObjectPropertySetter(readString),\n  'visibility': makeObjectPropertySetter(readBoolean)\n});\n/**\n * @const\n * @type {Object<string, Object<string, import(\"../xml.js\").Parser>>}\n */\n// @ts-ignore\n\nvar LINK_PARSERS = makeStructureNS(NAMESPACE_URIS, {\n  'href': makeObjectPropertySetter(readURI)\n});\n/**\n * @const\n * @type {Object<string, Object<string, import(\"../xml.js\").Parser>>}\n */\n// @ts-ignore\n\nvar REGION_PARSERS = makeStructureNS(NAMESPACE_URIS, {\n  'LatLonAltBox': latLonAltBoxParser,\n  'Lod': lodParser\n});\n/**\n * @const\n * @type {Object<string, Array<string>>}\n */\n// @ts-ignore\n\nvar KML_SEQUENCE = makeStructureNS(NAMESPACE_URIS, ['Document', 'Placemark']);\n/**\n * @const\n * @type {Object<string, Object<string, import(\"../xml.js\").Serializer>>}\n */\n// @ts-ignore\n\nvar KML_SERIALIZERS = makeStructureNS(NAMESPACE_URIS, {\n  'Document': makeChildAppender(writeDocument),\n  'Placemark': makeChildAppender(writePlacemark)\n});\n/**\n * @type {import(\"../color.js\").Color}\n */\n\nvar DEFAULT_COLOR;\n/**\n * @type {Fill|null}\n */\n\nvar DEFAULT_FILL_STYLE = null;\n/**\n * Get the default fill style (or null if not yet set).\n * @return {Fill|null} The default fill style.\n */\n\nexport function getDefaultFillStyle() {\n  return DEFAULT_FILL_STYLE;\n}\n/**\n * @type {import(\"../size.js\").Size}\n */\n\nvar DEFAULT_IMAGE_STYLE_ANCHOR;\n/**\n * @type {import(\"../style/IconAnchorUnits\").default}\n */\n\nvar DEFAULT_IMAGE_STYLE_ANCHOR_X_UNITS;\n/**\n * @type {import(\"../style/IconAnchorUnits\").default}\n */\n\nvar DEFAULT_IMAGE_STYLE_ANCHOR_Y_UNITS;\n/**\n * @type {import(\"../size.js\").Size}\n */\n\nvar DEFAULT_IMAGE_STYLE_SIZE;\n/**\n * @type {string}\n */\n\nvar DEFAULT_IMAGE_STYLE_SRC;\n/**\n * @type {import(\"../style/Image.js\").default|null}\n */\n\nvar DEFAULT_IMAGE_STYLE = null;\n/**\n * Get the default image style (or null if not yet set).\n * @return {import(\"../style/Image.js\").default|null} The default image style.\n */\n\nexport function getDefaultImageStyle() {\n  return DEFAULT_IMAGE_STYLE;\n}\n/**\n * @type {string}\n */\n\nvar DEFAULT_NO_IMAGE_STYLE;\n/**\n * @type {Stroke|null}\n */\n\nvar DEFAULT_STROKE_STYLE = null;\n/**\n * Get the default stroke style (or null if not yet set).\n * @return {Stroke|null} The default stroke style.\n */\n\nexport function getDefaultStrokeStyle() {\n  return DEFAULT_STROKE_STYLE;\n}\n/**\n * @type {Stroke}\n */\n\nvar DEFAULT_TEXT_STROKE_STYLE;\n/**\n * @type {Text|null}\n */\n\nvar DEFAULT_TEXT_STYLE = null;\n/**\n * Get the default text style (or null if not yet set).\n * @return {Text|null} The default text style.\n */\n\nexport function getDefaultTextStyle() {\n  return DEFAULT_TEXT_STYLE;\n}\n/**\n * @type {Style|null}\n */\n\nvar DEFAULT_STYLE = null;\n/**\n * Get the default style (or null if not yet set).\n * @return {Style|null} The default style.\n */\n\nexport function getDefaultStyle() {\n  return DEFAULT_STYLE;\n}\n/**\n * @type {Array<Style>|null}\n */\n\nvar DEFAULT_STYLE_ARRAY = null;\n/**\n * Get the default style array (or null if not yet set).\n * @return {Array<Style>|null} The default style.\n */\n\nexport function getDefaultStyleArray() {\n  return DEFAULT_STYLE_ARRAY;\n}\n/**\n * Function that returns the scale needed to normalize an icon image to 32 pixels.\n * @param {import(\"../size.js\").Size} size Image size.\n * @return {number} Scale.\n */\n\nfunction scaleForSize(size) {\n  return 32 / Math.min(size[0], size[1]);\n}\n\nfunction createStyleDefaults() {\n  DEFAULT_COLOR = [255, 255, 255, 1];\n  DEFAULT_FILL_STYLE = new Fill({\n    color: DEFAULT_COLOR\n  });\n  DEFAULT_IMAGE_STYLE_ANCHOR = [20, 2];\n  DEFAULT_IMAGE_STYLE_ANCHOR_X_UNITS = IconAnchorUnits.PIXELS;\n  DEFAULT_IMAGE_STYLE_ANCHOR_Y_UNITS = IconAnchorUnits.PIXELS;\n  DEFAULT_IMAGE_STYLE_SIZE = [64, 64];\n  DEFAULT_IMAGE_STYLE_SRC = 'https://maps.google.com/mapfiles/kml/pushpin/ylw-pushpin.png';\n  DEFAULT_IMAGE_STYLE = new Icon({\n    anchor: DEFAULT_IMAGE_STYLE_ANCHOR,\n    anchorOrigin: IconOrigin.BOTTOM_LEFT,\n    anchorXUnits: DEFAULT_IMAGE_STYLE_ANCHOR_X_UNITS,\n    anchorYUnits: DEFAULT_IMAGE_STYLE_ANCHOR_Y_UNITS,\n    crossOrigin: 'anonymous',\n    rotation: 0,\n    scale: scaleForSize(DEFAULT_IMAGE_STYLE_SIZE),\n    size: DEFAULT_IMAGE_STYLE_SIZE,\n    src: DEFAULT_IMAGE_STYLE_SRC\n  });\n  DEFAULT_NO_IMAGE_STYLE = 'NO_IMAGE';\n  DEFAULT_STROKE_STYLE = new Stroke({\n    color: DEFAULT_COLOR,\n    width: 1\n  });\n  DEFAULT_TEXT_STROKE_STYLE = new Stroke({\n    color: [51, 51, 51, 1],\n    width: 2\n  });\n  DEFAULT_TEXT_STYLE = new Text({\n    font: 'bold 16px Helvetica',\n    fill: DEFAULT_FILL_STYLE,\n    stroke: DEFAULT_TEXT_STROKE_STYLE,\n    scale: 0.8\n  });\n  DEFAULT_STYLE = new Style({\n    fill: DEFAULT_FILL_STYLE,\n    image: DEFAULT_IMAGE_STYLE,\n    text: DEFAULT_TEXT_STYLE,\n    stroke: DEFAULT_STROKE_STYLE,\n    zIndex: 0\n  });\n  DEFAULT_STYLE_ARRAY = [DEFAULT_STYLE];\n}\n/**\n * @type {HTMLTextAreaElement}\n */\n\n\nvar TEXTAREA;\n/**\n * A function that takes a url `{string}` and returns a url `{string}`.\n * Might be used to change an icon path or to substitute a\n * data url obtained from a KMZ array buffer.\n *\n * @typedef {function(string):string} IconUrlFunction\n * @api\n */\n\n/**\n * Function that returns a url unchanged.\n * @param {string} href Input url.\n * @return {string} Output url.\n */\n\nfunction defaultIconUrlFunction(href) {\n  return href;\n}\n/**\n * @typedef {Object} Options\n * @property {boolean} [extractStyles=true] Extract styles from the KML.\n * @property {boolean} [showPointNames=true] Show names as labels for placemarks which contain points.\n * @property {Array<Style>} [defaultStyle] Default style. The\n * default default style is the same as Google Earth.\n * @property {boolean} [writeStyles=true] Write styles into KML.\n * @property {null|string} [crossOrigin='anonymous'] The `crossOrigin` attribute for loaded images. Note that you must provide a\n * `crossOrigin` value if you want to access pixel data with the Canvas renderer.\n * @property {IconUrlFunction} [iconUrlFunction] Function that takes a url string and returns a url string.\n * Might be used to change an icon path or to substitute a data url obtained from a KMZ array buffer.\n */\n\n/**\n * @classdesc\n * Feature format for reading and writing data in the KML format.\n *\n * {@link module:ol/format/KML~KML#readFeature} will read the first feature from\n * a KML source.\n *\n * MultiGeometries are converted into GeometryCollections if they are a mix of\n * geometry types, and into MultiPoint/MultiLineString/MultiPolygon if they are\n * all of the same type.\n *\n * Note that the KML format uses the URL() constructor. Older browsers such as IE\n * which do not support this will need a URL polyfill to be loaded before use.\n *\n * @api\n */\n\n\nvar KML =\n/** @class */\nfunction (_super) {\n  __extends(KML, _super);\n  /**\n   * @param {Options} [opt_options] Options.\n   */\n\n\n  function KML(opt_options) {\n    var _this = _super.call(this) || this;\n\n    var options = opt_options ? opt_options : {};\n\n    if (!DEFAULT_STYLE_ARRAY) {\n      createStyleDefaults();\n    }\n    /**\n     * @type {import(\"../proj/Projection.js\").default}\n     */\n\n\n    _this.dataProjection = getProjection('EPSG:4326');\n    /**\n     * @private\n     * @type {Array<Style>}\n     */\n\n    _this.defaultStyle_ = options.defaultStyle ? options.defaultStyle : DEFAULT_STYLE_ARRAY;\n    /**\n     * @private\n     * @type {boolean}\n     */\n\n    _this.extractStyles_ = options.extractStyles !== undefined ? options.extractStyles : true;\n    /**\n     * @type {boolean}\n     */\n\n    _this.writeStyles_ = options.writeStyles !== undefined ? options.writeStyles : true;\n    /**\n     * @private\n     * @type {!Object<string, (Array<Style>|string)>}\n     */\n\n    _this.sharedStyles_ = {};\n    /**\n     * @private\n     * @type {boolean}\n     */\n\n    _this.showPointNames_ = options.showPointNames !== undefined ? options.showPointNames : true;\n    /**\n     * @type {null|string}\n     */\n\n    _this.crossOrigin_ = options.crossOrigin !== undefined ? options.crossOrigin : 'anonymous';\n    /**\n     * @type {IconUrlFunction}\n     */\n\n    _this.iconUrlFunction_ = options.iconUrlFunction ? options.iconUrlFunction : defaultIconUrlFunction;\n    _this.supportedMediaTypes = ['application/vnd.google-earth.kml+xml'];\n    return _this;\n  }\n  /**\n   * @param {Node} node Node.\n   * @param {Array<*>} objectStack Object stack.\n   * @private\n   * @return {Array<Feature>|undefined} Features.\n   */\n\n\n  KML.prototype.readDocumentOrFolder_ = function (node, objectStack) {\n    // FIXME use scope somehow\n    var parsersNS = makeStructureNS(NAMESPACE_URIS, {\n      'Document': makeArrayExtender(this.readDocumentOrFolder_, this),\n      'Folder': makeArrayExtender(this.readDocumentOrFolder_, this),\n      'Placemark': makeArrayPusher(this.readPlacemark_, this),\n      'Style': this.readSharedStyle_.bind(this),\n      'StyleMap': this.readSharedStyleMap_.bind(this)\n    });\n    /** @type {Array<Feature>} */\n    // @ts-ignore\n\n    var features = pushParseAndPop([], parsersNS, node, objectStack, this);\n\n    if (features) {\n      return features;\n    } else {\n      return undefined;\n    }\n  };\n  /**\n   * @param {Element} node Node.\n   * @param {Array<*>} objectStack Object stack.\n   * @private\n   * @return {Feature|undefined} Feature.\n   */\n\n\n  KML.prototype.readPlacemark_ = function (node, objectStack) {\n    var object = pushParseAndPop({\n      'geometry': null\n    }, PLACEMARK_PARSERS, node, objectStack, this);\n\n    if (!object) {\n      return undefined;\n    }\n\n    var feature = new Feature();\n    var id = node.getAttribute('id');\n\n    if (id !== null) {\n      feature.setId(id);\n    }\n\n    var options =\n    /** @type {import(\"./Feature.js\").ReadOptions} */\n    objectStack[0];\n    var geometry = object['geometry'];\n\n    if (geometry) {\n      transformGeometryWithOptions(geometry, false, options);\n    }\n\n    feature.setGeometry(geometry);\n    delete object['geometry'];\n\n    if (this.extractStyles_) {\n      var style = object['Style'];\n      var styleUrl = object['styleUrl'];\n      var styleFunction = createFeatureStyleFunction(style, styleUrl, this.defaultStyle_, this.sharedStyles_, this.showPointNames_);\n      feature.setStyle(styleFunction);\n    }\n\n    delete object['Style']; // we do not remove the styleUrl property from the object, so it\n    // gets stored on feature when setProperties is called\n\n    feature.setProperties(object, true);\n    return feature;\n  };\n  /**\n   * @param {Element} node Node.\n   * @param {Array<*>} objectStack Object stack.\n   * @private\n   */\n\n\n  KML.prototype.readSharedStyle_ = function (node, objectStack) {\n    var id = node.getAttribute('id');\n\n    if (id !== null) {\n      var style = readStyle.call(this, node, objectStack);\n\n      if (style) {\n        var styleUri = void 0;\n        var baseURI = node.baseURI;\n\n        if (!baseURI || baseURI == 'about:blank') {\n          baseURI = window.location.href;\n        }\n\n        if (baseURI) {\n          var url = new URL('#' + id, baseURI);\n          styleUri = url.href;\n        } else {\n          styleUri = '#' + id;\n        }\n\n        this.sharedStyles_[styleUri] = style;\n      }\n    }\n  };\n  /**\n   * @param {Element} node Node.\n   * @param {Array<*>} objectStack Object stack.\n   * @private\n   */\n\n\n  KML.prototype.readSharedStyleMap_ = function (node, objectStack) {\n    var id = node.getAttribute('id');\n\n    if (id === null) {\n      return;\n    }\n\n    var styleMapValue = readStyleMapValue.call(this, node, objectStack);\n\n    if (!styleMapValue) {\n      return;\n    }\n\n    var styleUri;\n    var baseURI = node.baseURI;\n\n    if (!baseURI || baseURI == 'about:blank') {\n      baseURI = window.location.href;\n    }\n\n    if (baseURI) {\n      var url = new URL('#' + id, baseURI);\n      styleUri = url.href;\n    } else {\n      styleUri = '#' + id;\n    }\n\n    this.sharedStyles_[styleUri] = styleMapValue;\n  };\n  /**\n   * @param {Element} node Node.\n   * @param {import(\"./Feature.js\").ReadOptions} [opt_options] Options.\n   * @return {import(\"../Feature.js\").default} Feature.\n   */\n\n\n  KML.prototype.readFeatureFromNode = function (node, opt_options) {\n    if (!includes(NAMESPACE_URIS, node.namespaceURI)) {\n      return null;\n    }\n\n    var feature = this.readPlacemark_(node, [this.getReadOptions(node, opt_options)]);\n\n    if (feature) {\n      return feature;\n    } else {\n      return null;\n    }\n  };\n  /**\n   * @protected\n   * @param {Element} node Node.\n   * @param {import(\"./Feature.js\").ReadOptions} [opt_options] Options.\n   * @return {Array<import(\"../Feature.js\").default>} Features.\n   */\n\n\n  KML.prototype.readFeaturesFromNode = function (node, opt_options) {\n    if (!includes(NAMESPACE_URIS, node.namespaceURI)) {\n      return [];\n    }\n\n    var features;\n    var localName = node.localName;\n\n    if (localName == 'Document' || localName == 'Folder') {\n      features = this.readDocumentOrFolder_(node, [this.getReadOptions(node, opt_options)]);\n\n      if (features) {\n        return features;\n      } else {\n        return [];\n      }\n    } else if (localName == 'Placemark') {\n      var feature = this.readPlacemark_(node, [this.getReadOptions(node, opt_options)]);\n\n      if (feature) {\n        return [feature];\n      } else {\n        return [];\n      }\n    } else if (localName == 'kml') {\n      features = [];\n\n      for (var n = node.firstElementChild; n; n = n.nextElementSibling) {\n        var fs = this.readFeaturesFromNode(n, opt_options);\n\n        if (fs) {\n          extend(features, fs);\n        }\n      }\n\n      return features;\n    } else {\n      return [];\n    }\n  };\n  /**\n   * Read the name of the KML.\n   *\n   * @param {Document|Element|string} source Source.\n   * @return {string|undefined} Name.\n   * @api\n   */\n\n\n  KML.prototype.readName = function (source) {\n    if (!source) {\n      return undefined;\n    } else if (typeof source === 'string') {\n      var doc = parse(source);\n      return this.readNameFromDocument(doc);\n    } else if (isDocument(source)) {\n      return this.readNameFromDocument(\n      /** @type {Document} */\n      source);\n    } else {\n      return this.readNameFromNode(\n      /** @type {Element} */\n      source);\n    }\n  };\n  /**\n   * @param {Document} doc Document.\n   * @return {string|undefined} Name.\n   */\n\n\n  KML.prototype.readNameFromDocument = function (doc) {\n    for (var n =\n    /** @type {Node} */\n    doc.firstChild; n; n = n.nextSibling) {\n      if (n.nodeType == Node.ELEMENT_NODE) {\n        var name_1 = this.readNameFromNode(\n        /** @type {Element} */\n        n);\n\n        if (name_1) {\n          return name_1;\n        }\n      }\n    }\n\n    return undefined;\n  };\n  /**\n   * @param {Element} node Node.\n   * @return {string|undefined} Name.\n   */\n\n\n  KML.prototype.readNameFromNode = function (node) {\n    for (var n = node.firstElementChild; n; n = n.nextElementSibling) {\n      if (includes(NAMESPACE_URIS, n.namespaceURI) && n.localName == 'name') {\n        return readString(n);\n      }\n    }\n\n    for (var n = node.firstElementChild; n; n = n.nextElementSibling) {\n      var localName = n.localName;\n\n      if (includes(NAMESPACE_URIS, n.namespaceURI) && (localName == 'Document' || localName == 'Folder' || localName == 'Placemark' || localName == 'kml')) {\n        var name_2 = this.readNameFromNode(n);\n\n        if (name_2) {\n          return name_2;\n        }\n      }\n    }\n\n    return undefined;\n  };\n  /**\n   * Read the network links of the KML.\n   *\n   * @param {Document|Element|string} source Source.\n   * @return {Array<Object>} Network links.\n   * @api\n   */\n\n\n  KML.prototype.readNetworkLinks = function (source) {\n    var networkLinks = [];\n\n    if (typeof source === 'string') {\n      var doc = parse(source);\n      extend(networkLinks, this.readNetworkLinksFromDocument(doc));\n    } else if (isDocument(source)) {\n      extend(networkLinks, this.readNetworkLinksFromDocument(\n      /** @type {Document} */\n      source));\n    } else {\n      extend(networkLinks, this.readNetworkLinksFromNode(\n      /** @type {Element} */\n      source));\n    }\n\n    return networkLinks;\n  };\n  /**\n   * @param {Document} doc Document.\n   * @return {Array<Object>} Network links.\n   */\n\n\n  KML.prototype.readNetworkLinksFromDocument = function (doc) {\n    var networkLinks = [];\n\n    for (var n =\n    /** @type {Node} */\n    doc.firstChild; n; n = n.nextSibling) {\n      if (n.nodeType == Node.ELEMENT_NODE) {\n        extend(networkLinks, this.readNetworkLinksFromNode(\n        /** @type {Element} */\n        n));\n      }\n    }\n\n    return networkLinks;\n  };\n  /**\n   * @param {Element} node Node.\n   * @return {Array<Object>} Network links.\n   */\n\n\n  KML.prototype.readNetworkLinksFromNode = function (node) {\n    var networkLinks = [];\n\n    for (var n = node.firstElementChild; n; n = n.nextElementSibling) {\n      if (includes(NAMESPACE_URIS, n.namespaceURI) && n.localName == 'NetworkLink') {\n        var obj = pushParseAndPop({}, NETWORK_LINK_PARSERS, n, []);\n        networkLinks.push(obj);\n      }\n    }\n\n    for (var n = node.firstElementChild; n; n = n.nextElementSibling) {\n      var localName = n.localName;\n\n      if (includes(NAMESPACE_URIS, n.namespaceURI) && (localName == 'Document' || localName == 'Folder' || localName == 'kml')) {\n        extend(networkLinks, this.readNetworkLinksFromNode(n));\n      }\n    }\n\n    return networkLinks;\n  };\n  /**\n   * Read the regions of the KML.\n   *\n   * @param {Document|Element|string} source Source.\n   * @return {Array<Object>} Regions.\n   * @api\n   */\n\n\n  KML.prototype.readRegion = function (source) {\n    var regions = [];\n\n    if (typeof source === 'string') {\n      var doc = parse(source);\n      extend(regions, this.readRegionFromDocument(doc));\n    } else if (isDocument(source)) {\n      extend(regions, this.readRegionFromDocument(\n      /** @type {Document} */\n      source));\n    } else {\n      extend(regions, this.readRegionFromNode(\n      /** @type {Element} */\n      source));\n    }\n\n    return regions;\n  };\n  /**\n   * @param {Document} doc Document.\n   * @return {Array<Object>} Region.\n   */\n\n\n  KML.prototype.readRegionFromDocument = function (doc) {\n    var regions = [];\n\n    for (var n =\n    /** @type {Node} */\n    doc.firstChild; n; n = n.nextSibling) {\n      if (n.nodeType == Node.ELEMENT_NODE) {\n        extend(regions, this.readRegionFromNode(\n        /** @type {Element} */\n        n));\n      }\n    }\n\n    return regions;\n  };\n  /**\n   * @param {Element} node Node.\n   * @return {Array<Object>} Region.\n   * @api\n   */\n\n\n  KML.prototype.readRegionFromNode = function (node) {\n    var regions = [];\n\n    for (var n = node.firstElementChild; n; n = n.nextElementSibling) {\n      if (includes(NAMESPACE_URIS, n.namespaceURI) && n.localName == 'Region') {\n        var obj = pushParseAndPop({}, REGION_PARSERS, n, []);\n        regions.push(obj);\n      }\n    }\n\n    for (var n = node.firstElementChild; n; n = n.nextElementSibling) {\n      var localName = n.localName;\n\n      if (includes(NAMESPACE_URIS, n.namespaceURI) && (localName == 'Document' || localName == 'Folder' || localName == 'kml')) {\n        extend(regions, this.readRegionFromNode(n));\n      }\n    }\n\n    return regions;\n  };\n  /**\n   * Encode an array of features in the KML format as an XML node. GeometryCollections,\n   * MultiPoints, MultiLineStrings, and MultiPolygons are output as MultiGeometries.\n   *\n   * @param {Array<Feature>} features Features.\n   * @param {import(\"./Feature.js\").WriteOptions} [opt_options] Options.\n   * @return {Node} Node.\n   * @api\n   */\n\n\n  KML.prototype.writeFeaturesNode = function (features, opt_options) {\n    opt_options = this.adaptOptions(opt_options);\n    var kml = createElementNS(NAMESPACE_URIS[4], 'kml');\n    var xmlnsUri = 'http://www.w3.org/2000/xmlns/';\n    kml.setAttributeNS(xmlnsUri, 'xmlns:gx', GX_NAMESPACE_URIS[0]);\n    kml.setAttributeNS(xmlnsUri, 'xmlns:xsi', XML_SCHEMA_INSTANCE_URI);\n    kml.setAttributeNS(XML_SCHEMA_INSTANCE_URI, 'xsi:schemaLocation', SCHEMA_LOCATION);\n    var\n    /** @type {import(\"../xml.js\").NodeStackItem} */\n    context = {\n      node: kml\n    };\n    /** @type {!Object<string, (Array<Feature>|Feature|undefined)>} */\n\n    var properties = {};\n\n    if (features.length > 1) {\n      properties['Document'] = features;\n    } else if (features.length == 1) {\n      properties['Placemark'] = features[0];\n    }\n\n    var orderedKeys = KML_SEQUENCE[kml.namespaceURI];\n    var values = makeSequence(properties, orderedKeys);\n    pushSerializeAndPop(context, KML_SERIALIZERS, OBJECT_PROPERTY_NODE_FACTORY, values, [opt_options], orderedKeys, this);\n    return kml;\n  };\n\n  return KML;\n}(XMLFeature);\n/**\n * @param {Style|undefined} foundStyle Style.\n * @param {string} name Name.\n * @return {Style} style Style.\n */\n\n\nfunction createNameStyleFunction(foundStyle, name) {\n  var textOffset = [0, 0];\n  var textAlign = 'start';\n  var imageStyle = foundStyle.getImage();\n\n  if (imageStyle) {\n    var imageSize = imageStyle.getSize();\n\n    if (imageSize && imageSize.length == 2) {\n      var imageScale = imageStyle.getScaleArray();\n      var anchor = imageStyle.getAnchor(); // Offset the label to be centered to the right of the icon,\n      // if there is one.\n\n      textOffset[0] = imageScale[0] * (imageSize[0] - anchor[0]);\n      textOffset[1] = imageScale[1] * (imageSize[1] / 2 - anchor[1]);\n      textAlign = 'left';\n    }\n  }\n\n  var textStyle = foundStyle.getText();\n\n  if (textStyle) {\n    // clone the text style, customizing it with name, alignments and offset.\n    // Note that kml does not support many text options that OpenLayers does (rotation, textBaseline).\n    textStyle = textStyle.clone();\n    textStyle.setFont(textStyle.getFont() || DEFAULT_TEXT_STYLE.getFont());\n    textStyle.setScale(textStyle.getScale() || DEFAULT_TEXT_STYLE.getScale());\n    textStyle.setFill(textStyle.getFill() || DEFAULT_TEXT_STYLE.getFill());\n    textStyle.setStroke(textStyle.getStroke() || DEFAULT_TEXT_STROKE_STYLE);\n  } else {\n    textStyle = DEFAULT_TEXT_STYLE.clone();\n  }\n\n  textStyle.setText(name);\n  textStyle.setOffsetX(textOffset[0]);\n  textStyle.setOffsetY(textOffset[1]);\n  textStyle.setTextAlign(textAlign);\n  var nameStyle = new Style({\n    image: imageStyle,\n    text: textStyle\n  });\n  return nameStyle;\n}\n/**\n * @param {Array<Style>|undefined} style Style.\n * @param {string} styleUrl Style URL.\n * @param {Array<Style>} defaultStyle Default style.\n * @param {!Object<string, (Array<Style>|string)>} sharedStyles Shared styles.\n * @param {boolean|undefined} showPointNames true to show names for point placemarks.\n * @return {import(\"../style/Style.js\").StyleFunction} Feature style function.\n */\n\n\nfunction createFeatureStyleFunction(style, styleUrl, defaultStyle, sharedStyles, showPointNames) {\n  return (\n    /**\n     * @param {Feature} feature feature.\n     * @param {number} resolution Resolution.\n     * @return {Array<Style>|Style} Style.\n     */\n    function (feature, resolution) {\n      var drawName = showPointNames;\n      var name = '';\n      var multiGeometryPoints = [];\n\n      if (drawName) {\n        var geometry = feature.getGeometry();\n\n        if (geometry) {\n          if (geometry instanceof GeometryCollection) {\n            multiGeometryPoints = geometry.getGeometriesArrayRecursive().filter(function (geometry) {\n              var type = geometry.getType();\n              return type === GeometryType.POINT || type === GeometryType.MULTI_POINT;\n            });\n            drawName = multiGeometryPoints.length > 0;\n          } else {\n            var type = geometry.getType();\n            drawName = type === GeometryType.POINT || type === GeometryType.MULTI_POINT;\n          }\n        }\n      }\n\n      if (drawName) {\n        name =\n        /** @type {string} */\n        feature.get('name');\n        drawName = drawName && !!name; // convert any html character codes\n\n        if (drawName && name.search(/&[^&]+;/) > -1) {\n          if (!TEXTAREA) {\n            TEXTAREA = document.createElement('textarea');\n          }\n\n          TEXTAREA.innerHTML = name;\n          name = TEXTAREA.value;\n        }\n      }\n\n      var featureStyle = defaultStyle;\n\n      if (style) {\n        featureStyle = style;\n      } else if (styleUrl) {\n        featureStyle = findStyle(styleUrl, defaultStyle, sharedStyles);\n      }\n\n      if (drawName) {\n        var nameStyle = createNameStyleFunction(featureStyle[0], name);\n\n        if (multiGeometryPoints.length > 0) {\n          // in multigeometries restrict the name style to points and create a\n          // style without image or text for geometries requiring fill or stroke\n          // including any polygon specific style if there is one\n          nameStyle.setGeometry(new GeometryCollection(multiGeometryPoints));\n          var baseStyle = new Style({\n            geometry: featureStyle[0].getGeometry(),\n            image: null,\n            fill: featureStyle[0].getFill(),\n            stroke: featureStyle[0].getStroke(),\n            text: null\n          });\n          return [nameStyle, baseStyle].concat(featureStyle.slice(1));\n        }\n\n        return nameStyle;\n      }\n\n      return featureStyle;\n    }\n  );\n}\n/**\n * @param {Array<Style>|string|undefined} styleValue Style value.\n * @param {Array<Style>} defaultStyle Default style.\n * @param {!Object<string, (Array<Style>|string)>} sharedStyles\n * Shared styles.\n * @return {Array<Style>} Style.\n */\n\n\nfunction findStyle(styleValue, defaultStyle, sharedStyles) {\n  if (Array.isArray(styleValue)) {\n    return styleValue;\n  } else if (typeof styleValue === 'string') {\n    return findStyle(sharedStyles[styleValue], defaultStyle, sharedStyles);\n  } else {\n    return defaultStyle;\n  }\n}\n/**\n * @param {Node} node Node.\n * @return {import(\"../color.js\").Color|undefined} Color.\n */\n\n\nfunction readColor(node) {\n  var s = getAllTextContent(node, false); // The KML specification states that colors should not include a leading `#`\n  // but we tolerate them.\n\n  var m = /^\\s*#?\\s*([0-9A-Fa-f]{8})\\s*$/.exec(s);\n\n  if (m) {\n    var hexColor = m[1];\n    return [parseInt(hexColor.substr(6, 2), 16), parseInt(hexColor.substr(4, 2), 16), parseInt(hexColor.substr(2, 2), 16), parseInt(hexColor.substr(0, 2), 16) / 255];\n  } else {\n    return undefined;\n  }\n}\n/**\n * @param {Node} node Node.\n * @return {Array<number>|undefined} Flat coordinates.\n */\n\n\nexport function readFlatCoordinates(node) {\n  var s = getAllTextContent(node, false);\n  var flatCoordinates = []; // The KML specification states that coordinate tuples should not include\n  // spaces, but we tolerate them.\n\n  s = s.replace(/\\s*,\\s*/g, ',');\n  var re = /^\\s*([+\\-]?\\d*\\.?\\d+(?:e[+\\-]?\\d+)?),([+\\-]?\\d*\\.?\\d+(?:e[+\\-]?\\d+)?)(?:\\s+|,|$)(?:([+\\-]?\\d*\\.?\\d+(?:e[+\\-]?\\d+)?)(?:\\s+|$))?\\s*/i;\n  var m;\n\n  while (m = re.exec(s)) {\n    var x = parseFloat(m[1]);\n    var y = parseFloat(m[2]);\n    var z = m[3] ? parseFloat(m[3]) : 0;\n    flatCoordinates.push(x, y, z);\n    s = s.substr(m[0].length);\n  }\n\n  if (s !== '') {\n    return undefined;\n  }\n\n  return flatCoordinates;\n}\n/**\n * @param {Node} node Node.\n * @return {string} URI.\n */\n\nfunction readURI(node) {\n  var s = getAllTextContent(node, false).trim();\n  var baseURI = node.baseURI;\n\n  if (!baseURI || baseURI == 'about:blank') {\n    baseURI = window.location.href;\n  }\n\n  if (baseURI) {\n    var url = new URL(s, baseURI);\n    return url.href;\n  } else {\n    return s;\n  }\n}\n/**\n * @param {Node} node Node.\n * @return {string} URI.\n */\n\n\nfunction readStyleURL(node) {\n  // KML files in the wild occasionally forget the leading\n  // `#` on styleUrlsdefined in the same document.\n  var s = getAllTextContent(node, false).trim().replace(/^(?!.*#)/, '#');\n  var baseURI = node.baseURI;\n\n  if (!baseURI || baseURI == 'about:blank') {\n    baseURI = window.location.href;\n  }\n\n  if (baseURI) {\n    var url = new URL(s, baseURI);\n    return url.href;\n  } else {\n    return s;\n  }\n}\n/**\n * @param {Element} node Node.\n * @return {Vec2} Vec2.\n */\n\n\nfunction readVec2(node) {\n  var xunits = node.getAttribute('xunits');\n  var yunits = node.getAttribute('yunits');\n  var origin;\n\n  if (xunits !== 'insetPixels') {\n    if (yunits !== 'insetPixels') {\n      origin = IconOrigin.BOTTOM_LEFT;\n    } else {\n      origin = IconOrigin.TOP_LEFT;\n    }\n  } else {\n    if (yunits !== 'insetPixels') {\n      origin = IconOrigin.BOTTOM_RIGHT;\n    } else {\n      origin = IconOrigin.TOP_RIGHT;\n    }\n  }\n\n  return {\n    x: parseFloat(node.getAttribute('x')),\n    xunits: ICON_ANCHOR_UNITS_MAP[xunits],\n    y: parseFloat(node.getAttribute('y')),\n    yunits: ICON_ANCHOR_UNITS_MAP[yunits],\n    origin: origin\n  };\n}\n/**\n * @param {Node} node Node.\n * @return {number|undefined} Scale.\n */\n\n\nfunction readScale(node) {\n  return readDecimal(node);\n}\n/**\n * @const\n * @type {Object<string, Object<string, import(\"../xml.js\").Parser>>}\n */\n// @ts-ignore\n\n\nvar STYLE_MAP_PARSERS = makeStructureNS(NAMESPACE_URIS, {\n  'Pair': pairDataParser\n});\n/**\n * @this {KML}\n * @param {Element} node Node.\n * @param {Array<*>} objectStack Object stack.\n * @return {Array<Style>|string|undefined} StyleMap.\n */\n\nfunction readStyleMapValue(node, objectStack) {\n  return pushParseAndPop(undefined, STYLE_MAP_PARSERS, node, objectStack, this);\n}\n/**\n * @const\n * @type {Object<string, Object<string, import(\"../xml.js\").Parser>>}\n */\n// @ts-ignore\n\n\nvar ICON_STYLE_PARSERS = makeStructureNS(NAMESPACE_URIS, {\n  'Icon': makeObjectPropertySetter(readIcon),\n  'color': makeObjectPropertySetter(readColor),\n  'heading': makeObjectPropertySetter(readDecimal),\n  'hotSpot': makeObjectPropertySetter(readVec2),\n  'scale': makeObjectPropertySetter(readScale)\n});\n/**\n * @this {KML}\n * @param {Element} node Node.\n * @param {Array<*>} objectStack Object stack.\n */\n\nfunction iconStyleParser(node, objectStack) {\n  // FIXME refreshMode\n  // FIXME refreshInterval\n  // FIXME viewRefreshTime\n  // FIXME viewBoundScale\n  // FIXME viewFormat\n  // FIXME httpQuery\n  var object = pushParseAndPop({}, ICON_STYLE_PARSERS, node, objectStack);\n\n  if (!object) {\n    return;\n  }\n\n  var styleObject =\n  /** @type {Object} */\n  objectStack[objectStack.length - 1];\n  var IconObject = 'Icon' in object ? object['Icon'] : {};\n  var drawIcon = !('Icon' in object) || Object.keys(IconObject).length > 0;\n  var src;\n  var href =\n  /** @type {string|undefined} */\n  IconObject['href'];\n\n  if (href) {\n    src = href;\n  } else if (drawIcon) {\n    src = DEFAULT_IMAGE_STYLE_SRC;\n  }\n\n  var anchor, anchorXUnits, anchorYUnits;\n  var anchorOrigin = IconOrigin.BOTTOM_LEFT;\n  var hotSpot =\n  /** @type {Vec2|undefined} */\n  object['hotSpot'];\n\n  if (hotSpot) {\n    anchor = [hotSpot.x, hotSpot.y];\n    anchorXUnits = hotSpot.xunits;\n    anchorYUnits = hotSpot.yunits;\n    anchorOrigin = hotSpot.origin;\n  } else if (/^http:\\/\\/maps\\.(?:google|gstatic)\\.com\\//.test(src)) {\n    // Google hotspots from https://kml4earth.appspot.com/icons.html#notes\n    if (/pushpin/.test(src)) {\n      anchor = DEFAULT_IMAGE_STYLE_ANCHOR;\n      anchorXUnits = DEFAULT_IMAGE_STYLE_ANCHOR_X_UNITS;\n      anchorYUnits = DEFAULT_IMAGE_STYLE_ANCHOR_Y_UNITS;\n    } else if (/arrow-reverse/.test(src)) {\n      anchor = [54, 42];\n      anchorXUnits = DEFAULT_IMAGE_STYLE_ANCHOR_X_UNITS;\n      anchorYUnits = DEFAULT_IMAGE_STYLE_ANCHOR_Y_UNITS;\n    } else if (/paddle/.test(src)) {\n      anchor = [32, 1];\n      anchorXUnits = DEFAULT_IMAGE_STYLE_ANCHOR_X_UNITS;\n      anchorYUnits = DEFAULT_IMAGE_STYLE_ANCHOR_Y_UNITS;\n    }\n  }\n\n  var offset;\n  var x =\n  /** @type {number|undefined} */\n  IconObject['x'];\n  var y =\n  /** @type {number|undefined} */\n  IconObject['y'];\n\n  if (x !== undefined && y !== undefined) {\n    offset = [x, y];\n  }\n\n  var size;\n  var w =\n  /** @type {number|undefined} */\n  IconObject['w'];\n  var h =\n  /** @type {number|undefined} */\n  IconObject['h'];\n\n  if (w !== undefined && h !== undefined) {\n    size = [w, h];\n  }\n\n  var rotation;\n  var heading =\n  /** @type {number} */\n  object['heading'];\n\n  if (heading !== undefined) {\n    rotation = toRadians(heading);\n  }\n\n  var scale =\n  /** @type {number|undefined} */\n  object['scale'];\n  var color =\n  /** @type {Array<number>|undefined} */\n  object['color'];\n\n  if (drawIcon) {\n    if (src == DEFAULT_IMAGE_STYLE_SRC) {\n      size = DEFAULT_IMAGE_STYLE_SIZE;\n    }\n\n    var imageStyle_1 = new Icon({\n      anchor: anchor,\n      anchorOrigin: anchorOrigin,\n      anchorXUnits: anchorXUnits,\n      anchorYUnits: anchorYUnits,\n      crossOrigin: this.crossOrigin_,\n      offset: offset,\n      offsetOrigin: IconOrigin.BOTTOM_LEFT,\n      rotation: rotation,\n      scale: scale,\n      size: size,\n      src: this.iconUrlFunction_(src),\n      color: color\n    });\n    var imageScale_1 = imageStyle_1.getScaleArray()[0];\n    var imageSize = imageStyle_1.getSize();\n\n    if (imageSize === null) {\n      var imageState = imageStyle_1.getImageState();\n\n      if (imageState === ImageState.IDLE || imageState === ImageState.LOADING) {\n        var listener_1 = function listener_1() {\n          var imageState = imageStyle_1.getImageState();\n\n          if (!(imageState === ImageState.IDLE || imageState === ImageState.LOADING)) {\n            var imageSize_1 = imageStyle_1.getSize();\n\n            if (imageSize_1 && imageSize_1.length == 2) {\n              var resizeScale = scaleForSize(imageSize_1);\n              imageStyle_1.setScale(imageScale_1 * resizeScale);\n            }\n\n            imageStyle_1.unlistenImageChange(listener_1);\n          }\n        };\n\n        imageStyle_1.listenImageChange(listener_1);\n\n        if (imageState === ImageState.IDLE) {\n          imageStyle_1.load();\n        }\n      }\n    } else if (imageSize.length == 2) {\n      var resizeScale = scaleForSize(imageSize);\n      imageStyle_1.setScale(imageScale_1 * resizeScale);\n    }\n\n    styleObject['imageStyle'] = imageStyle_1;\n  } else {\n    // handle the case when we explicitly want to draw no icon.\n    styleObject['imageStyle'] = DEFAULT_NO_IMAGE_STYLE;\n  }\n}\n/**\n * @const\n * @type {Object<string, Object<string, import(\"../xml.js\").Parser>>}\n */\n// @ts-ignore\n\n\nvar LABEL_STYLE_PARSERS = makeStructureNS(NAMESPACE_URIS, {\n  'color': makeObjectPropertySetter(readColor),\n  'scale': makeObjectPropertySetter(readScale)\n});\n/**\n * @param {Element} node Node.\n * @param {Array<*>} objectStack Object stack.\n */\n\nfunction labelStyleParser(node, objectStack) {\n  // FIXME colorMode\n  var object = pushParseAndPop({}, LABEL_STYLE_PARSERS, node, objectStack);\n\n  if (!object) {\n    return;\n  }\n\n  var styleObject = objectStack[objectStack.length - 1];\n  var textStyle = new Text({\n    fill: new Fill({\n      color:\n      /** @type {import(\"../color.js\").Color} */\n      'color' in object ? object['color'] : DEFAULT_COLOR\n    }),\n    scale:\n    /** @type {number|undefined} */\n    object['scale']\n  });\n  styleObject['textStyle'] = textStyle;\n}\n/**\n * @const\n * @type {Object<string, Object<string, import(\"../xml.js\").Parser>>}\n */\n// @ts-ignore\n\n\nvar LINE_STYLE_PARSERS = makeStructureNS(NAMESPACE_URIS, {\n  'color': makeObjectPropertySetter(readColor),\n  'width': makeObjectPropertySetter(readDecimal)\n});\n/**\n * @param {Element} node Node.\n * @param {Array<*>} objectStack Object stack.\n */\n\nfunction lineStyleParser(node, objectStack) {\n  // FIXME colorMode\n  // FIXME gx:outerColor\n  // FIXME gx:outerWidth\n  // FIXME gx:physicalWidth\n  // FIXME gx:labelVisibility\n  var object = pushParseAndPop({}, LINE_STYLE_PARSERS, node, objectStack);\n\n  if (!object) {\n    return;\n  }\n\n  var styleObject = objectStack[objectStack.length - 1];\n  var strokeStyle = new Stroke({\n    color:\n    /** @type {import(\"../color.js\").Color} */\n    'color' in object ? object['color'] : DEFAULT_COLOR,\n    width:\n    /** @type {number} */\n    'width' in object ? object['width'] : 1\n  });\n  styleObject['strokeStyle'] = strokeStyle;\n}\n/**\n * @const\n * @type {Object<string, Object<string, import(\"../xml.js\").Parser>>}\n */\n// @ts-ignore\n\n\nvar POLY_STYLE_PARSERS = makeStructureNS(NAMESPACE_URIS, {\n  'color': makeObjectPropertySetter(readColor),\n  'fill': makeObjectPropertySetter(readBoolean),\n  'outline': makeObjectPropertySetter(readBoolean)\n});\n/**\n * @param {Element} node Node.\n * @param {Array<*>} objectStack Object stack.\n */\n\nfunction polyStyleParser(node, objectStack) {\n  // FIXME colorMode\n  var object = pushParseAndPop({}, POLY_STYLE_PARSERS, node, objectStack);\n\n  if (!object) {\n    return;\n  }\n\n  var styleObject = objectStack[objectStack.length - 1];\n  var fillStyle = new Fill({\n    color:\n    /** @type {import(\"../color.js\").Color} */\n    'color' in object ? object['color'] : DEFAULT_COLOR\n  });\n  styleObject['fillStyle'] = fillStyle;\n  var fill =\n  /** @type {boolean|undefined} */\n  object['fill'];\n\n  if (fill !== undefined) {\n    styleObject['fill'] = fill;\n  }\n\n  var outline =\n  /** @type {boolean|undefined} */\n  object['outline'];\n\n  if (outline !== undefined) {\n    styleObject['outline'] = outline;\n  }\n}\n/**\n * @const\n * @type {Object<string, Object<string, import(\"../xml.js\").Parser>>}\n */\n// @ts-ignore\n\n\nvar FLAT_LINEAR_RING_PARSERS = makeStructureNS(NAMESPACE_URIS, {\n  'coordinates': makeReplacer(readFlatCoordinates)\n});\n/**\n * @param {Element} node Node.\n * @param {Array<*>} objectStack Object stack.\n * @return {Array<number>} LinearRing flat coordinates.\n */\n\nfunction readFlatLinearRing(node, objectStack) {\n  return pushParseAndPop(null, FLAT_LINEAR_RING_PARSERS, node, objectStack);\n}\n/**\n * @param {Node} node Node.\n * @param {Array<*>} objectStack Object stack.\n */\n\n\nfunction gxCoordParser(node, objectStack) {\n  var gxTrackObject =\n  /** @type {GxTrackObject} */\n  objectStack[objectStack.length - 1];\n  var coordinates = gxTrackObject.coordinates;\n  var s = getAllTextContent(node, false);\n  var re = /^\\s*([+\\-]?\\d+(?:\\.\\d*)?(?:e[+\\-]?\\d*)?)\\s+([+\\-]?\\d+(?:\\.\\d*)?(?:e[+\\-]?\\d*)?)\\s+([+\\-]?\\d+(?:\\.\\d*)?(?:e[+\\-]?\\d*)?)\\s*$/i;\n  var m = re.exec(s);\n\n  if (m) {\n    var x = parseFloat(m[1]);\n    var y = parseFloat(m[2]);\n    var z = parseFloat(m[3]);\n    coordinates.push([x, y, z]);\n  } else {\n    coordinates.push([]);\n  }\n}\n/**\n * @const\n * @type {Object<string, Object<string, import(\"../xml.js\").Parser>>}\n */\n// @ts-ignore\n\n\nvar GX_MULTITRACK_GEOMETRY_PARSERS = makeStructureNS(GX_NAMESPACE_URIS, {\n  'Track': makeArrayPusher(readGxTrack)\n});\n/**\n * @param {Element} node Node.\n * @param {Array<*>} objectStack Object stack.\n * @return {MultiLineString|undefined} MultiLineString.\n */\n\nfunction readGxMultiTrack(node, objectStack) {\n  var lineStrings = pushParseAndPop([], GX_MULTITRACK_GEOMETRY_PARSERS, node, objectStack);\n\n  if (!lineStrings) {\n    return undefined;\n  }\n\n  return new MultiLineString(lineStrings);\n}\n/**\n * @const\n * @type {Object<string, Object<string, import(\"../xml.js\").Parser>>}\n */\n// @ts-ignore\n\n\nvar GX_TRACK_PARSERS = makeStructureNS(NAMESPACE_URIS, {\n  'when': whenParser\n}, makeStructureNS(GX_NAMESPACE_URIS, {\n  'coord': gxCoordParser\n}));\n/**\n * @param {Element} node Node.\n * @param {Array<*>} objectStack Object stack.\n * @return {LineString|undefined} LineString.\n */\n\nfunction readGxTrack(node, objectStack) {\n  var gxTrackObject = pushParseAndPop(\n  /** @type {GxTrackObject} */\n  {\n    coordinates: [],\n    whens: []\n  }, GX_TRACK_PARSERS, node, objectStack);\n\n  if (!gxTrackObject) {\n    return undefined;\n  }\n\n  var flatCoordinates = [];\n  var coordinates = gxTrackObject.coordinates;\n  var whens = gxTrackObject.whens;\n\n  for (var i = 0, ii = Math.min(coordinates.length, whens.length); i < ii; ++i) {\n    if (coordinates[i].length == 3) {\n      flatCoordinates.push(coordinates[i][0], coordinates[i][1], coordinates[i][2], whens[i]);\n    }\n  }\n\n  return new LineString(flatCoordinates, GeometryLayout.XYZM);\n}\n/**\n * @const\n * @type {Object<string, Object<string, import(\"../xml.js\").Parser>>}\n */\n// @ts-ignore\n\n\nvar ICON_PARSERS = makeStructureNS(NAMESPACE_URIS, {\n  'href': makeObjectPropertySetter(readURI)\n}, makeStructureNS(GX_NAMESPACE_URIS, {\n  'x': makeObjectPropertySetter(readDecimal),\n  'y': makeObjectPropertySetter(readDecimal),\n  'w': makeObjectPropertySetter(readDecimal),\n  'h': makeObjectPropertySetter(readDecimal)\n}));\n/**\n * @param {Element} node Node.\n * @param {Array<*>} objectStack Object stack.\n * @return {Object} Icon object.\n */\n\nfunction readIcon(node, objectStack) {\n  var iconObject = pushParseAndPop({}, ICON_PARSERS, node, objectStack);\n\n  if (iconObject) {\n    return iconObject;\n  } else {\n    return null;\n  }\n}\n/**\n * @const\n * @type {Object<string, Object<string, import(\"../xml.js\").Parser>>}\n */\n// @ts-ignore\n\n\nvar GEOMETRY_FLAT_COORDINATES_PARSERS = makeStructureNS(NAMESPACE_URIS, {\n  'coordinates': makeReplacer(readFlatCoordinates)\n});\n/**\n * @param {Element} node Node.\n * @param {Array<*>} objectStack Object stack.\n * @return {Array<number>} Flat coordinates.\n */\n\nfunction readFlatCoordinatesFromNode(node, objectStack) {\n  return pushParseAndPop(null, GEOMETRY_FLAT_COORDINATES_PARSERS, node, objectStack);\n}\n/**\n * @const\n * @type {Object<string, Object<string, import(\"../xml.js\").Parser>>}\n */\n// @ts-ignore\n\n\nvar EXTRUDE_AND_ALTITUDE_MODE_PARSERS = makeStructureNS(NAMESPACE_URIS, {\n  'extrude': makeObjectPropertySetter(readBoolean),\n  'tessellate': makeObjectPropertySetter(readBoolean),\n  'altitudeMode': makeObjectPropertySetter(readString)\n});\n/**\n * @param {Element} node Node.\n * @param {Array<*>} objectStack Object stack.\n * @return {LineString|undefined} LineString.\n */\n\nfunction readLineString(node, objectStack) {\n  var properties = pushParseAndPop({}, EXTRUDE_AND_ALTITUDE_MODE_PARSERS, node, objectStack);\n  var flatCoordinates = readFlatCoordinatesFromNode(node, objectStack);\n\n  if (flatCoordinates) {\n    var lineString = new LineString(flatCoordinates, GeometryLayout.XYZ);\n    lineString.setProperties(properties, true);\n    return lineString;\n  } else {\n    return undefined;\n  }\n}\n/**\n * @param {Element} node Node.\n * @param {Array<*>} objectStack Object stack.\n * @return {Polygon|undefined} Polygon.\n */\n\n\nfunction readLinearRing(node, objectStack) {\n  var properties = pushParseAndPop({}, EXTRUDE_AND_ALTITUDE_MODE_PARSERS, node, objectStack);\n  var flatCoordinates = readFlatCoordinatesFromNode(node, objectStack);\n\n  if (flatCoordinates) {\n    var polygon = new Polygon(flatCoordinates, GeometryLayout.XYZ, [flatCoordinates.length]);\n    polygon.setProperties(properties, true);\n    return polygon;\n  } else {\n    return undefined;\n  }\n}\n/**\n * @const\n * @type {Object<string, Object<string, import(\"../xml.js\").Parser>>}\n */\n// @ts-ignore\n\n\nvar MULTI_GEOMETRY_PARSERS = makeStructureNS(NAMESPACE_URIS, {\n  'LineString': makeArrayPusher(readLineString),\n  'LinearRing': makeArrayPusher(readLinearRing),\n  'MultiGeometry': makeArrayPusher(readMultiGeometry),\n  'Point': makeArrayPusher(readPoint),\n  'Polygon': makeArrayPusher(readPolygon)\n});\n/**\n * @param {Element} node Node.\n * @param {Array<*>} objectStack Object stack.\n * @return {import(\"../geom/Geometry.js\").default} Geometry.\n */\n\nfunction readMultiGeometry(node, objectStack) {\n  var geometries = pushParseAndPop([], MULTI_GEOMETRY_PARSERS, node, objectStack);\n\n  if (!geometries) {\n    return null;\n  }\n\n  if (geometries.length === 0) {\n    return new GeometryCollection(geometries);\n  }\n\n  var multiGeometry;\n  var homogeneous = true;\n  var type = geometries[0].getType();\n  var geometry;\n\n  for (var i = 1, ii = geometries.length; i < ii; ++i) {\n    geometry = geometries[i];\n\n    if (geometry.getType() != type) {\n      homogeneous = false;\n      break;\n    }\n  }\n\n  if (homogeneous) {\n    var layout = void 0;\n    var flatCoordinates = void 0;\n\n    if (type == GeometryType.POINT) {\n      var point = geometries[0];\n      layout = point.getLayout();\n      flatCoordinates = point.getFlatCoordinates();\n\n      for (var i = 1, ii = geometries.length; i < ii; ++i) {\n        geometry = geometries[i];\n        extend(flatCoordinates, geometry.getFlatCoordinates());\n      }\n\n      multiGeometry = new MultiPoint(flatCoordinates, layout);\n      setCommonGeometryProperties(multiGeometry, geometries);\n    } else if (type == GeometryType.LINE_STRING) {\n      multiGeometry = new MultiLineString(geometries);\n      setCommonGeometryProperties(multiGeometry, geometries);\n    } else if (type == GeometryType.POLYGON) {\n      multiGeometry = new MultiPolygon(geometries);\n      setCommonGeometryProperties(multiGeometry, geometries);\n    } else if (type == GeometryType.GEOMETRY_COLLECTION) {\n      multiGeometry = new GeometryCollection(geometries);\n    } else {\n      assert(false, 37); // Unknown geometry type found\n    }\n  } else {\n    multiGeometry = new GeometryCollection(geometries);\n  }\n\n  return (\n    /** @type {import(\"../geom/Geometry.js\").default} */\n    multiGeometry\n  );\n}\n/**\n * @param {Element} node Node.\n * @param {Array<*>} objectStack Object stack.\n * @return {Point|undefined} Point.\n */\n\n\nfunction readPoint(node, objectStack) {\n  var properties = pushParseAndPop({}, EXTRUDE_AND_ALTITUDE_MODE_PARSERS, node, objectStack);\n  var flatCoordinates = readFlatCoordinatesFromNode(node, objectStack);\n\n  if (flatCoordinates) {\n    var point = new Point(flatCoordinates, GeometryLayout.XYZ);\n    point.setProperties(properties, true);\n    return point;\n  } else {\n    return undefined;\n  }\n}\n/**\n * @const\n * @type {Object<string, Object<string, import(\"../xml.js\").Parser>>}\n */\n// @ts-ignore\n\n\nvar FLAT_LINEAR_RINGS_PARSERS = makeStructureNS(NAMESPACE_URIS, {\n  'innerBoundaryIs': innerBoundaryIsParser,\n  'outerBoundaryIs': outerBoundaryIsParser\n});\n/**\n * @param {Element} node Node.\n * @param {Array<*>} objectStack Object stack.\n * @return {Polygon|undefined} Polygon.\n */\n\nfunction readPolygon(node, objectStack) {\n  var properties = pushParseAndPop(\n  /** @type {Object<string,*>} */\n  {}, EXTRUDE_AND_ALTITUDE_MODE_PARSERS, node, objectStack);\n  var flatLinearRings = pushParseAndPop([null], FLAT_LINEAR_RINGS_PARSERS, node, objectStack);\n\n  if (flatLinearRings && flatLinearRings[0]) {\n    var flatCoordinates = flatLinearRings[0];\n    var ends = [flatCoordinates.length];\n\n    for (var i = 1, ii = flatLinearRings.length; i < ii; ++i) {\n      extend(flatCoordinates, flatLinearRings[i]);\n      ends.push(flatCoordinates.length);\n    }\n\n    var polygon = new Polygon(flatCoordinates, GeometryLayout.XYZ, ends);\n    polygon.setProperties(properties, true);\n    return polygon;\n  } else {\n    return undefined;\n  }\n}\n/**\n * @const\n * @type {Object<string, Object<string, import(\"../xml.js\").Parser>>}\n */\n// @ts-ignore\n\n\nvar STYLE_PARSERS = makeStructureNS(NAMESPACE_URIS, {\n  'IconStyle': iconStyleParser,\n  'LabelStyle': labelStyleParser,\n  'LineStyle': lineStyleParser,\n  'PolyStyle': polyStyleParser\n});\n/**\n * @this {KML}\n * @param {Element} node Node.\n * @param {Array<*>} objectStack Object stack.\n * @return {Array<Style>} Style.\n */\n\nfunction readStyle(node, objectStack) {\n  var styleObject = pushParseAndPop({}, STYLE_PARSERS, node, objectStack, this);\n\n  if (!styleObject) {\n    return null;\n  }\n\n  var fillStyle =\n  /** @type {Fill} */\n  'fillStyle' in styleObject ? styleObject['fillStyle'] : DEFAULT_FILL_STYLE;\n  var fill =\n  /** @type {boolean|undefined} */\n  styleObject['fill'];\n\n  if (fill !== undefined && !fill) {\n    fillStyle = null;\n  }\n\n  var imageStyle;\n\n  if ('imageStyle' in styleObject) {\n    if (styleObject['imageStyle'] != DEFAULT_NO_IMAGE_STYLE) {\n      imageStyle = styleObject['imageStyle'];\n    }\n  } else {\n    imageStyle = DEFAULT_IMAGE_STYLE;\n  }\n\n  var textStyle =\n  /** @type {Text} */\n  'textStyle' in styleObject ? styleObject['textStyle'] : DEFAULT_TEXT_STYLE;\n  var strokeStyle =\n  /** @type {Stroke} */\n  'strokeStyle' in styleObject ? styleObject['strokeStyle'] : DEFAULT_STROKE_STYLE;\n  var outline =\n  /** @type {boolean|undefined} */\n  styleObject['outline'];\n\n  if (outline !== undefined && !outline) {\n    // if the polystyle specifies no outline two styles are needed,\n    // one for non-polygon geometries where linestrings require a stroke\n    // and one for polygons where there should be no stroke\n    return [new Style({\n      geometry: function geometry(feature) {\n        var geometry = feature.getGeometry();\n        var type = geometry.getType();\n\n        if (type === GeometryType.GEOMETRY_COLLECTION) {\n          var collection =\n          /** @type {import(\"../geom/GeometryCollection\").default} */\n          geometry;\n          return new GeometryCollection(collection.getGeometriesArrayRecursive().filter(function (geometry) {\n            var type = geometry.getType();\n            return type !== GeometryType.POLYGON && type !== GeometryType.MULTI_POLYGON;\n          }));\n        } else if (type !== GeometryType.POLYGON && type !== GeometryType.MULTI_POLYGON) {\n          return geometry;\n        }\n      },\n      fill: fillStyle,\n      image: imageStyle,\n      stroke: strokeStyle,\n      text: textStyle,\n      zIndex: undefined // FIXME\n\n    }), new Style({\n      geometry: function geometry(feature) {\n        var geometry = feature.getGeometry();\n        var type = geometry.getType();\n\n        if (type === GeometryType.GEOMETRY_COLLECTION) {\n          var collection =\n          /** @type {import(\"../geom/GeometryCollection\").default} */\n          geometry;\n          return new GeometryCollection(collection.getGeometriesArrayRecursive().filter(function (geometry) {\n            var type = geometry.getType();\n            return type === GeometryType.POLYGON || type === GeometryType.MULTI_POLYGON;\n          }));\n        } else if (type === GeometryType.POLYGON || type === GeometryType.MULTI_POLYGON) {\n          return geometry;\n        }\n      },\n      fill: fillStyle,\n      stroke: null,\n      zIndex: undefined // FIXME\n\n    })];\n  }\n\n  return [new Style({\n    fill: fillStyle,\n    image: imageStyle,\n    stroke: strokeStyle,\n    text: textStyle,\n    zIndex: undefined // FIXME\n\n  })];\n}\n/**\n * Reads an array of geometries and creates arrays for common geometry\n * properties. Then sets them to the multi geometry.\n * @param {MultiPoint|MultiLineString|MultiPolygon} multiGeometry A multi-geometry.\n * @param {Array<import(\"../geom/Geometry.js\").default>} geometries List of geometries.\n */\n\n\nfunction setCommonGeometryProperties(multiGeometry, geometries) {\n  var ii = geometries.length;\n  var extrudes = new Array(geometries.length);\n  var tessellates = new Array(geometries.length);\n  var altitudeModes = new Array(geometries.length);\n  var hasExtrude, hasTessellate, hasAltitudeMode;\n  hasExtrude = false;\n  hasTessellate = false;\n  hasAltitudeMode = false;\n\n  for (var i = 0; i < ii; ++i) {\n    var geometry = geometries[i];\n    extrudes[i] = geometry.get('extrude');\n    tessellates[i] = geometry.get('tessellate');\n    altitudeModes[i] = geometry.get('altitudeMode');\n    hasExtrude = hasExtrude || extrudes[i] !== undefined;\n    hasTessellate = hasTessellate || tessellates[i] !== undefined;\n    hasAltitudeMode = hasAltitudeMode || altitudeModes[i];\n  }\n\n  if (hasExtrude) {\n    multiGeometry.set('extrude', extrudes);\n  }\n\n  if (hasTessellate) {\n    multiGeometry.set('tessellate', tessellates);\n  }\n\n  if (hasAltitudeMode) {\n    multiGeometry.set('altitudeMode', altitudeModes);\n  }\n}\n/**\n * @const\n * @type {Object<string, Object<string, import(\"../xml.js\").Parser>>}\n */\n// @ts-ignore\n\n\nvar DATA_PARSERS = makeStructureNS(NAMESPACE_URIS, {\n  'displayName': makeObjectPropertySetter(readString),\n  'value': makeObjectPropertySetter(readString)\n});\n/**\n * @param {Element} node Node.\n * @param {Array<*>} objectStack Object stack.\n */\n\nfunction dataParser(node, objectStack) {\n  var name = node.getAttribute('name');\n  parseNode(DATA_PARSERS, node, objectStack);\n  var featureObject =\n  /** @type {Object} */\n  objectStack[objectStack.length - 1];\n\n  if (name && featureObject.displayName) {\n    featureObject[name] = {\n      value: featureObject.value,\n      displayName: featureObject.displayName,\n      toString: function toString() {\n        return featureObject.value;\n      }\n    };\n  } else if (name !== null) {\n    featureObject[name] = featureObject.value;\n  } else if (featureObject.displayName !== null) {\n    featureObject[featureObject.displayName] = featureObject.value;\n  }\n\n  delete featureObject['value'];\n}\n/**\n * @const\n * @type {Object<string, Object<string, import(\"../xml.js\").Parser>>}\n */\n// @ts-ignore\n\n\nvar EXTENDED_DATA_PARSERS = makeStructureNS(NAMESPACE_URIS, {\n  'Data': dataParser,\n  'SchemaData': schemaDataParser\n});\n/**\n * @param {Element} node Node.\n * @param {Array<*>} objectStack Object stack.\n */\n\nfunction extendedDataParser(node, objectStack) {\n  parseNode(EXTENDED_DATA_PARSERS, node, objectStack);\n}\n/**\n * @param {Element} node Node.\n * @param {Array<*>} objectStack Object stack.\n */\n\n\nfunction regionParser(node, objectStack) {\n  parseNode(REGION_PARSERS, node, objectStack);\n}\n/**\n * @const\n * @type {Object<string, Object<string, import(\"../xml.js\").Parser>>}\n */\n// @ts-ignore\n\n\nvar PAIR_PARSERS = makeStructureNS(NAMESPACE_URIS, {\n  'Style': makeObjectPropertySetter(readStyle),\n  'key': makeObjectPropertySetter(readString),\n  'styleUrl': makeObjectPropertySetter(readStyleURL)\n});\n/**\n * @param {Element} node Node.\n * @param {Array<*>} objectStack Object stack.\n */\n\nfunction pairDataParser(node, objectStack) {\n  var pairObject = pushParseAndPop({}, PAIR_PARSERS, node, objectStack, this);\n\n  if (!pairObject) {\n    return;\n  }\n\n  var key =\n  /** @type {string|undefined} */\n  pairObject['key'];\n\n  if (key && key == 'normal') {\n    var styleUrl =\n    /** @type {string|undefined} */\n    pairObject['styleUrl'];\n\n    if (styleUrl) {\n      objectStack[objectStack.length - 1] = styleUrl;\n    }\n\n    var style =\n    /** @type {Style} */\n    pairObject['Style'];\n\n    if (style) {\n      objectStack[objectStack.length - 1] = style;\n    }\n  }\n}\n/**\n * @this {KML}\n * @param {Element} node Node.\n * @param {Array<*>} objectStack Object stack.\n */\n\n\nfunction placemarkStyleMapParser(node, objectStack) {\n  var styleMapValue = readStyleMapValue.call(this, node, objectStack);\n\n  if (!styleMapValue) {\n    return;\n  }\n\n  var placemarkObject = objectStack[objectStack.length - 1];\n\n  if (Array.isArray(styleMapValue)) {\n    placemarkObject['Style'] = styleMapValue;\n  } else if (typeof styleMapValue === 'string') {\n    placemarkObject['styleUrl'] = styleMapValue;\n  } else {\n    assert(false, 38); // `styleMapValue` has an unknown type\n  }\n}\n/**\n * @const\n * @type {Object<string, Object<string, import(\"../xml.js\").Parser>>}\n */\n// @ts-ignore\n\n\nvar SCHEMA_DATA_PARSERS = makeStructureNS(NAMESPACE_URIS, {\n  'SimpleData': simpleDataParser\n});\n/**\n * @param {Element} node Node.\n * @param {Array<*>} objectStack Object stack.\n */\n\nfunction schemaDataParser(node, objectStack) {\n  parseNode(SCHEMA_DATA_PARSERS, node, objectStack);\n}\n/**\n * @param {Element} node Node.\n * @param {Array<*>} objectStack Object stack.\n */\n\n\nfunction simpleDataParser(node, objectStack) {\n  var name = node.getAttribute('name');\n\n  if (name !== null) {\n    var data = readString(node);\n    var featureObject =\n    /** @type {Object} */\n    objectStack[objectStack.length - 1];\n    featureObject[name] = data;\n  }\n}\n/**\n * @const\n * @type {Object<string, Object<string, import(\"../xml.js\").Parser>>}\n */\n// @ts-ignore\n\n\nvar LAT_LON_ALT_BOX_PARSERS = makeStructureNS(NAMESPACE_URIS, {\n  'altitudeMode': makeObjectPropertySetter(readString),\n  'minAltitude': makeObjectPropertySetter(readDecimal),\n  'maxAltitude': makeObjectPropertySetter(readDecimal),\n  'north': makeObjectPropertySetter(readDecimal),\n  'south': makeObjectPropertySetter(readDecimal),\n  'east': makeObjectPropertySetter(readDecimal),\n  'west': makeObjectPropertySetter(readDecimal)\n});\n/**\n * @param {Element} node Node.\n * @param {Array<*>} objectStack Object stack.\n */\n\nfunction latLonAltBoxParser(node, objectStack) {\n  var object = pushParseAndPop({}, LAT_LON_ALT_BOX_PARSERS, node, objectStack);\n\n  if (!object) {\n    return;\n  }\n\n  var regionObject =\n  /** @type {Object} */\n  objectStack[objectStack.length - 1];\n  var extent = [parseFloat(object['west']), parseFloat(object['south']), parseFloat(object['east']), parseFloat(object['north'])];\n  regionObject['extent'] = extent;\n  regionObject['altitudeMode'] = object['altitudeMode'];\n  regionObject['minAltitude'] = parseFloat(object['minAltitude']);\n  regionObject['maxAltitude'] = parseFloat(object['maxAltitude']);\n}\n/**\n * @const\n * @type {Object<string, Object<string, import(\"../xml.js\").Parser>>}\n */\n// @ts-ignore\n\n\nvar LOD_PARSERS = makeStructureNS(NAMESPACE_URIS, {\n  'minLodPixels': makeObjectPropertySetter(readDecimal),\n  'maxLodPixels': makeObjectPropertySetter(readDecimal),\n  'minFadeExtent': makeObjectPropertySetter(readDecimal),\n  'maxFadeExtent': makeObjectPropertySetter(readDecimal)\n});\n/**\n * @param {Element} node Node.\n * @param {Array<*>} objectStack Object stack.\n */\n\nfunction lodParser(node, objectStack) {\n  var object = pushParseAndPop({}, LOD_PARSERS, node, objectStack);\n\n  if (!object) {\n    return;\n  }\n\n  var lodObject =\n  /** @type {Object} */\n  objectStack[objectStack.length - 1];\n  lodObject['minLodPixels'] = parseFloat(object['minLodPixels']);\n  lodObject['maxLodPixels'] = parseFloat(object['maxLodPixels']);\n  lodObject['minFadeExtent'] = parseFloat(object['minFadeExtent']);\n  lodObject['maxFadeExtent'] = parseFloat(object['maxFadeExtent']);\n}\n/**\n * @const\n * @type {Object<string, Object<string, import(\"../xml.js\").Parser>>}\n */\n// @ts-ignore\n\n\nvar INNER_BOUNDARY_IS_PARSERS = makeStructureNS(NAMESPACE_URIS, {\n  // KML spec only allows one LinearRing  per innerBoundaryIs, but Google Earth\n  // allows multiple, so we parse multiple here too.\n  'LinearRing': makeArrayPusher(readFlatLinearRing)\n});\n/**\n * @param {Element} node Node.\n * @param {Array<*>} objectStack Object stack.\n */\n\nfunction innerBoundaryIsParser(node, objectStack) {\n  var innerBoundaryFlatLinearRings = pushParseAndPop(\n  /** @type {Array<Array<number>>} */\n  [], INNER_BOUNDARY_IS_PARSERS, node, objectStack);\n\n  if (innerBoundaryFlatLinearRings.length > 0) {\n    var flatLinearRings =\n    /** @type {Array<Array<number>>} */\n    objectStack[objectStack.length - 1];\n    flatLinearRings.push.apply(flatLinearRings, innerBoundaryFlatLinearRings);\n  }\n}\n/**\n * @const\n * @type {Object<string, Object<string, import(\"../xml.js\").Parser>>}\n */\n// @ts-ignore\n\n\nvar OUTER_BOUNDARY_IS_PARSERS = makeStructureNS(NAMESPACE_URIS, {\n  'LinearRing': makeReplacer(readFlatLinearRing)\n});\n/**\n * @param {Element} node Node.\n * @param {Array<*>} objectStack Object stack.\n */\n\nfunction outerBoundaryIsParser(node, objectStack) {\n  /** @type {Array<number>|undefined} */\n  var flatLinearRing = pushParseAndPop(undefined, OUTER_BOUNDARY_IS_PARSERS, node, objectStack);\n\n  if (flatLinearRing) {\n    var flatLinearRings =\n    /** @type {Array<Array<number>>} */\n    objectStack[objectStack.length - 1];\n    flatLinearRings[0] = flatLinearRing;\n  }\n}\n/**\n * @param {Element} node Node.\n * @param {Array<*>} objectStack Object stack.\n */\n\n\nfunction linkParser(node, objectStack) {\n  parseNode(LINK_PARSERS, node, objectStack);\n}\n/**\n * @param {Node} node Node.\n * @param {Array<*>} objectStack Object stack.\n */\n\n\nfunction whenParser(node, objectStack) {\n  var gxTrackObject =\n  /** @type {GxTrackObject} */\n  objectStack[objectStack.length - 1];\n  var whens = gxTrackObject.whens;\n  var s = getAllTextContent(node, false);\n  var when = Date.parse(s);\n  whens.push(isNaN(when) ? 0 : when);\n}\n/**\n * @param {Node} node Node to append a TextNode with the color to.\n * @param {import(\"../color.js\").Color|string} color Color.\n */\n\n\nfunction writeColorTextNode(node, color) {\n  var rgba = asArray(color);\n  var opacity = rgba.length == 4 ? rgba[3] : 1;\n  /** @type {Array<string|number>} */\n\n  var abgr = [opacity * 255, rgba[2], rgba[1], rgba[0]];\n\n  for (var i = 0; i < 4; ++i) {\n    var hex = Math.floor(\n    /** @type {number} */\n    abgr[i]).toString(16);\n    abgr[i] = hex.length == 1 ? '0' + hex : hex;\n  }\n\n  writeStringTextNode(node, abgr.join(''));\n}\n/**\n * @param {Node} node Node to append a TextNode with the coordinates to.\n * @param {Array<number>} coordinates Coordinates.\n * @param {Array<*>} objectStack Object stack.\n */\n\n\nfunction writeCoordinatesTextNode(node, coordinates, objectStack) {\n  var context = objectStack[objectStack.length - 1];\n  var layout = context['layout'];\n  var stride = context['stride'];\n  var dimension;\n\n  if (layout == GeometryLayout.XY || layout == GeometryLayout.XYM) {\n    dimension = 2;\n  } else if (layout == GeometryLayout.XYZ || layout == GeometryLayout.XYZM) {\n    dimension = 3;\n  } else {\n    assert(false, 34); // Invalid geometry layout\n  }\n\n  var ii = coordinates.length;\n  var text = '';\n\n  if (ii > 0) {\n    text += coordinates[0];\n\n    for (var d = 1; d < dimension; ++d) {\n      text += ',' + coordinates[d];\n    }\n\n    for (var i = stride; i < ii; i += stride) {\n      text += ' ' + coordinates[i];\n\n      for (var d = 1; d < dimension; ++d) {\n        text += ',' + coordinates[i + d];\n      }\n    }\n  }\n\n  writeStringTextNode(node, text);\n}\n/**\n * @const\n * @type {Object<string, Object<string, import(\"../xml.js\").Serializer>>}\n */\n// @ts-ignore\n\n\nvar EXTENDEDDATA_NODE_SERIALIZERS = makeStructureNS(NAMESPACE_URIS, {\n  'Data': makeChildAppender(writeDataNode),\n  'value': makeChildAppender(writeDataNodeValue),\n  'displayName': makeChildAppender(writeDataNodeName)\n});\n/**\n * @param {Element} node Node.\n * @param {{name: *, value: *}} pair Name value pair.\n * @param {Array<*>} objectStack Object stack.\n */\n\nfunction writeDataNode(node, pair, objectStack) {\n  node.setAttribute('name', pair.name);\n  var\n  /** @type {import(\"../xml.js\").NodeStackItem} */\n  context = {\n    node: node\n  };\n  var value = pair.value;\n\n  if (_typeof(value) == 'object') {\n    if (value !== null && value.displayName) {\n      pushSerializeAndPop(context, EXTENDEDDATA_NODE_SERIALIZERS, OBJECT_PROPERTY_NODE_FACTORY, [value.displayName], objectStack, ['displayName']);\n    }\n\n    if (value !== null && value.value) {\n      pushSerializeAndPop(context, EXTENDEDDATA_NODE_SERIALIZERS, OBJECT_PROPERTY_NODE_FACTORY, [value.value], objectStack, ['value']);\n    }\n  } else {\n    pushSerializeAndPop(context, EXTENDEDDATA_NODE_SERIALIZERS, OBJECT_PROPERTY_NODE_FACTORY, [value], objectStack, ['value']);\n  }\n}\n/**\n * @param {Node} node Node to append a TextNode with the name to.\n * @param {string} name DisplayName.\n */\n\n\nfunction writeDataNodeName(node, name) {\n  writeCDATASection(node, name);\n}\n/**\n * @param {Node} node Node to append a CDATA Section with the value to.\n * @param {string} value Value.\n */\n\n\nfunction writeDataNodeValue(node, value) {\n  writeStringTextNode(node, value);\n}\n/**\n * @const\n * @type {Object<string, Object<string, import(\"../xml.js\").Serializer>>}\n */\n// @ts-ignore\n\n\nvar DOCUMENT_SERIALIZERS = makeStructureNS(NAMESPACE_URIS, {\n  'Placemark': makeChildAppender(writePlacemark)\n});\n/**\n * @const\n * @param {*} value Value.\n * @param {Array<*>} objectStack Object stack.\n * @param {string} [opt_nodeName] Node name.\n * @return {Node|undefined} Node.\n */\n\nvar DOCUMENT_NODE_FACTORY = function DOCUMENT_NODE_FACTORY(value, objectStack, opt_nodeName) {\n  var parentNode = objectStack[objectStack.length - 1].node;\n  return createElementNS(parentNode.namespaceURI, 'Placemark');\n};\n/**\n * @param {Element} node Node.\n * @param {Array<Feature>} features Features.\n * @param {Array<*>} objectStack Object stack.\n * @this {KML}\n */\n\n\nfunction writeDocument(node, features, objectStack) {\n  var\n  /** @type {import(\"../xml.js\").NodeStackItem} */\n  context = {\n    node: node\n  };\n  pushSerializeAndPop(context, DOCUMENT_SERIALIZERS, DOCUMENT_NODE_FACTORY, features, objectStack, undefined, this);\n}\n/**\n * A factory for creating Data nodes.\n * @const\n * @type {function(*, Array<*>): (Node|undefined)}\n */\n\n\nvar DATA_NODE_FACTORY = makeSimpleNodeFactory('Data');\n/**\n * @param {Element} node Node.\n * @param {{names: Array<string>, values: (Array<*>)}} namesAndValues Names and values.\n * @param {Array<*>} objectStack Object stack.\n */\n\nfunction writeExtendedData(node, namesAndValues, objectStack) {\n  var\n  /** @type {import(\"../xml.js\").NodeStackItem} */\n  context = {\n    node: node\n  };\n  var names = namesAndValues.names;\n  var values = namesAndValues.values;\n  var length = names.length;\n\n  for (var i = 0; i < length; i++) {\n    pushSerializeAndPop(context, EXTENDEDDATA_NODE_SERIALIZERS, DATA_NODE_FACTORY, [{\n      name: names[i],\n      value: values[i]\n    }], objectStack);\n  }\n}\n/**\n * @const\n * @type {Object<string, Array<string>>}\n */\n// @ts-ignore\n\n\nvar ICON_SEQUENCE = makeStructureNS(NAMESPACE_URIS, ['href'], makeStructureNS(GX_NAMESPACE_URIS, ['x', 'y', 'w', 'h']));\n/**\n * @const\n * @type {Object<string, Object<string, import(\"../xml.js\").Serializer>>}\n */\n// @ts-ignore\n\nvar ICON_SERIALIZERS = makeStructureNS(NAMESPACE_URIS, {\n  'href': makeChildAppender(writeStringTextNode)\n}, makeStructureNS(GX_NAMESPACE_URIS, {\n  'x': makeChildAppender(writeDecimalTextNode),\n  'y': makeChildAppender(writeDecimalTextNode),\n  'w': makeChildAppender(writeDecimalTextNode),\n  'h': makeChildAppender(writeDecimalTextNode)\n}));\n/**\n * @const\n * @param {*} value Value.\n * @param {Array<*>} objectStack Object stack.\n * @param {string} [opt_nodeName] Node name.\n * @return {Node|undefined} Node.\n */\n\nvar GX_NODE_FACTORY = function GX_NODE_FACTORY(value, objectStack, opt_nodeName) {\n  return createElementNS(GX_NAMESPACE_URIS[0], 'gx:' + opt_nodeName);\n};\n/**\n * @param {Element} node Node.\n * @param {Object} icon Icon object.\n * @param {Array<*>} objectStack Object stack.\n */\n\n\nfunction writeIcon(node, icon, objectStack) {\n  var\n  /** @type {import(\"../xml.js\").NodeStackItem} */\n  context = {\n    node: node\n  };\n  var parentNode = objectStack[objectStack.length - 1].node;\n  var orderedKeys = ICON_SEQUENCE[parentNode.namespaceURI];\n  var values = makeSequence(icon, orderedKeys);\n  pushSerializeAndPop(context, ICON_SERIALIZERS, OBJECT_PROPERTY_NODE_FACTORY, values, objectStack, orderedKeys);\n  orderedKeys = ICON_SEQUENCE[GX_NAMESPACE_URIS[0]];\n  values = makeSequence(icon, orderedKeys);\n  pushSerializeAndPop(context, ICON_SERIALIZERS, GX_NODE_FACTORY, values, objectStack, orderedKeys);\n}\n/**\n * @const\n * @type {Object<string, Array<string>>}\n */\n// @ts-ignore\n\n\nvar ICON_STYLE_SEQUENCE = makeStructureNS(NAMESPACE_URIS, ['scale', 'heading', 'Icon', 'color', 'hotSpot']);\n/**\n * @const\n * @type {Object<string, Object<string, import(\"../xml.js\").Serializer>>}\n */\n// @ts-ignore\n\nvar ICON_STYLE_SERIALIZERS = makeStructureNS(NAMESPACE_URIS, {\n  'Icon': makeChildAppender(writeIcon),\n  'color': makeChildAppender(writeColorTextNode),\n  'heading': makeChildAppender(writeDecimalTextNode),\n  'hotSpot': makeChildAppender(writeVec2),\n  'scale': makeChildAppender(writeScaleTextNode)\n});\n/**\n * @param {Element} node Node.\n * @param {import(\"../style/Icon.js\").default} style Icon style.\n * @param {Array<*>} objectStack Object stack.\n */\n\nfunction writeIconStyle(node, style, objectStack) {\n  var\n  /** @type {import(\"../xml.js\").NodeStackItem} */\n  context = {\n    node: node\n  };\n  var\n  /** @type {Object<string, any>} */\n  properties = {};\n  var src = style.getSrc();\n  var size = style.getSize();\n  var iconImageSize = style.getImageSize();\n  var iconProperties = {\n    'href': src\n  };\n\n  if (size) {\n    iconProperties['w'] = size[0];\n    iconProperties['h'] = size[1];\n    var anchor = style.getAnchor(); // top-left\n\n    var origin_1 = style.getOrigin(); // top-left\n\n    if (origin_1 && iconImageSize && origin_1[0] !== 0 && origin_1[1] !== size[1]) {\n      iconProperties['x'] = origin_1[0];\n      iconProperties['y'] = iconImageSize[1] - (origin_1[1] + size[1]);\n    }\n\n    if (anchor && (anchor[0] !== size[0] / 2 || anchor[1] !== size[1] / 2)) {\n      var\n      /** @type {Vec2} */\n      hotSpot = {\n        x: anchor[0],\n        xunits: IconAnchorUnits.PIXELS,\n        y: size[1] - anchor[1],\n        yunits: IconAnchorUnits.PIXELS\n      };\n      properties['hotSpot'] = hotSpot;\n    }\n  }\n\n  properties['Icon'] = iconProperties;\n  var scale = style.getScaleArray()[0];\n  var imageSize = size;\n\n  if (imageSize === null) {\n    imageSize = DEFAULT_IMAGE_STYLE_SIZE;\n  }\n\n  if (imageSize.length == 2) {\n    var resizeScale = scaleForSize(imageSize);\n    scale = scale / resizeScale;\n  }\n\n  if (scale !== 1) {\n    properties['scale'] = scale;\n  }\n\n  var rotation = style.getRotation();\n\n  if (rotation !== 0) {\n    properties['heading'] = rotation; // 0-360\n  }\n\n  var color = style.getColor();\n\n  if (color) {\n    properties['color'] = color;\n  }\n\n  var parentNode = objectStack[objectStack.length - 1].node;\n  var orderedKeys = ICON_STYLE_SEQUENCE[parentNode.namespaceURI];\n  var values = makeSequence(properties, orderedKeys);\n  pushSerializeAndPop(context, ICON_STYLE_SERIALIZERS, OBJECT_PROPERTY_NODE_FACTORY, values, objectStack, orderedKeys);\n}\n/**\n * @const\n * @type {Object<string, Array<string>>}\n */\n// @ts-ignore\n\n\nvar LABEL_STYLE_SEQUENCE = makeStructureNS(NAMESPACE_URIS, ['color', 'scale']);\n/**\n * @const\n * @type {Object<string, Object<string, import(\"../xml.js\").Serializer>>}\n */\n// @ts-ignore\n\nvar LABEL_STYLE_SERIALIZERS = makeStructureNS(NAMESPACE_URIS, {\n  'color': makeChildAppender(writeColorTextNode),\n  'scale': makeChildAppender(writeScaleTextNode)\n});\n/**\n * @param {Element} node Node.\n * @param {Text} style style.\n * @param {Array<*>} objectStack Object stack.\n */\n\nfunction writeLabelStyle(node, style, objectStack) {\n  var\n  /** @type {import(\"../xml.js\").NodeStackItem} */\n  context = {\n    node: node\n  };\n  var properties = {};\n  var fill = style.getFill();\n\n  if (fill) {\n    properties['color'] = fill.getColor();\n  }\n\n  var scale = style.getScale();\n\n  if (scale && scale !== 1) {\n    properties['scale'] = scale;\n  }\n\n  var parentNode = objectStack[objectStack.length - 1].node;\n  var orderedKeys = LABEL_STYLE_SEQUENCE[parentNode.namespaceURI];\n  var values = makeSequence(properties, orderedKeys);\n  pushSerializeAndPop(context, LABEL_STYLE_SERIALIZERS, OBJECT_PROPERTY_NODE_FACTORY, values, objectStack, orderedKeys);\n}\n/**\n * @const\n * @type {Object<string, Array<string>>}\n */\n// @ts-ignore\n\n\nvar LINE_STYLE_SEQUENCE = makeStructureNS(NAMESPACE_URIS, ['color', 'width']);\n/**\n * @const\n * @type {Object<string, Object<string, import(\"../xml.js\").Serializer>>}\n */\n// @ts-ignore\n\nvar LINE_STYLE_SERIALIZERS = makeStructureNS(NAMESPACE_URIS, {\n  'color': makeChildAppender(writeColorTextNode),\n  'width': makeChildAppender(writeDecimalTextNode)\n});\n/**\n * @param {Element} node Node.\n * @param {Stroke} style style.\n * @param {Array<*>} objectStack Object stack.\n */\n\nfunction writeLineStyle(node, style, objectStack) {\n  var\n  /** @type {import(\"../xml.js\").NodeStackItem} */\n  context = {\n    node: node\n  };\n  var properties = {\n    'color': style.getColor(),\n    'width': Number(style.getWidth()) || 1\n  };\n  var parentNode = objectStack[objectStack.length - 1].node;\n  var orderedKeys = LINE_STYLE_SEQUENCE[parentNode.namespaceURI];\n  var values = makeSequence(properties, orderedKeys);\n  pushSerializeAndPop(context, LINE_STYLE_SERIALIZERS, OBJECT_PROPERTY_NODE_FACTORY, values, objectStack, orderedKeys);\n}\n/**\n * @const\n * @type {Object<string, string>}\n */\n\n\nvar GEOMETRY_TYPE_TO_NODENAME = {\n  'Point': 'Point',\n  'LineString': 'LineString',\n  'LinearRing': 'LinearRing',\n  'Polygon': 'Polygon',\n  'MultiPoint': 'MultiGeometry',\n  'MultiLineString': 'MultiGeometry',\n  'MultiPolygon': 'MultiGeometry',\n  'GeometryCollection': 'MultiGeometry'\n};\n/**\n * @const\n * @param {*} value Value.\n * @param {Array<*>} objectStack Object stack.\n * @param {string} [opt_nodeName] Node name.\n * @return {Node|undefined} Node.\n */\n\nvar GEOMETRY_NODE_FACTORY = function GEOMETRY_NODE_FACTORY(value, objectStack, opt_nodeName) {\n  if (value) {\n    var parentNode = objectStack[objectStack.length - 1].node;\n    return createElementNS(parentNode.namespaceURI, GEOMETRY_TYPE_TO_NODENAME[\n    /** @type {import(\"../geom/Geometry.js\").default} */\n    value.getType()]);\n  }\n};\n/**\n * A factory for creating Point nodes.\n * @const\n * @type {function(*, Array<*>, string=): (Node|undefined)}\n */\n\n\nvar POINT_NODE_FACTORY = makeSimpleNodeFactory('Point');\n/**\n * A factory for creating LineString nodes.\n * @const\n * @type {function(*, Array<*>, string=): (Node|undefined)}\n */\n\nvar LINE_STRING_NODE_FACTORY = makeSimpleNodeFactory('LineString');\n/**\n * A factory for creating LinearRing nodes.\n * @const\n * @type {function(*, Array<*>, string=): (Node|undefined)}\n */\n\nvar LINEAR_RING_NODE_FACTORY = makeSimpleNodeFactory('LinearRing');\n/**\n * A factory for creating Polygon nodes.\n * @const\n * @type {function(*, Array<*>, string=): (Node|undefined)}\n */\n\nvar POLYGON_NODE_FACTORY = makeSimpleNodeFactory('Polygon');\n/**\n * @const\n * @type {Object<string, Object<string, import(\"../xml.js\").Serializer>>}\n */\n// @ts-ignore\n\nvar MULTI_GEOMETRY_SERIALIZERS = makeStructureNS(NAMESPACE_URIS, {\n  'LineString': makeChildAppender(writePrimitiveGeometry),\n  'Point': makeChildAppender(writePrimitiveGeometry),\n  'Polygon': makeChildAppender(writePolygon),\n  'GeometryCollection': makeChildAppender(writeMultiGeometry)\n});\n/**\n * @param {Element} node Node.\n * @param {import(\"../geom/Geometry.js\").default} geometry Geometry.\n * @param {Array<*>} objectStack Object stack.\n */\n\nfunction writeMultiGeometry(node, geometry, objectStack) {\n  /** @type {import(\"../xml.js\").NodeStackItem} */\n  var context = {\n    node: node\n  };\n  var type = geometry.getType();\n  /** @type {Array<import(\"../geom/Geometry.js\").default>} */\n\n  var geometries = [];\n  /** @type {function(*, Array<*>, string=): (Node|undefined)} */\n\n  var factory;\n\n  if (type === GeometryType.GEOMETRY_COLLECTION) {\n    /** @type {GeometryCollection} */\n    geometry.getGeometriesArrayRecursive().forEach(function (geometry) {\n      var type = geometry.getType();\n\n      if (type === GeometryType.MULTI_POINT) {\n        geometries = geometries.concat(\n        /** @type {MultiPoint} */\n        geometry.getPoints());\n      } else if (type === GeometryType.MULTI_LINE_STRING) {\n        geometries = geometries.concat(\n        /** @type {MultiLineString} */\n        geometry.getLineStrings());\n      } else if (type === GeometryType.MULTI_POLYGON) {\n        geometries = geometries.concat(\n        /** @type {MultiPolygon} */\n        geometry.getPolygons());\n      } else if (type === GeometryType.POINT || type === GeometryType.LINE_STRING || type === GeometryType.POLYGON) {\n        geometries.push(geometry);\n      } else {\n        assert(false, 39); // Unknown geometry type\n      }\n    });\n    factory = GEOMETRY_NODE_FACTORY;\n  } else if (type === GeometryType.MULTI_POINT) {\n    geometries =\n    /** @type {MultiPoint} */\n    geometry.getPoints();\n    factory = POINT_NODE_FACTORY;\n  } else if (type === GeometryType.MULTI_LINE_STRING) {\n    geometries =\n    /** @type {MultiLineString} */\n    geometry.getLineStrings();\n    factory = LINE_STRING_NODE_FACTORY;\n  } else if (type === GeometryType.MULTI_POLYGON) {\n    geometries =\n    /** @type {MultiPolygon} */\n    geometry.getPolygons();\n    factory = POLYGON_NODE_FACTORY;\n  } else {\n    assert(false, 39); // Unknown geometry type\n  }\n\n  pushSerializeAndPop(context, MULTI_GEOMETRY_SERIALIZERS, factory, geometries, objectStack);\n}\n/**\n * @const\n * @type {Object<string, Object<string, import(\"../xml.js\").Serializer>>}\n */\n// @ts-ignore\n\n\nvar BOUNDARY_IS_SERIALIZERS = makeStructureNS(NAMESPACE_URIS, {\n  'LinearRing': makeChildAppender(writePrimitiveGeometry)\n});\n/**\n * @param {Element} node Node.\n * @param {import(\"../geom/LinearRing.js\").default} linearRing Linear ring.\n * @param {Array<*>} objectStack Object stack.\n */\n\nfunction writeBoundaryIs(node, linearRing, objectStack) {\n  var\n  /** @type {import(\"../xml.js\").NodeStackItem} */\n  context = {\n    node: node\n  };\n  pushSerializeAndPop(context, BOUNDARY_IS_SERIALIZERS, LINEAR_RING_NODE_FACTORY, [linearRing], objectStack);\n}\n/**\n * @const\n * @type {Object<string, Object<string, import(\"../xml.js\").Serializer>>}\n */\n// @ts-ignore\n\n\nvar PLACEMARK_SERIALIZERS = makeStructureNS(NAMESPACE_URIS, {\n  'ExtendedData': makeChildAppender(writeExtendedData),\n  'MultiGeometry': makeChildAppender(writeMultiGeometry),\n  'LineString': makeChildAppender(writePrimitiveGeometry),\n  'LinearRing': makeChildAppender(writePrimitiveGeometry),\n  'Point': makeChildAppender(writePrimitiveGeometry),\n  'Polygon': makeChildAppender(writePolygon),\n  'Style': makeChildAppender(writeStyle),\n  'address': makeChildAppender(writeStringTextNode),\n  'description': makeChildAppender(writeStringTextNode),\n  'name': makeChildAppender(writeStringTextNode),\n  'open': makeChildAppender(writeBooleanTextNode),\n  'phoneNumber': makeChildAppender(writeStringTextNode),\n  'styleUrl': makeChildAppender(writeStringTextNode),\n  'visibility': makeChildAppender(writeBooleanTextNode)\n});\n/**\n * @const\n * @type {Object<string, Array<string>>}\n */\n// @ts-ignore\n\nvar PLACEMARK_SEQUENCE = makeStructureNS(NAMESPACE_URIS, ['name', 'open', 'visibility', 'address', 'phoneNumber', 'description', 'styleUrl', 'Style']);\n/**\n * A factory for creating ExtendedData nodes.\n * @const\n * @type {function(*, Array<*>): (Node|undefined)}\n */\n\nvar EXTENDEDDATA_NODE_FACTORY = makeSimpleNodeFactory('ExtendedData');\n/**\n * FIXME currently we do serialize arbitrary/custom feature properties\n * (ExtendedData).\n * @param {Element} node Node.\n * @param {Feature} feature Feature.\n * @param {Array<*>} objectStack Object stack.\n * @this {KML}\n */\n\nfunction writePlacemark(node, feature, objectStack) {\n  var\n  /** @type {import(\"../xml.js\").NodeStackItem} */\n  context = {\n    node: node\n  }; // set id\n\n  if (feature.getId()) {\n    node.setAttribute('id',\n    /** @type {string} */\n    feature.getId());\n  } // serialize properties (properties unknown to KML are not serialized)\n\n\n  var properties = feature.getProperties(); // don't export these to ExtendedData\n\n  var filter = {\n    'address': 1,\n    'description': 1,\n    'name': 1,\n    'open': 1,\n    'phoneNumber': 1,\n    'styleUrl': 1,\n    'visibility': 1\n  };\n  filter[feature.getGeometryName()] = 1;\n  var keys = Object.keys(properties || {}).sort().filter(function (v) {\n    return !filter[v];\n  });\n  var styleFunction = feature.getStyleFunction();\n\n  if (styleFunction) {\n    // FIXME the styles returned by the style function are supposed to be\n    // resolution-independent here\n    var styles = styleFunction(feature, 0);\n\n    if (styles) {\n      var styleArray = Array.isArray(styles) ? styles : [styles];\n      var pointStyles = styleArray;\n\n      if (feature.getGeometry()) {\n        pointStyles = styleArray.filter(function (style) {\n          var geometry = style.getGeometryFunction()(feature);\n\n          if (geometry) {\n            var type = geometry.getType();\n\n            if (type === GeometryType.GEOMETRY_COLLECTION) {\n              return (\n                /** @type {GeometryCollection} */\n                geometry.getGeometriesArrayRecursive().filter(function (geometry) {\n                  var type = geometry.getType();\n                  return type === GeometryType.POINT || type === GeometryType.MULTI_POINT;\n                }).length\n              );\n            }\n\n            return type === GeometryType.POINT || type === GeometryType.MULTI_POINT;\n          }\n        });\n      }\n\n      if (this.writeStyles_) {\n        var lineStyles = styleArray;\n        var polyStyles = styleArray;\n\n        if (feature.getGeometry()) {\n          lineStyles = styleArray.filter(function (style) {\n            var geometry = style.getGeometryFunction()(feature);\n\n            if (geometry) {\n              var type = geometry.getType();\n\n              if (type === GeometryType.GEOMETRY_COLLECTION) {\n                return (\n                  /** @type {GeometryCollection} */\n                  geometry.getGeometriesArrayRecursive().filter(function (geometry) {\n                    var type = geometry.getType();\n                    return type === GeometryType.LINE_STRING || type === GeometryType.MULTI_LINE_STRING;\n                  }).length\n                );\n              }\n\n              return type === GeometryType.LINE_STRING || type === GeometryType.MULTI_LINE_STRING;\n            }\n          });\n          polyStyles = styleArray.filter(function (style) {\n            var geometry = style.getGeometryFunction()(feature);\n\n            if (geometry) {\n              var type = geometry.getType();\n\n              if (type === GeometryType.GEOMETRY_COLLECTION) {\n                return (\n                  /** @type {GeometryCollection} */\n                  geometry.getGeometriesArrayRecursive().filter(function (geometry) {\n                    var type = geometry.getType();\n                    return type === GeometryType.POLYGON || type === GeometryType.MULTI_POLYGON;\n                  }).length\n                );\n              }\n\n              return type === GeometryType.POLYGON || type === GeometryType.MULTI_POLYGON;\n            }\n          });\n        }\n\n        properties['Style'] = {\n          pointStyles: pointStyles,\n          lineStyles: lineStyles,\n          polyStyles: polyStyles\n        };\n      }\n\n      if (pointStyles.length && properties['name'] === undefined) {\n        var textStyle = pointStyles[0].getText();\n\n        if (textStyle) {\n          properties['name'] = textStyle.getText();\n        }\n      }\n    }\n  }\n\n  var parentNode = objectStack[objectStack.length - 1].node;\n  var orderedKeys = PLACEMARK_SEQUENCE[parentNode.namespaceURI];\n  var values = makeSequence(properties, orderedKeys);\n  pushSerializeAndPop(context, PLACEMARK_SERIALIZERS, OBJECT_PROPERTY_NODE_FACTORY, values, objectStack, orderedKeys);\n\n  if (keys.length > 0) {\n    var sequence = makeSequence(properties, keys);\n    var namesAndValues = {\n      names: keys,\n      values: sequence\n    };\n    pushSerializeAndPop(context, PLACEMARK_SERIALIZERS, EXTENDEDDATA_NODE_FACTORY, [namesAndValues], objectStack);\n  } // serialize geometry\n\n\n  var options =\n  /** @type {import(\"./Feature.js\").WriteOptions} */\n  objectStack[0];\n  var geometry = feature.getGeometry();\n\n  if (geometry) {\n    geometry = transformGeometryWithOptions(geometry, true, options);\n  }\n\n  pushSerializeAndPop(context, PLACEMARK_SERIALIZERS, GEOMETRY_NODE_FACTORY, [geometry], objectStack);\n}\n/**\n * @const\n * @type {Object<string, Array<string>>}\n */\n// @ts-ignore\n\n\nvar PRIMITIVE_GEOMETRY_SEQUENCE = makeStructureNS(NAMESPACE_URIS, ['extrude', 'tessellate', 'altitudeMode', 'coordinates']);\n/**\n * @const\n * @type {Object<string, Object<string, import(\"../xml.js\").Serializer>>}\n */\n// @ts-ignore\n\nvar PRIMITIVE_GEOMETRY_SERIALIZERS = makeStructureNS(NAMESPACE_URIS, {\n  'extrude': makeChildAppender(writeBooleanTextNode),\n  'tessellate': makeChildAppender(writeBooleanTextNode),\n  'altitudeMode': makeChildAppender(writeStringTextNode),\n  'coordinates': makeChildAppender(writeCoordinatesTextNode)\n});\n/**\n * @param {Element} node Node.\n * @param {import(\"../geom/SimpleGeometry.js\").default} geometry Geometry.\n * @param {Array<*>} objectStack Object stack.\n */\n\nfunction writePrimitiveGeometry(node, geometry, objectStack) {\n  var flatCoordinates = geometry.getFlatCoordinates();\n  var\n  /** @type {import(\"../xml.js\").NodeStackItem} */\n  context = {\n    node: node\n  };\n  context['layout'] = geometry.getLayout();\n  context['stride'] = geometry.getStride(); // serialize properties (properties unknown to KML are not serialized)\n\n  var properties = geometry.getProperties();\n  properties.coordinates = flatCoordinates;\n  var parentNode = objectStack[objectStack.length - 1].node;\n  var orderedKeys = PRIMITIVE_GEOMETRY_SEQUENCE[parentNode.namespaceURI];\n  var values = makeSequence(properties, orderedKeys);\n  pushSerializeAndPop(context, PRIMITIVE_GEOMETRY_SERIALIZERS, OBJECT_PROPERTY_NODE_FACTORY, values, objectStack, orderedKeys);\n}\n/**\n * @const\n * @type {Object<string, Array<string>>}\n */\n// @ts-ignore\n\n\nvar POLY_STYLE_SEQUENCE = makeStructureNS(NAMESPACE_URIS, ['color', 'fill', 'outline']);\n/**\n * @const\n * @type {Object<string, Object<string, import(\"../xml.js\").Serializer>>}\n */\n// @ts-ignore\n\nvar POLYGON_SERIALIZERS = makeStructureNS(NAMESPACE_URIS, {\n  'outerBoundaryIs': makeChildAppender(writeBoundaryIs),\n  'innerBoundaryIs': makeChildAppender(writeBoundaryIs)\n});\n/**\n * A factory for creating innerBoundaryIs nodes.\n * @const\n * @type {function(*, Array<*>, string=): (Node|undefined)}\n */\n\nvar INNER_BOUNDARY_NODE_FACTORY = makeSimpleNodeFactory('innerBoundaryIs');\n/**\n * A factory for creating outerBoundaryIs nodes.\n * @const\n * @type {function(*, Array<*>, string=): (Node|undefined)}\n */\n\nvar OUTER_BOUNDARY_NODE_FACTORY = makeSimpleNodeFactory('outerBoundaryIs');\n/**\n * @param {Element} node Node.\n * @param {Polygon} polygon Polygon.\n * @param {Array<*>} objectStack Object stack.\n */\n\nfunction writePolygon(node, polygon, objectStack) {\n  var linearRings = polygon.getLinearRings();\n  var outerRing = linearRings.shift();\n  var\n  /** @type {import(\"../xml.js\").NodeStackItem} */\n  context = {\n    node: node\n  }; // inner rings\n\n  pushSerializeAndPop(context, POLYGON_SERIALIZERS, INNER_BOUNDARY_NODE_FACTORY, linearRings, objectStack); // outer ring\n\n  pushSerializeAndPop(context, POLYGON_SERIALIZERS, OUTER_BOUNDARY_NODE_FACTORY, [outerRing], objectStack);\n}\n/**\n * @const\n * @type {Object<string, Object<string, import(\"../xml.js\").Serializer>>}\n */\n// @ts-ignore\n\n\nvar POLY_STYLE_SERIALIZERS = makeStructureNS(NAMESPACE_URIS, {\n  'color': makeChildAppender(writeColorTextNode),\n  'fill': makeChildAppender(writeBooleanTextNode),\n  'outline': makeChildAppender(writeBooleanTextNode)\n});\n/**\n * @param {Element} node Node.\n * @param {Style} style Style.\n * @param {Array<*>} objectStack Object stack.\n */\n\nfunction writePolyStyle(node, style, objectStack) {\n  var\n  /** @type {import(\"../xml.js\").NodeStackItem} */\n  context = {\n    node: node\n  };\n  var fill = style.getFill();\n  var stroke = style.getStroke();\n  var properties = {\n    'color': fill ? fill.getColor() : undefined,\n    'fill': fill ? undefined : false,\n    'outline': stroke ? undefined : false\n  };\n  var parentNode = objectStack[objectStack.length - 1].node;\n  var orderedKeys = POLY_STYLE_SEQUENCE[parentNode.namespaceURI];\n  var values = makeSequence(properties, orderedKeys);\n  pushSerializeAndPop(context, POLY_STYLE_SERIALIZERS, OBJECT_PROPERTY_NODE_FACTORY, values, objectStack, orderedKeys);\n}\n/**\n * @param {Node} node Node to append a TextNode with the scale to.\n * @param {number|undefined} scale Scale.\n */\n\n\nfunction writeScaleTextNode(node, scale) {\n  // the Math is to remove any excess decimals created by float arithmetic\n  writeDecimalTextNode(node, Math.round(scale * 1e6) / 1e6);\n}\n/**\n * @const\n * @type {Object<string, Array<string>>}\n */\n// @ts-ignore\n\n\nvar STYLE_SEQUENCE = makeStructureNS(NAMESPACE_URIS, ['IconStyle', 'LabelStyle', 'LineStyle', 'PolyStyle']);\n/**\n * @const\n * @type {Object<string, Object<string, import(\"../xml.js\").Serializer>>}\n */\n// @ts-ignore\n\nvar STYLE_SERIALIZERS = makeStructureNS(NAMESPACE_URIS, {\n  'IconStyle': makeChildAppender(writeIconStyle),\n  'LabelStyle': makeChildAppender(writeLabelStyle),\n  'LineStyle': makeChildAppender(writeLineStyle),\n  'PolyStyle': makeChildAppender(writePolyStyle)\n});\n/**\n * @param {Element} node Node.\n * @param {Object<string, Array<Style>>} styles Styles.\n * @param {Array<*>} objectStack Object stack.\n */\n\nfunction writeStyle(node, styles, objectStack) {\n  var\n  /** @type {import(\"../xml.js\").NodeStackItem} */\n  context = {\n    node: node\n  };\n  var properties = {};\n\n  if (styles.pointStyles.length) {\n    var textStyle = styles.pointStyles[0].getText();\n\n    if (textStyle) {\n      properties['LabelStyle'] = textStyle;\n    }\n\n    var imageStyle = styles.pointStyles[0].getImage();\n\n    if (imageStyle && typeof\n    /** @type {?} */\n    imageStyle.getSrc === 'function') {\n      properties['IconStyle'] = imageStyle;\n    }\n  }\n\n  if (styles.lineStyles.length) {\n    var strokeStyle = styles.lineStyles[0].getStroke();\n\n    if (strokeStyle) {\n      properties['LineStyle'] = strokeStyle;\n    }\n  }\n\n  if (styles.polyStyles.length) {\n    var strokeStyle = styles.polyStyles[0].getStroke();\n\n    if (strokeStyle && !properties['LineStyle']) {\n      properties['LineStyle'] = strokeStyle;\n    }\n\n    properties['PolyStyle'] = styles.polyStyles[0];\n  }\n\n  var parentNode = objectStack[objectStack.length - 1].node;\n  var orderedKeys = STYLE_SEQUENCE[parentNode.namespaceURI];\n  var values = makeSequence(properties, orderedKeys);\n  pushSerializeAndPop(context, STYLE_SERIALIZERS, OBJECT_PROPERTY_NODE_FACTORY, values, objectStack, orderedKeys);\n}\n/**\n * @param {Element} node Node to append a TextNode with the Vec2 to.\n * @param {Vec2} vec2 Vec2.\n */\n\n\nfunction writeVec2(node, vec2) {\n  node.setAttribute('x', String(vec2.x));\n  node.setAttribute('y', String(vec2.y));\n  node.setAttribute('xunits', vec2.xunits);\n  node.setAttribute('yunits', vec2.yunits);\n}\n\nexport default KML;","map":{"version":3,"mappings":"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","names":["Feature","Fill","GeometryCollection","GeometryLayout","GeometryType","Icon","IconAnchorUnits","IconOrigin","ImageState","LineString","MultiLineString","MultiPoint","MultiPolygon","Point","Polygon","Stroke","Style","Text","XMLFeature","OBJECT_PROPERTY_NODE_FACTORY","XML_SCHEMA_INSTANCE_URI","createElementNS","getAllTextContent","isDocument","makeArrayExtender","makeArrayPusher","makeChildAppender","makeObjectPropertySetter","makeReplacer","makeSequence","makeSimpleNodeFactory","makeStructureNS","parse","parseNode","pushParseAndPop","pushSerializeAndPop","asArray","assert","extend","includes","get","getProjection","readBoolean","readDecimal","readString","writeBooleanTextNode","writeCDATASection","writeDecimalTextNode","writeStringTextNode","toRadians","transformGeometryWithOptions","GX_NAMESPACE_URIS","NAMESPACE_URIS","SCHEMA_LOCATION","ICON_ANCHOR_UNITS_MAP","FRACTION","PIXELS","PLACEMARK_PARSERS","extendedDataParser","regionParser","readMultiGeometry","readLineString","readLinearRing","readPoint","readPolygon","readStyle","placemarkStyleMapParser","readStyleURL","readGxMultiTrack","readGxTrack","NETWORK_LINK_PARSERS","linkParser","LINK_PARSERS","readURI","REGION_PARSERS","latLonAltBoxParser","lodParser","KML_SEQUENCE","KML_SERIALIZERS","writeDocument","writePlacemark","DEFAULT_COLOR","DEFAULT_FILL_STYLE","getDefaultFillStyle","DEFAULT_IMAGE_STYLE_ANCHOR","DEFAULT_IMAGE_STYLE_ANCHOR_X_UNITS","DEFAULT_IMAGE_STYLE_ANCHOR_Y_UNITS","DEFAULT_IMAGE_STYLE_SIZE","DEFAULT_IMAGE_STYLE_SRC","DEFAULT_IMAGE_STYLE","getDefaultImageStyle","DEFAULT_NO_IMAGE_STYLE","DEFAULT_STROKE_STYLE","getDefaultStrokeStyle","DEFAULT_TEXT_STROKE_STYLE","DEFAULT_TEXT_STYLE","getDefaultTextStyle","DEFAULT_STYLE","getDefaultStyle","DEFAULT_STYLE_ARRAY","getDefaultStyleArray","scaleForSize","size","Math","min","createStyleDefaults","color","anchor","anchorOrigin","BOTTOM_LEFT","anchorXUnits","anchorYUnits","crossOrigin","rotation","scale","src","width","font","fill","stroke","image","text","zIndex","TEXTAREA","defaultIconUrlFunction","href","__extends","opt_options","_super","options","_this","dataProjection","defaultStyle_","defaultStyle","extractStyles_","extractStyles","undefined","writeStyles_","writeStyles","sharedStyles_","showPointNames_","showPointNames","crossOrigin_","iconUrlFunction_","iconUrlFunction","supportedMediaTypes","KML","node","objectStack","parsersNS","readDocumentOrFolder_","readPlacemark_","readSharedStyle_","bind","readSharedStyleMap_","features","object","feature","id","getAttribute","setId","geometry","setGeometry","style","styleUrl","styleFunction","createFeatureStyleFunction","setStyle","setProperties","call","styleUri","baseURI","window","location","url","URL","styleMapValue","readStyleMapValue","namespaceURI","getReadOptions","localName","n","firstElementChild","nextElementSibling","fs","readFeaturesFromNode","source","doc","readNameFromDocument","readNameFromNode","firstChild","nextSibling","nodeType","Node","ELEMENT_NODE","name_1","name_2","networkLinks","readNetworkLinksFromDocument","readNetworkLinksFromNode","obj","push","regions","readRegionFromDocument","readRegionFromNode","adaptOptions","kml","xmlnsUri","setAttributeNS","context","properties","length","orderedKeys","values","createNameStyleFunction","foundStyle","name","textOffset","textAlign","imageStyle","getImage","imageSize","getSize","imageScale","getScaleArray","getAnchor","textStyle","getText","clone","setFont","getFont","setScale","getScale","setFill","getFill","setStroke","getStroke","setText","setOffsetX","setOffsetY","setTextAlign","nameStyle","sharedStyles","resolution","drawName","multiGeometryPoints","getGeometry","getGeometriesArrayRecursive","filter","type","getType","POINT","MULTI_POINT","search","document","createElement","innerHTML","value","featureStyle","findStyle","baseStyle","concat","slice","styleValue","Array","isArray","readColor","s","m","exec","hexColor","parseInt","substr","readFlatCoordinates","flatCoordinates","replace","re","x","parseFloat","y","z","trim","readVec2","xunits","yunits","origin","TOP_LEFT","BOTTOM_RIGHT","TOP_RIGHT","readScale","STYLE_MAP_PARSERS","pairDataParser","ICON_STYLE_PARSERS","readIcon","iconStyleParser","styleObject","IconObject","drawIcon","Object","keys","hotSpot","test","offset","w","h","heading","imageStyle_1","offsetOrigin","imageScale_1","imageState","getImageState","IDLE","LOADING","listener_1","imageSize_1","resizeScale","unlistenImageChange","listenImageChange","load","LABEL_STYLE_PARSERS","labelStyleParser","LINE_STYLE_PARSERS","lineStyleParser","strokeStyle","POLY_STYLE_PARSERS","polyStyleParser","fillStyle","outline","FLAT_LINEAR_RING_PARSERS","readFlatLinearRing","gxCoordParser","gxTrackObject","coordinates","GX_MULTITRACK_GEOMETRY_PARSERS","lineStrings","GX_TRACK_PARSERS","whenParser","whens","i","ii","XYZM","ICON_PARSERS","iconObject","GEOMETRY_FLAT_COORDINATES_PARSERS","readFlatCoordinatesFromNode","EXTRUDE_AND_ALTITUDE_MODE_PARSERS","lineString","XYZ","polygon","MULTI_GEOMETRY_PARSERS","geometries","multiGeometry","homogeneous","layout","point","getLayout","getFlatCoordinates","setCommonGeometryProperties","LINE_STRING","POLYGON","GEOMETRY_COLLECTION","FLAT_LINEAR_RINGS_PARSERS","innerBoundaryIsParser","outerBoundaryIsParser","flatLinearRings","ends","STYLE_PARSERS","collection","MULTI_POLYGON","extrudes","tessellates","altitudeModes","hasExtrude","hasTessellate","hasAltitudeMode","set","DATA_PARSERS","dataParser","featureObject","displayName","toString","EXTENDED_DATA_PARSERS","schemaDataParser","PAIR_PARSERS","pairObject","key","placemarkObject","SCHEMA_DATA_PARSERS","simpleDataParser","data","LAT_LON_ALT_BOX_PARSERS","regionObject","extent","LOD_PARSERS","lodObject","INNER_BOUNDARY_IS_PARSERS","innerBoundaryFlatLinearRings","apply","OUTER_BOUNDARY_IS_PARSERS","flatLinearRing","when","Date","isNaN","writeColorTextNode","rgba","opacity","abgr","hex","floor","join","writeCoordinatesTextNode","stride","dimension","XY","XYM","d","EXTENDEDDATA_NODE_SERIALIZERS","writeDataNode","writeDataNodeValue","writeDataNodeName","pair","setAttribute","DOCUMENT_SERIALIZERS","DOCUMENT_NODE_FACTORY","opt_nodeName","parentNode","DATA_NODE_FACTORY","writeExtendedData","namesAndValues","names","ICON_SEQUENCE","ICON_SERIALIZERS","GX_NODE_FACTORY","writeIcon","icon","ICON_STYLE_SEQUENCE","ICON_STYLE_SERIALIZERS","writeVec2","writeScaleTextNode","writeIconStyle","getSrc","iconImageSize","getImageSize","iconProperties","origin_1","getOrigin","getRotation","getColor","LABEL_STYLE_SEQUENCE","LABEL_STYLE_SERIALIZERS","writeLabelStyle","LINE_STYLE_SEQUENCE","LINE_STYLE_SERIALIZERS","writeLineStyle","Number","getWidth","GEOMETRY_TYPE_TO_NODENAME","GEOMETRY_NODE_FACTORY","POINT_NODE_FACTORY","LINE_STRING_NODE_FACTORY","LINEAR_RING_NODE_FACTORY","POLYGON_NODE_FACTORY","MULTI_GEOMETRY_SERIALIZERS","writePrimitiveGeometry","writePolygon","writeMultiGeometry","factory","forEach","getPoints","MULTI_LINE_STRING","getLineStrings","getPolygons","BOUNDARY_IS_SERIALIZERS","writeBoundaryIs","linearRing","PLACEMARK_SERIALIZERS","writeStyle","PLACEMARK_SEQUENCE","EXTENDEDDATA_NODE_FACTORY","getId","getProperties","getGeometryName","sort","v","getStyleFunction","styles","styleArray","pointStyles","getGeometryFunction","lineStyles","polyStyles","sequence","PRIMITIVE_GEOMETRY_SEQUENCE","PRIMITIVE_GEOMETRY_SERIALIZERS","getStride","POLY_STYLE_SEQUENCE","POLYGON_SERIALIZERS","INNER_BOUNDARY_NODE_FACTORY","OUTER_BOUNDARY_NODE_FACTORY","linearRings","getLinearRings","outerRing","shift","POLY_STYLE_SERIALIZERS","writePolyStyle","round","STYLE_SEQUENCE","STYLE_SERIALIZERS","vec2","String"],"sourceRoot":"","sources":["../src/format/KML.js"],"sourcesContent":[null]},"metadata":{},"sourceType":"module"}