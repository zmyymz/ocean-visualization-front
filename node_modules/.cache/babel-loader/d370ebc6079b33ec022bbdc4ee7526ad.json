{"ast":null,"code":"import \"core-js/modules/es.error.cause.js\";\n\nvar __extends = this && this.__extends || function () {\n  var extendStatics = function (d, b) {\n    extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p];\n    };\n\n    return extendStatics(d, b);\n  };\n\n  return function (d, b) {\n    if (typeof b !== \"function\" && b !== null) throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\n    extendStatics(d, b);\n\n    function __() {\n      this.constructor = d;\n    }\n\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\n/**\n * @module ol/render/canvas/TextBuilder\n */\n\n\nimport CanvasBuilder from './Builder.js';\nimport CanvasInstruction from './Instruction.js';\nimport GeometryType from '../../geom/GeometryType.js';\nimport TextPlacement from '../../style/TextPlacement.js';\nimport { asColorLike } from '../../colorlike.js';\nimport { defaultFillStyle, defaultFont, defaultLineCap, defaultLineDash, defaultLineDashOffset, defaultLineJoin, defaultLineWidth, defaultMiterLimit, defaultPadding, defaultStrokeStyle, defaultTextAlign, defaultTextBaseline, registerFont } from '../canvas.js';\nimport { getUid } from '../../util.js';\nimport { intersects } from '../../extent.js';\nimport { matchingChunk } from '../../geom/flat/straightchunk.js';\n/**\n * @const\n * @enum {number}\n */\n\nexport var TEXT_ALIGN = {\n  'left': 0,\n  'end': 0,\n  'center': 0.5,\n  'right': 1,\n  'start': 1,\n  'top': 0,\n  'middle': 0.5,\n  'hanging': 0.2,\n  'alphabetic': 0.8,\n  'ideographic': 0.8,\n  'bottom': 1\n};\n\nvar CanvasTextBuilder =\n/** @class */\nfunction (_super) {\n  __extends(CanvasTextBuilder, _super);\n  /**\n   * @param {number} tolerance Tolerance.\n   * @param {import(\"../../extent.js\").Extent} maxExtent Maximum extent.\n   * @param {number} resolution Resolution.\n   * @param {number} pixelRatio Pixel ratio.\n   */\n\n\n  function CanvasTextBuilder(tolerance, maxExtent, resolution, pixelRatio) {\n    var _this = _super.call(this, tolerance, maxExtent, resolution, pixelRatio) || this;\n    /**\n     * @private\n     * @type {Array<HTMLCanvasElement>}\n     */\n\n\n    _this.labels_ = null;\n    /**\n     * @private\n     * @type {string|Array<string>}\n     */\n\n    _this.text_ = '';\n    /**\n     * @private\n     * @type {number}\n     */\n\n    _this.textOffsetX_ = 0;\n    /**\n     * @private\n     * @type {number}\n     */\n\n    _this.textOffsetY_ = 0;\n    /**\n     * @private\n     * @type {boolean|undefined}\n     */\n\n    _this.textRotateWithView_ = undefined;\n    /**\n     * @private\n     * @type {number}\n     */\n\n    _this.textRotation_ = 0;\n    /**\n     * @private\n     * @type {?import(\"../canvas.js\").FillState}\n     */\n\n    _this.textFillState_ = null;\n    /**\n     * @type {!Object<string, import(\"../canvas.js\").FillState>}\n     */\n\n    _this.fillStates = {};\n    /**\n     * @private\n     * @type {?import(\"../canvas.js\").StrokeState}\n     */\n\n    _this.textStrokeState_ = null;\n    /**\n     * @type {!Object<string, import(\"../canvas.js\").StrokeState>}\n     */\n\n    _this.strokeStates = {};\n    /**\n     * @private\n     * @type {import(\"../canvas.js\").TextState}\n     */\n\n    _this.textState_ =\n    /** @type {import(\"../canvas.js\").TextState} */\n    {};\n    /**\n     * @type {!Object<string, import(\"../canvas.js\").TextState>}\n     */\n\n    _this.textStates = {};\n    /**\n     * @private\n     * @type {string}\n     */\n\n    _this.textKey_ = '';\n    /**\n     * @private\n     * @type {string}\n     */\n\n    _this.fillKey_ = '';\n    /**\n     * @private\n     * @type {string}\n     */\n\n    _this.strokeKey_ = '';\n    /**\n     * Data shared with an image builder for combined decluttering.\n     * @private\n     * @type {import(\"../canvas.js\").DeclutterImageWithText}\n     */\n\n    _this.declutterImageWithText_ = undefined;\n    return _this;\n  }\n  /**\n   * @return {import(\"../canvas.js\").SerializableInstructions} the serializable instructions.\n   */\n\n\n  CanvasTextBuilder.prototype.finish = function () {\n    var instructions = _super.prototype.finish.call(this);\n\n    instructions.textStates = this.textStates;\n    instructions.fillStates = this.fillStates;\n    instructions.strokeStates = this.strokeStates;\n    return instructions;\n  };\n  /**\n   * @param {import(\"../../geom/SimpleGeometry.js\").default|import(\"../Feature.js\").default} geometry Geometry.\n   * @param {import(\"../../Feature.js\").FeatureLike} feature Feature.\n   */\n\n\n  CanvasTextBuilder.prototype.drawText = function (geometry, feature) {\n    var fillState = this.textFillState_;\n    var strokeState = this.textStrokeState_;\n    var textState = this.textState_;\n\n    if (this.text_ === '' || !textState || !fillState && !strokeState) {\n      return;\n    }\n\n    var coordinates = this.coordinates;\n    var begin = coordinates.length;\n    var geometryType = geometry.getType();\n    var flatCoordinates = null;\n    var stride = geometry.getStride();\n\n    if (textState.placement === TextPlacement.LINE && (geometryType == GeometryType.LINE_STRING || geometryType == GeometryType.MULTI_LINE_STRING || geometryType == GeometryType.POLYGON || geometryType == GeometryType.MULTI_POLYGON)) {\n      if (!intersects(this.getBufferedMaxExtent(), geometry.getExtent())) {\n        return;\n      }\n\n      var ends = void 0;\n      flatCoordinates = geometry.getFlatCoordinates();\n\n      if (geometryType == GeometryType.LINE_STRING) {\n        ends = [flatCoordinates.length];\n      } else if (geometryType == GeometryType.MULTI_LINE_STRING) {\n        ends =\n        /** @type {import(\"../../geom/MultiLineString.js\").default} */\n        geometry.getEnds();\n      } else if (geometryType == GeometryType.POLYGON) {\n        ends =\n        /** @type {import(\"../../geom/Polygon.js\").default} */\n        geometry.getEnds().slice(0, 1);\n      } else if (geometryType == GeometryType.MULTI_POLYGON) {\n        var endss =\n        /** @type {import(\"../../geom/MultiPolygon.js\").default} */\n        geometry.getEndss();\n        ends = [];\n\n        for (var i = 0, ii = endss.length; i < ii; ++i) {\n          ends.push(endss[i][0]);\n        }\n      }\n\n      this.beginGeometry(geometry, feature);\n      var textAlign = textState.textAlign;\n      var flatOffset = 0;\n      var flatEnd = void 0;\n\n      for (var o = 0, oo = ends.length; o < oo; ++o) {\n        if (textAlign == undefined) {\n          var range = matchingChunk(textState.maxAngle, flatCoordinates, flatOffset, ends[o], stride);\n          flatOffset = range[0];\n          flatEnd = range[1];\n        } else {\n          flatEnd = ends[o];\n        }\n\n        for (var i = flatOffset; i < flatEnd; i += stride) {\n          coordinates.push(flatCoordinates[i], flatCoordinates[i + 1]);\n        }\n\n        var end = coordinates.length;\n        flatOffset = ends[o];\n        this.drawChars_(begin, end);\n        begin = end;\n      }\n\n      this.endGeometry(feature);\n    } else {\n      var geometryWidths = textState.overflow ? null : [];\n\n      switch (geometryType) {\n        case GeometryType.POINT:\n        case GeometryType.MULTI_POINT:\n          flatCoordinates =\n          /** @type {import(\"../../geom/MultiPoint.js\").default} */\n          geometry.getFlatCoordinates();\n          break;\n\n        case GeometryType.LINE_STRING:\n          flatCoordinates =\n          /** @type {import(\"../../geom/LineString.js\").default} */\n          geometry.getFlatMidpoint();\n          break;\n\n        case GeometryType.CIRCLE:\n          flatCoordinates =\n          /** @type {import(\"../../geom/Circle.js\").default} */\n          geometry.getCenter();\n          break;\n\n        case GeometryType.MULTI_LINE_STRING:\n          flatCoordinates =\n          /** @type {import(\"../../geom/MultiLineString.js\").default} */\n          geometry.getFlatMidpoints();\n          stride = 2;\n          break;\n\n        case GeometryType.POLYGON:\n          flatCoordinates =\n          /** @type {import(\"../../geom/Polygon.js\").default} */\n          geometry.getFlatInteriorPoint();\n\n          if (!textState.overflow) {\n            geometryWidths.push(flatCoordinates[2] / this.resolution);\n          }\n\n          stride = 3;\n          break;\n\n        case GeometryType.MULTI_POLYGON:\n          var interiorPoints =\n          /** @type {import(\"../../geom/MultiPolygon.js\").default} */\n          geometry.getFlatInteriorPoints();\n          flatCoordinates = [];\n\n          for (var i = 0, ii = interiorPoints.length; i < ii; i += 3) {\n            if (!textState.overflow) {\n              geometryWidths.push(interiorPoints[i + 2] / this.resolution);\n            }\n\n            flatCoordinates.push(interiorPoints[i], interiorPoints[i + 1]);\n          }\n\n          if (flatCoordinates.length === 0) {\n            return;\n          }\n\n          stride = 2;\n          break;\n\n        default:\n      }\n\n      var end = this.appendFlatPointCoordinates(flatCoordinates, stride);\n\n      if (end === begin) {\n        return;\n      }\n\n      if (geometryWidths && (end - begin) / 2 !== flatCoordinates.length / stride) {\n        var beg_1 = begin / 2;\n        geometryWidths = geometryWidths.filter(function (w, i) {\n          var keep = coordinates[(beg_1 + i) * 2] === flatCoordinates[i * stride] && coordinates[(beg_1 + i) * 2 + 1] === flatCoordinates[i * stride + 1];\n\n          if (!keep) {\n            --beg_1;\n          }\n\n          return keep;\n        });\n      }\n\n      this.saveTextStates_();\n\n      if (textState.backgroundFill || textState.backgroundStroke) {\n        this.setFillStrokeStyle(textState.backgroundFill, textState.backgroundStroke);\n\n        if (textState.backgroundFill) {\n          this.updateFillStyle(this.state, this.createFill);\n          this.hitDetectionInstructions.push(this.createFill(this.state));\n        }\n\n        if (textState.backgroundStroke) {\n          this.updateStrokeStyle(this.state, this.applyStroke);\n          this.hitDetectionInstructions.push(this.createStroke(this.state));\n        }\n      }\n\n      this.beginGeometry(geometry, feature); // adjust padding for negative scale\n\n      var padding = textState.padding;\n\n      if (padding != defaultPadding && (textState.scale[0] < 0 || textState.scale[1] < 0)) {\n        var p0 = textState.padding[0];\n        var p1 = textState.padding[1];\n        var p2 = textState.padding[2];\n        var p3 = textState.padding[3];\n\n        if (textState.scale[0] < 0) {\n          p1 = -p1;\n          p3 = -p3;\n        }\n\n        if (textState.scale[1] < 0) {\n          p0 = -p0;\n          p2 = -p2;\n        }\n\n        padding = [p0, p1, p2, p3];\n      } // The image is unknown at this stage so we pass null; it will be computed at render time.\n      // For clarity, we pass NaN for offsetX, offsetY, width and height, which will be computed at\n      // render time.\n\n\n      var pixelRatio_1 = this.pixelRatio;\n      this.instructions.push([CanvasInstruction.DRAW_IMAGE, begin, end, null, NaN, NaN, NaN, 1, 0, 0, this.textRotateWithView_, this.textRotation_, [1, 1], NaN, this.declutterImageWithText_, padding == defaultPadding ? defaultPadding : padding.map(function (p) {\n        return p * pixelRatio_1;\n      }), !!textState.backgroundFill, !!textState.backgroundStroke, this.text_, this.textKey_, this.strokeKey_, this.fillKey_, this.textOffsetX_, this.textOffsetY_, geometryWidths]);\n      var scale = 1 / pixelRatio_1;\n      this.hitDetectionInstructions.push([CanvasInstruction.DRAW_IMAGE, begin, end, null, NaN, NaN, NaN, 1, 0, 0, this.textRotateWithView_, this.textRotation_, [scale, scale], NaN, this.declutterImageWithText_, padding, !!textState.backgroundFill, !!textState.backgroundStroke, this.text_, this.textKey_, this.strokeKey_, this.fillKey_, this.textOffsetX_, this.textOffsetY_, geometryWidths]);\n      this.endGeometry(feature);\n    }\n  };\n  /**\n   * @private\n   */\n\n\n  CanvasTextBuilder.prototype.saveTextStates_ = function () {\n    var strokeState = this.textStrokeState_;\n    var textState = this.textState_;\n    var fillState = this.textFillState_;\n    var strokeKey = this.strokeKey_;\n\n    if (strokeState) {\n      if (!(strokeKey in this.strokeStates)) {\n        this.strokeStates[strokeKey] = {\n          strokeStyle: strokeState.strokeStyle,\n          lineCap: strokeState.lineCap,\n          lineDashOffset: strokeState.lineDashOffset,\n          lineWidth: strokeState.lineWidth,\n          lineJoin: strokeState.lineJoin,\n          miterLimit: strokeState.miterLimit,\n          lineDash: strokeState.lineDash\n        };\n      }\n    }\n\n    var textKey = this.textKey_;\n\n    if (!(textKey in this.textStates)) {\n      this.textStates[textKey] = {\n        font: textState.font,\n        textAlign: textState.textAlign || defaultTextAlign,\n        textBaseline: textState.textBaseline || defaultTextBaseline,\n        scale: textState.scale\n      };\n    }\n\n    var fillKey = this.fillKey_;\n\n    if (fillState) {\n      if (!(fillKey in this.fillStates)) {\n        this.fillStates[fillKey] = {\n          fillStyle: fillState.fillStyle\n        };\n      }\n    }\n  };\n  /**\n   * @private\n   * @param {number} begin Begin.\n   * @param {number} end End.\n   */\n\n\n  CanvasTextBuilder.prototype.drawChars_ = function (begin, end) {\n    var strokeState = this.textStrokeState_;\n    var textState = this.textState_;\n    var strokeKey = this.strokeKey_;\n    var textKey = this.textKey_;\n    var fillKey = this.fillKey_;\n    this.saveTextStates_();\n    var pixelRatio = this.pixelRatio;\n    var baseline = TEXT_ALIGN[textState.textBaseline];\n    var offsetY = this.textOffsetY_ * pixelRatio;\n    var text = this.text_;\n    var strokeWidth = strokeState ? strokeState.lineWidth * Math.abs(textState.scale[0]) / 2 : 0;\n    this.instructions.push([CanvasInstruction.DRAW_CHARS, begin, end, baseline, textState.overflow, fillKey, textState.maxAngle, pixelRatio, offsetY, strokeKey, strokeWidth * pixelRatio, text, textKey, 1]);\n    this.hitDetectionInstructions.push([CanvasInstruction.DRAW_CHARS, begin, end, baseline, textState.overflow, fillKey, textState.maxAngle, 1, offsetY, strokeKey, strokeWidth, text, textKey, 1 / pixelRatio]);\n  };\n  /**\n   * @param {import(\"../../style/Text.js\").default} textStyle Text style.\n   * @param {Object} [opt_sharedData] Shared data.\n   */\n\n\n  CanvasTextBuilder.prototype.setTextStyle = function (textStyle, opt_sharedData) {\n    var textState, fillState, strokeState;\n\n    if (!textStyle) {\n      this.text_ = '';\n    } else {\n      var textFillStyle = textStyle.getFill();\n\n      if (!textFillStyle) {\n        fillState = null;\n        this.textFillState_ = fillState;\n      } else {\n        fillState = this.textFillState_;\n\n        if (!fillState) {\n          fillState =\n          /** @type {import(\"../canvas.js\").FillState} */\n          {};\n          this.textFillState_ = fillState;\n        }\n\n        fillState.fillStyle = asColorLike(textFillStyle.getColor() || defaultFillStyle);\n      }\n\n      var textStrokeStyle = textStyle.getStroke();\n\n      if (!textStrokeStyle) {\n        strokeState = null;\n        this.textStrokeState_ = strokeState;\n      } else {\n        strokeState = this.textStrokeState_;\n\n        if (!strokeState) {\n          strokeState =\n          /** @type {import(\"../canvas.js\").StrokeState} */\n          {};\n          this.textStrokeState_ = strokeState;\n        }\n\n        var lineDash = textStrokeStyle.getLineDash();\n        var lineDashOffset = textStrokeStyle.getLineDashOffset();\n        var lineWidth = textStrokeStyle.getWidth();\n        var miterLimit = textStrokeStyle.getMiterLimit();\n        strokeState.lineCap = textStrokeStyle.getLineCap() || defaultLineCap;\n        strokeState.lineDash = lineDash ? lineDash.slice() : defaultLineDash;\n        strokeState.lineDashOffset = lineDashOffset === undefined ? defaultLineDashOffset : lineDashOffset;\n        strokeState.lineJoin = textStrokeStyle.getLineJoin() || defaultLineJoin;\n        strokeState.lineWidth = lineWidth === undefined ? defaultLineWidth : lineWidth;\n        strokeState.miterLimit = miterLimit === undefined ? defaultMiterLimit : miterLimit;\n        strokeState.strokeStyle = asColorLike(textStrokeStyle.getColor() || defaultStrokeStyle);\n      }\n\n      textState = this.textState_;\n      var font = textStyle.getFont() || defaultFont;\n      registerFont(font);\n      var textScale = textStyle.getScaleArray();\n      textState.overflow = textStyle.getOverflow();\n      textState.font = font;\n      textState.maxAngle = textStyle.getMaxAngle();\n      textState.placement = textStyle.getPlacement();\n      textState.textAlign = textStyle.getTextAlign();\n      textState.textBaseline = textStyle.getTextBaseline() || defaultTextBaseline;\n      textState.backgroundFill = textStyle.getBackgroundFill();\n      textState.backgroundStroke = textStyle.getBackgroundStroke();\n      textState.padding = textStyle.getPadding() || defaultPadding;\n      textState.scale = textScale === undefined ? [1, 1] : textScale;\n      var textOffsetX = textStyle.getOffsetX();\n      var textOffsetY = textStyle.getOffsetY();\n      var textRotateWithView = textStyle.getRotateWithView();\n      var textRotation = textStyle.getRotation();\n      this.text_ = textStyle.getText() || '';\n      this.textOffsetX_ = textOffsetX === undefined ? 0 : textOffsetX;\n      this.textOffsetY_ = textOffsetY === undefined ? 0 : textOffsetY;\n      this.textRotateWithView_ = textRotateWithView === undefined ? false : textRotateWithView;\n      this.textRotation_ = textRotation === undefined ? 0 : textRotation;\n      this.strokeKey_ = strokeState ? (typeof strokeState.strokeStyle == 'string' ? strokeState.strokeStyle : getUid(strokeState.strokeStyle)) + strokeState.lineCap + strokeState.lineDashOffset + '|' + strokeState.lineWidth + strokeState.lineJoin + strokeState.miterLimit + '[' + strokeState.lineDash.join() + ']' : '';\n      this.textKey_ = textState.font + textState.scale + (textState.textAlign || '?') + (textState.textBaseline || '?');\n      this.fillKey_ = fillState ? typeof fillState.fillStyle == 'string' ? fillState.fillStyle : '|' + getUid(fillState.fillStyle) : '';\n    }\n\n    this.declutterImageWithText_ = opt_sharedData;\n  };\n\n  return CanvasTextBuilder;\n}(CanvasBuilder);\n\nexport default CanvasTextBuilder;","map":{"version":3,"mappings":"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","names":["CanvasBuilder","CanvasInstruction","GeometryType","TextPlacement","asColorLike","defaultFillStyle","defaultFont","defaultLineCap","defaultLineDash","defaultLineDashOffset","defaultLineJoin","defaultLineWidth","defaultMiterLimit","defaultPadding","defaultStrokeStyle","defaultTextAlign","defaultTextBaseline","registerFont","getUid","intersects","matchingChunk","TEXT_ALIGN","__extends","tolerance","maxExtent","resolution","pixelRatio","_super","_this","labels_","text_","textOffsetX_","textOffsetY_","textRotateWithView_","undefined","textRotation_","textFillState_","fillStates","textStrokeState_","strokeStates","textState_","textStates","textKey_","fillKey_","strokeKey_","declutterImageWithText_","CanvasTextBuilder","instructions","finish","call","geometry","feature","fillState","strokeState","textState","coordinates","begin","length","geometryType","getType","flatCoordinates","stride","getStride","placement","LINE","LINE_STRING","MULTI_LINE_STRING","POLYGON","MULTI_POLYGON","getBufferedMaxExtent","getExtent","ends","getFlatCoordinates","getEnds","slice","endss","getEndss","i","ii","push","beginGeometry","textAlign","flatOffset","flatEnd","o","oo","range","maxAngle","end","drawChars_","endGeometry","geometryWidths","overflow","POINT","MULTI_POINT","getFlatMidpoint","CIRCLE","getCenter","getFlatMidpoints","getFlatInteriorPoint","interiorPoints","getFlatInteriorPoints","appendFlatPointCoordinates","beg_1","filter","w","keep","saveTextStates_","backgroundFill","backgroundStroke","setFillStrokeStyle","updateFillStyle","state","createFill","hitDetectionInstructions","updateStrokeStyle","applyStroke","createStroke","padding","scale","p0","p1","p2","p3","pixelRatio_1","DRAW_IMAGE","NaN","map","p","strokeKey","strokeStyle","lineCap","lineDashOffset","lineWidth","lineJoin","miterLimit","lineDash","textKey","font","textBaseline","fillKey","fillStyle","baseline","offsetY","text","strokeWidth","Math","abs","DRAW_CHARS","textStyle","opt_sharedData","textFillStyle","getFill","getColor","textStrokeStyle","getStroke","getLineDash","getLineDashOffset","getWidth","getMiterLimit","getLineCap","getLineJoin","getFont","textScale","getScaleArray","getOverflow","getMaxAngle","getPlacement","getTextAlign","getTextBaseline","getBackgroundFill","getBackgroundStroke","getPadding","textOffsetX","getOffsetX","textOffsetY","getOffsetY","textRotateWithView","getRotateWithView","textRotation","getRotation","getText","join"],"sourceRoot":"","sources":["../../src/render/canvas/TextBuilder.js"],"sourcesContent":[null]},"metadata":{},"sourceType":"module"}