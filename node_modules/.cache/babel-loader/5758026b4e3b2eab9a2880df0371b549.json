{"ast":null,"code":"import _classCallCheck from \"D:/MyFile/WebCode/ocean-vis/node_modules/@babel/runtime/helpers/esm/classCallCheck.js\";\nimport _createClass from \"D:/MyFile/WebCode/ocean-vis/node_modules/@babel/runtime/helpers/esm/createClass.js\";\nimport \"core-js/modules/es.error.cause.js\";\nimport \"core-js/modules/es.object.to-string.js\";\nimport \"core-js/modules/es.array.splice.js\";\nimport \"core-js/modules/web.dom-collections.for-each.js\";\nimport \"core-js/modules/es.array.map.js\";\nimport \"core-js/modules/es.array.find-index.js\";\nimport \"core-js/modules/es.object.keys.js\";\nimport { reactive } from 'vue';\nimport '../../../../utils/index.mjs';\nimport { markNodeData, NODE_KEY } from './util.mjs';\nimport { hasOwn } from '@vue/shared';\n\nvar getChildState = function getChildState(node) {\n  var all = true;\n  var none = true;\n  var allWithoutDisable = true;\n\n  for (var i = 0, j = node.length; i < j; i++) {\n    var n = node[i];\n\n    if (n.checked !== true || n.indeterminate) {\n      all = false;\n\n      if (!n.disabled) {\n        allWithoutDisable = false;\n      }\n    }\n\n    if (n.checked !== false || n.indeterminate) {\n      none = false;\n    }\n  }\n\n  return {\n    all: all,\n    none: none,\n    allWithoutDisable: allWithoutDisable,\n    half: !all && !none\n  };\n};\n\nvar reInitChecked = function reInitChecked(node) {\n  if (node.childNodes.length === 0) return;\n\n  var _getChildState = getChildState(node.childNodes),\n      all = _getChildState.all,\n      none = _getChildState.none,\n      half = _getChildState.half;\n\n  if (all) {\n    node.checked = true;\n    node.indeterminate = false;\n  } else if (half) {\n    node.checked = false;\n    node.indeterminate = true;\n  } else if (none) {\n    node.checked = false;\n    node.indeterminate = false;\n  }\n\n  var parent = node.parent;\n  if (!parent || parent.level === 0) return;\n\n  if (!node.store.checkStrictly) {\n    reInitChecked(parent);\n  }\n};\n\nvar getPropertyFromData = function getPropertyFromData(node, prop) {\n  var props = node.store.props;\n  var data = node.data || {};\n  var config = props[prop];\n\n  if (typeof config === \"function\") {\n    return config(data, node);\n  } else if (typeof config === \"string\") {\n    return data[config];\n  } else if (typeof config === \"undefined\") {\n    var dataProp = data[prop];\n    return dataProp === void 0 ? \"\" : dataProp;\n  }\n};\n\nvar nodeIdSeed = 0;\n\nvar Node = /*#__PURE__*/function () {\n  function Node(options) {\n    _classCallCheck(this, Node);\n\n    this.id = nodeIdSeed++;\n    this.text = null;\n    this.checked = false;\n    this.indeterminate = false;\n    this.data = null;\n    this.expanded = false;\n    this.parent = null;\n    this.visible = true;\n    this.isCurrent = false;\n    this.canFocus = false;\n\n    for (var name in options) {\n      if (hasOwn(options, name)) {\n        this[name] = options[name];\n      }\n    }\n\n    this.level = 0;\n    this.loaded = false;\n    this.childNodes = [];\n    this.loading = false;\n\n    if (this.parent) {\n      this.level = this.parent.level + 1;\n    }\n  }\n\n  _createClass(Node, [{\n    key: \"initialize\",\n    value: function initialize() {\n      var store = this.store;\n\n      if (!store) {\n        throw new Error(\"[Node]store is required!\");\n      }\n\n      store.registerNode(this);\n      var props = store.props;\n\n      if (props && typeof props.isLeaf !== \"undefined\") {\n        var isLeaf = getPropertyFromData(this, \"isLeaf\");\n\n        if (typeof isLeaf === \"boolean\") {\n          this.isLeafByUser = isLeaf;\n        }\n      }\n\n      if (store.lazy !== true && this.data) {\n        this.setData(this.data);\n\n        if (store.defaultExpandAll) {\n          this.expanded = true;\n          this.canFocus = true;\n        }\n      } else if (this.level > 0 && store.lazy && store.defaultExpandAll) {\n        this.expand();\n      }\n\n      if (!Array.isArray(this.data)) {\n        markNodeData(this, this.data);\n      }\n\n      if (!this.data) return;\n      var defaultExpandedKeys = store.defaultExpandedKeys;\n      var key = store.key;\n\n      if (key && defaultExpandedKeys && defaultExpandedKeys.indexOf(this.key) !== -1) {\n        this.expand(null, store.autoExpandParent);\n      }\n\n      if (key && store.currentNodeKey !== void 0 && this.key === store.currentNodeKey) {\n        store.currentNode = this;\n        store.currentNode.isCurrent = true;\n      }\n\n      if (store.lazy) {\n        store._initDefaultCheckedNode(this);\n      }\n\n      this.updateLeafState();\n      if (this.parent && (this.level === 1 || this.parent.expanded === true)) this.canFocus = true;\n    }\n  }, {\n    key: \"setData\",\n    value: function setData(data) {\n      if (!Array.isArray(data)) {\n        markNodeData(this, data);\n      }\n\n      this.data = data;\n      this.childNodes = [];\n      var children;\n\n      if (this.level === 0 && this.data instanceof Array) {\n        children = this.data;\n      } else {\n        children = getPropertyFromData(this, \"children\") || [];\n      }\n\n      for (var i = 0, j = children.length; i < j; i++) {\n        this.insertChild({\n          data: children[i]\n        });\n      }\n    }\n  }, {\n    key: \"label\",\n    get: function get() {\n      return getPropertyFromData(this, \"label\");\n    }\n  }, {\n    key: \"key\",\n    get: function get() {\n      var nodeKey = this.store.key;\n      if (this.data) return this.data[nodeKey];\n      return null;\n    }\n  }, {\n    key: \"disabled\",\n    get: function get() {\n      return getPropertyFromData(this, \"disabled\");\n    }\n  }, {\n    key: \"nextSibling\",\n    get: function get() {\n      var parent = this.parent;\n\n      if (parent) {\n        var index = parent.childNodes.indexOf(this);\n\n        if (index > -1) {\n          return parent.childNodes[index + 1];\n        }\n      }\n\n      return null;\n    }\n  }, {\n    key: \"previousSibling\",\n    get: function get() {\n      var parent = this.parent;\n\n      if (parent) {\n        var index = parent.childNodes.indexOf(this);\n\n        if (index > -1) {\n          return index > 0 ? parent.childNodes[index - 1] : null;\n        }\n      }\n\n      return null;\n    }\n  }, {\n    key: \"contains\",\n    value: function contains(target) {\n      var deep = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : true;\n      return (this.childNodes || []).some(function (child) {\n        return child === target || deep && child.contains(target);\n      });\n    }\n  }, {\n    key: \"remove\",\n    value: function remove() {\n      var parent = this.parent;\n\n      if (parent) {\n        parent.removeChild(this);\n      }\n    }\n  }, {\n    key: \"insertChild\",\n    value: function insertChild(child, index, batch) {\n      if (!child) throw new Error(\"InsertChild error: child is required.\");\n\n      if (!(child instanceof Node)) {\n        if (!batch) {\n          var children = this.getChildren(true);\n\n          if (children.indexOf(child.data) === -1) {\n            if (typeof index === \"undefined\" || index < 0) {\n              children.push(child.data);\n            } else {\n              children.splice(index, 0, child.data);\n            }\n          }\n        }\n\n        Object.assign(child, {\n          parent: this,\n          store: this.store\n        });\n        child = reactive(new Node(child));\n\n        if (child instanceof Node) {\n          child.initialize();\n        }\n      }\n\n      ;\n      child.level = this.level + 1;\n\n      if (typeof index === \"undefined\" || index < 0) {\n        this.childNodes.push(child);\n      } else {\n        this.childNodes.splice(index, 0, child);\n      }\n\n      this.updateLeafState();\n    }\n  }, {\n    key: \"insertBefore\",\n    value: function insertBefore(child, ref) {\n      var index;\n\n      if (ref) {\n        index = this.childNodes.indexOf(ref);\n      }\n\n      this.insertChild(child, index);\n    }\n  }, {\n    key: \"insertAfter\",\n    value: function insertAfter(child, ref) {\n      var index;\n\n      if (ref) {\n        index = this.childNodes.indexOf(ref);\n        if (index !== -1) index += 1;\n      }\n\n      this.insertChild(child, index);\n    }\n  }, {\n    key: \"removeChild\",\n    value: function removeChild(child) {\n      var children = this.getChildren() || [];\n      var dataIndex = children.indexOf(child.data);\n\n      if (dataIndex > -1) {\n        children.splice(dataIndex, 1);\n      }\n\n      var index = this.childNodes.indexOf(child);\n\n      if (index > -1) {\n        this.store && this.store.deregisterNode(child);\n        child.parent = null;\n        this.childNodes.splice(index, 1);\n      }\n\n      this.updateLeafState();\n    }\n  }, {\n    key: \"removeChildByData\",\n    value: function removeChildByData(data) {\n      var targetNode = null;\n\n      for (var i = 0; i < this.childNodes.length; i++) {\n        if (this.childNodes[i].data === data) {\n          targetNode = this.childNodes[i];\n          break;\n        }\n      }\n\n      if (targetNode) {\n        this.removeChild(targetNode);\n      }\n    }\n  }, {\n    key: \"expand\",\n    value: function expand(callback, expandParent) {\n      var _this = this;\n\n      var done = function done() {\n        if (expandParent) {\n          var parent = _this.parent;\n\n          while (parent.level > 0) {\n            parent.expanded = true;\n            parent = parent.parent;\n          }\n        }\n\n        _this.expanded = true;\n        if (callback) callback();\n\n        _this.childNodes.forEach(function (item) {\n          item.canFocus = true;\n        });\n      };\n\n      if (this.shouldLoadData()) {\n        this.loadData(function (data) {\n          if (Array.isArray(data)) {\n            if (_this.checked) {\n              _this.setChecked(true, true);\n            } else if (!_this.store.checkStrictly) {\n              reInitChecked(_this);\n            }\n\n            done();\n          }\n        });\n      } else {\n        done();\n      }\n    }\n  }, {\n    key: \"doCreateChildren\",\n    value: function doCreateChildren(array) {\n      var _this2 = this;\n\n      var defaultProps = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n      array.forEach(function (item) {\n        _this2.insertChild(Object.assign({\n          data: item\n        }, defaultProps), void 0, true);\n      });\n    }\n  }, {\n    key: \"collapse\",\n    value: function collapse() {\n      this.expanded = false;\n      this.childNodes.forEach(function (item) {\n        item.canFocus = false;\n      });\n    }\n  }, {\n    key: \"shouldLoadData\",\n    value: function shouldLoadData() {\n      return this.store.lazy === true && this.store.load && !this.loaded;\n    }\n  }, {\n    key: \"updateLeafState\",\n    value: function updateLeafState() {\n      if (this.store.lazy === true && this.loaded !== true && typeof this.isLeafByUser !== \"undefined\") {\n        this.isLeaf = this.isLeafByUser;\n        return;\n      }\n\n      var childNodes = this.childNodes;\n\n      if (!this.store.lazy || this.store.lazy === true && this.loaded === true) {\n        this.isLeaf = !childNodes || childNodes.length === 0;\n        return;\n      }\n\n      this.isLeaf = false;\n    }\n  }, {\n    key: \"setChecked\",\n    value: function setChecked(value, deep, recursion, passValue) {\n      var _this3 = this;\n\n      this.indeterminate = value === \"half\";\n      this.checked = value === true;\n      if (this.store.checkStrictly) return;\n\n      if (!(this.shouldLoadData() && !this.store.checkDescendants)) {\n        var _getChildState2 = getChildState(this.childNodes),\n            all = _getChildState2.all,\n            allWithoutDisable = _getChildState2.allWithoutDisable;\n\n        if (!this.isLeaf && !all && allWithoutDisable) {\n          this.checked = false;\n          value = false;\n        }\n\n        var handleDescendants = function handleDescendants() {\n          if (deep) {\n            var childNodes = _this3.childNodes;\n\n            for (var i = 0, j = childNodes.length; i < j; i++) {\n              var child = childNodes[i];\n              passValue = passValue || value !== false;\n              var isCheck = child.disabled ? child.checked : passValue;\n              child.setChecked(isCheck, deep, true, passValue);\n            }\n\n            var _getChildState3 = getChildState(childNodes),\n                half = _getChildState3.half,\n                all2 = _getChildState3.all;\n\n            if (!all2) {\n              _this3.checked = all2;\n              _this3.indeterminate = half;\n            }\n          }\n        };\n\n        if (this.shouldLoadData()) {\n          this.loadData(function () {\n            handleDescendants();\n            reInitChecked(_this3);\n          }, {\n            checked: value !== false\n          });\n          return;\n        } else {\n          handleDescendants();\n        }\n      }\n\n      var parent = this.parent;\n      if (!parent || parent.level === 0) return;\n\n      if (!recursion) {\n        reInitChecked(parent);\n      }\n    }\n  }, {\n    key: \"getChildren\",\n    value: function getChildren() {\n      var forceInit = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : false;\n      if (this.level === 0) return this.data;\n      var data = this.data;\n      if (!data) return null;\n      var props = this.store.props;\n      var children = \"children\";\n\n      if (props) {\n        children = props.children || \"children\";\n      }\n\n      if (data[children] === void 0) {\n        data[children] = null;\n      }\n\n      if (forceInit && !data[children]) {\n        data[children] = [];\n      }\n\n      return data[children];\n    }\n  }, {\n    key: \"updateChildren\",\n    value: function updateChildren() {\n      var _this4 = this;\n\n      var newData = this.getChildren() || [];\n      var oldData = this.childNodes.map(function (node) {\n        return node.data;\n      });\n      var newDataMap = {};\n      var newNodes = [];\n      newData.forEach(function (item, index) {\n        var key = item[NODE_KEY];\n        var isNodeExists = !!key && oldData.findIndex(function (data) {\n          return data[NODE_KEY] === key;\n        }) >= 0;\n\n        if (isNodeExists) {\n          newDataMap[key] = {\n            index: index,\n            data: item\n          };\n        } else {\n          newNodes.push({\n            index: index,\n            data: item\n          });\n        }\n      });\n\n      if (!this.store.lazy) {\n        oldData.forEach(function (item) {\n          if (!newDataMap[item[NODE_KEY]]) _this4.removeChildByData(item);\n        });\n      }\n\n      newNodes.forEach(function (_ref) {\n        var index = _ref.index,\n            data = _ref.data;\n\n        _this4.insertChild({\n          data: data\n        }, index);\n      });\n      this.updateLeafState();\n    }\n  }, {\n    key: \"loadData\",\n    value: function loadData(callback) {\n      var _this5 = this;\n\n      var defaultProps = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n\n      if (this.store.lazy === true && this.store.load && !this.loaded && (!this.loading || Object.keys(defaultProps).length)) {\n        this.loading = true;\n\n        var resolve = function resolve(children) {\n          _this5.loaded = true;\n          _this5.loading = false;\n          _this5.childNodes = [];\n\n          _this5.doCreateChildren(children, defaultProps);\n\n          _this5.updateLeafState();\n\n          if (callback) {\n            callback.call(_this5, children);\n          }\n        };\n\n        this.store.load(this, resolve);\n      } else {\n        if (callback) {\n          callback.call(this);\n        }\n      }\n    }\n  }]);\n\n  return Node;\n}();\n\nexport { Node as default, getChildState };","map":{"version":3,"mappings":";;;;;;;;;;;;;;AAGY,IAACA,aAAa,GAAG,SAAhBA,aAAgB,CAACC,IAAD,EAAU;AACrC,MAAIC,GAAG,GAAG,IAAV;AACA,MAAIC,IAAI,GAAG,IAAX;AACA,MAAIC,iBAAiB,GAAG,IAAxB;;AACA,OAAK,IAAIC,CAAC,GAAG,CAAR,EAAWC,CAAC,GAAGL,IAAI,CAACM,MAAzB,EAAiCF,CAAC,GAAGC,CAArC,EAAwCD,CAAC,EAAzC,EAA6C;AAC3C,QAAMG,CAAC,GAAGP,IAAI,CAACI,CAAD,CAAd;;AACA,QAAIG,CAAC,CAACC,OAAF,KAAc,IAAd,IAAsBD,CAAC,CAACE,aAA5B,EAA2C;AACzCR,SAAG,GAAG,KAAN;;AACA,UAAI,CAACM,CAAC,CAACG,QAAP,EAAiB;AACfP,yBAAiB,GAAG,KAApB;AACD;AACF;;AACD,QAAII,CAAC,CAACC,OAAF,KAAc,KAAd,IAAuBD,CAAC,CAACE,aAA7B,EAA4C;AAC1CP,UAAI,GAAG,KAAP;AACD;AACF;;AACD,SAAO;AAAED,OAAG,EAAHA,GAAF;AAAOC,QAAI,EAAJA,IAAP;AAAaC,qBAAiB,EAAjBA,iBAAb;AAAgCQ,QAAI,EAAE,CAACV,GAAD,IAAQ,CAACC;AAA/C,GAAP;AACF,CAjBY;;AAkBZ,IAAMU,aAAa,GAAG,SAAhBA,aAAgB,CAASZ,IAAT,EAAe;AACnC,MAAIA,IAAI,CAACa,UAAL,CAAgBP,MAAhB,KAA2B,CAA/B,EACE;;AACF,uBAA4BP,aAAa,CAACC,IAAI,CAACa,UAAN,CAAzC;AAAA,MAAQZ,GAAR,kBAAQA,GAAR;AAAA,MAAaC,IAAb,kBAAaA,IAAb;AAAA,MAAmBS,IAAnB,kBAAmBA,IAAnB;;AACA,MAAIV,GAAJ,EAAS;AACPD,QAAI,CAACQ,OAAL,GAAe,IAAf;AACAR,QAAI,CAACS,aAAL,GAAqB,KAArB;AACD,GAHD,MAGO,IAAIE,IAAJ,EAAU;AACfX,QAAI,CAACQ,OAAL,GAAe,KAAf;AACAR,QAAI,CAACS,aAAL,GAAqB,IAArB;AACD,GAHM,MAGA,IAAIP,IAAJ,EAAU;AACfF,QAAI,CAACQ,OAAL,GAAe,KAAf;AACAR,QAAI,CAACS,aAAL,GAAqB,KAArB;AACD;;AACD,MAAMK,MAAM,GAAGd,IAAI,CAACc,MAApB;AACA,MAAI,CAACA,MAAD,IAAWA,MAAM,CAACC,KAAP,KAAiB,CAAhC,EACE;;AACF,MAAI,CAACf,IAAI,CAACgB,KAAL,CAAWC,aAAhB,EAA+B;AAC7BL,iBAAa,CAACE,MAAD,CAAb;AACD;AACF,CApBD;;AAqBA,IAAMI,mBAAmB,GAAG,SAAtBA,mBAAsB,CAASlB,IAAT,EAAemB,IAAf,EAAqB;AAC/C,MAAMC,KAAK,GAAGpB,IAAI,CAACgB,KAAL,CAAWI,KAAzB;AACA,MAAMC,IAAI,GAAGrB,IAAI,CAACqB,IAAL,IAAa,EAA1B;AACA,MAAMC,MAAM,GAAGF,KAAK,CAACD,IAAD,CAApB;;AACA,MAAI,OAAOG,MAAP,KAAkB,UAAtB,EAAkC;AAChC,WAAOA,MAAM,CAACD,IAAD,EAAOrB,IAAP,CAAb;AACD,GAFD,MAEO,IAAI,OAAOsB,MAAP,KAAkB,QAAtB,EAAgC;AACrC,WAAOD,IAAI,CAACC,MAAD,CAAX;AACD,GAFM,MAEA,IAAI,OAAOA,MAAP,KAAkB,WAAtB,EAAmC;AACxC,QAAMC,QAAQ,GAAGF,IAAI,CAACF,IAAD,CAArB;AACA,WAAOI,QAAQ,KAAK,KAAK,CAAlB,GAAsB,EAAtB,GAA2BA,QAAlC;AACD;AACF,CAZD;;AAaA,IAAIC,UAAU,GAAG,CAAjB;;IACMC,I;AACJ,gBAAYC,OAAZ,EAAqB;AAAA;;AACnB,SAAKC,EAAL,GAAUH,UAAU,EAApB;AACA,SAAKI,IAAL,GAAY,IAAZ;AACA,SAAKpB,OAAL,GAAe,KAAf;AACA,SAAKC,aAAL,GAAqB,KAArB;AACA,SAAKY,IAAL,GAAY,IAAZ;AACA,SAAKQ,QAAL,GAAgB,KAAhB;AACA,SAAKf,MAAL,GAAc,IAAd;AACA,SAAKgB,OAAL,GAAe,IAAf;AACA,SAAKC,SAAL,GAAiB,KAAjB;AACA,SAAKC,QAAL,GAAgB,KAAhB;;AACA,SAAK,IAAMC,IAAX,IAAmBP,OAAnB,EAA4B;AAC1B,UAAIQ,MAAM,CAACR,OAAD,EAAUO,IAAV,CAAV,EAA2B;AACzB,aAAKA,IAAL,IAAaP,OAAO,CAACO,IAAD,CAApB;AACD;AACF;;AACD,SAAKlB,KAAL,GAAa,CAAb;AACA,SAAKoB,MAAL,GAAc,KAAd;AACA,SAAKtB,UAAL,GAAkB,EAAlB;AACA,SAAKuB,OAAL,GAAe,KAAf;;AACA,QAAI,KAAKtB,MAAT,EAAiB;AACf,WAAKC,KAAL,GAAa,KAAKD,MAAL,CAAYC,KAAZ,GAAoB,CAAjC;AACD;AACF;;;;WACD,sBAAa;AACX,UAAMC,KAAK,GAAG,KAAKA,KAAnB;;AACA,UAAI,CAACA,KAAL,EAAY;AACV,cAAM,IAAIqB,KAAJ,CAAU,0BAAV,CAAN;AACD;;AACDrB,WAAK,CAACsB,YAAN,CAAmB,IAAnB;AACA,UAAMlB,KAAK,GAAGJ,KAAK,CAACI,KAApB;;AACA,UAAIA,KAAK,IAAI,OAAOA,KAAK,CAACmB,MAAb,KAAwB,WAArC,EAAkD;AAChD,YAAMA,MAAM,GAAGrB,mBAAmB,CAAC,IAAD,EAAO,QAAP,CAAlC;;AACA,YAAI,OAAOqB,MAAP,KAAkB,SAAtB,EAAiC;AAC/B,eAAKC,YAAL,GAAoBD,MAApB;AACD;AACF;;AACD,UAAIvB,KAAK,CAACyB,IAAN,KAAe,IAAf,IAAuB,KAAKpB,IAAhC,EAAsC;AACpC,aAAKqB,OAAL,CAAa,KAAKrB,IAAlB;;AACA,YAAIL,KAAK,CAAC2B,gBAAV,EAA4B;AAC1B,eAAKd,QAAL,GAAgB,IAAhB;AACA,eAAKG,QAAL,GAAgB,IAAhB;AACD;AACF,OAND,MAMO,IAAI,KAAKjB,KAAL,GAAa,CAAb,IAAkBC,KAAK,CAACyB,IAAxB,IAAgCzB,KAAK,CAAC2B,gBAA1C,EAA4D;AACjE,aAAKC,MAAL;AACD;;AACD,UAAI,CAACC,KAAK,CAACC,OAAN,CAAc,KAAKzB,IAAnB,CAAL,EAA+B;AAC7B0B,oBAAY,CAAC,IAAD,EAAO,KAAK1B,IAAZ,CAAZ;AACD;;AACD,UAAI,CAAC,KAAKA,IAAV,EACE;AACF,UAAM2B,mBAAmB,GAAGhC,KAAK,CAACgC,mBAAlC;AACA,UAAMC,GAAG,GAAGjC,KAAK,CAACiC,GAAlB;;AACA,UAAIA,GAAG,IAAID,mBAAP,IAA8BA,mBAAmB,CAACE,OAApB,CAA4B,KAAKD,GAAjC,MAA0C,CAAC,CAA7E,EAAgF;AAC9E,aAAKL,MAAL,CAAY,IAAZ,EAAkB5B,KAAK,CAACmC,gBAAxB;AACD;;AACD,UAAIF,GAAG,IAAIjC,KAAK,CAACoC,cAAN,KAAyB,KAAK,CAArC,IAA0C,KAAKH,GAAL,KAAajC,KAAK,CAACoC,cAAjE,EAAiF;AAC/EpC,aAAK,CAACqC,WAAN,GAAoB,IAApB;AACArC,aAAK,CAACqC,WAAN,CAAkBtB,SAAlB,GAA8B,IAA9B;AACD;;AACD,UAAIf,KAAK,CAACyB,IAAV,EAAgB;AACdzB,aAAK,CAACsC,uBAAN,CAA8B,IAA9B;AACD;;AACD,WAAKC,eAAL;AACA,UAAI,KAAKzC,MAAL,KAAgB,KAAKC,KAAL,KAAe,CAAf,IAAoB,KAAKD,MAAL,CAAYe,QAAZ,KAAyB,IAA7D,CAAJ,EACE,KAAKG,QAAL,GAAgB,IAAhB;AACH;;;WACD,iBAAQX,IAAR,EAAc;AACZ,UAAI,CAACwB,KAAK,CAACC,OAAN,CAAczB,IAAd,CAAL,EAA0B;AACxB0B,oBAAY,CAAC,IAAD,EAAO1B,IAAP,CAAZ;AACD;;AACD,WAAKA,IAAL,GAAYA,IAAZ;AACA,WAAKR,UAAL,GAAkB,EAAlB;AACA,UAAI2C,QAAJ;;AACA,UAAI,KAAKzC,KAAL,KAAe,CAAf,IAAoB,KAAKM,IAAL,YAAqBwB,KAA7C,EAAoD;AAClDW,gBAAQ,GAAG,KAAKnC,IAAhB;AACD,OAFD,MAEO;AACLmC,gBAAQ,GAAGtC,mBAAmB,CAAC,IAAD,EAAO,UAAP,CAAnB,IAAyC,EAApD;AACD;;AACD,WAAK,IAAId,CAAC,GAAG,CAAR,EAAWC,CAAC,GAAGmD,QAAQ,CAAClD,MAA7B,EAAqCF,CAAC,GAAGC,CAAzC,EAA4CD,CAAC,EAA7C,EAAiD;AAC/C,aAAKqD,WAAL,CAAiB;AAAEpC,cAAI,EAAEmC,QAAQ,CAACpD,CAAD;AAAhB,SAAjB;AACD;AACF;;;SACD,eAAY;AACV,aAAOc,mBAAmB,CAAC,IAAD,EAAO,OAAP,CAA1B;AACD;;;SACD,eAAU;AACR,UAAMwC,OAAO,GAAG,KAAK1C,KAAL,CAAWiC,GAA3B;AACA,UAAI,KAAK5B,IAAT,EACE,OAAO,KAAKA,IAAL,CAAUqC,OAAV,CAAP;AACF,aAAO,IAAP;AACD;;;SACD,eAAe;AACb,aAAOxC,mBAAmB,CAAC,IAAD,EAAO,UAAP,CAA1B;AACD;;;SACD,eAAkB;AAChB,UAAMJ,MAAM,GAAG,KAAKA,MAApB;;AACA,UAAIA,MAAJ,EAAY;AACV,YAAM6C,KAAK,GAAG7C,MAAM,CAACD,UAAP,CAAkBqC,OAAlB,CAA0B,IAA1B,CAAd;;AACA,YAAIS,KAAK,GAAG,CAAC,CAAb,EAAgB;AACd,iBAAO7C,MAAM,CAACD,UAAP,CAAkB8C,KAAK,GAAG,CAA1B,CAAP;AACD;AACF;;AACD,aAAO,IAAP;AACD;;;SACD,eAAsB;AACpB,UAAM7C,MAAM,GAAG,KAAKA,MAApB;;AACA,UAAIA,MAAJ,EAAY;AACV,YAAM6C,KAAK,GAAG7C,MAAM,CAACD,UAAP,CAAkBqC,OAAlB,CAA0B,IAA1B,CAAd;;AACA,YAAIS,KAAK,GAAG,CAAC,CAAb,EAAgB;AACd,iBAAOA,KAAK,GAAG,CAAR,GAAY7C,MAAM,CAACD,UAAP,CAAkB8C,KAAK,GAAG,CAA1B,CAAZ,GAA2C,IAAlD;AACD;AACF;;AACD,aAAO,IAAP;AACD;;;WACD,kBAASC,MAAT,EAA8B;AAAA,UAAbC,IAAa,uEAAN,IAAM;AAC5B,aAAO,CAAC,KAAKhD,UAAL,IAAmB,EAApB,EAAwBiD,IAAxB,CAA6B,UAACC,KAAD;AAAA,eAAWA,KAAK,KAAKH,MAAV,IAAoBC,IAAI,IAAIE,KAAK,CAACC,QAAN,CAAeJ,MAAf,CAAvC;AAAA,OAA7B,CAAP;AACD;;;WACD,kBAAS;AACP,UAAM9C,MAAM,GAAG,KAAKA,MAApB;;AACA,UAAIA,MAAJ,EAAY;AACVA,cAAM,CAACmD,WAAP,CAAmB,IAAnB;AACD;AACF;;;WACD,qBAAYF,KAAZ,EAAmBJ,KAAnB,EAA0BO,KAA1B,EAAiC;AAC/B,UAAI,CAACH,KAAL,EACE,MAAM,IAAI1B,KAAJ,CAAU,uCAAV,CAAN;;AACF,UAAI,EAAE0B,KAAK,YAAYtC,IAAnB,CAAJ,EAA8B;AAC5B,YAAI,CAACyC,KAAL,EAAY;AACV,cAAMV,QAAQ,GAAG,KAAKW,WAAL,CAAiB,IAAjB,CAAjB;;AACA,cAAIX,QAAQ,CAACN,OAAT,CAAiBa,KAAK,CAAC1C,IAAvB,MAAiC,CAAC,CAAtC,EAAyC;AACvC,gBAAI,OAAOsC,KAAP,KAAiB,WAAjB,IAAgCA,KAAK,GAAG,CAA5C,EAA+C;AAC7CH,sBAAQ,CAACY,IAAT,CAAcL,KAAK,CAAC1C,IAApB;AACD,aAFD,MAEO;AACLmC,sBAAQ,CAACa,MAAT,CAAgBV,KAAhB,EAAuB,CAAvB,EAA0BI,KAAK,CAAC1C,IAAhC;AACD;AACF;AACF;;AACDiD,cAAM,CAACC,MAAP,CAAcR,KAAd,EAAqB;AACnBjD,gBAAM,EAAE,IADW;AAEnBE,eAAK,EAAE,KAAKA;AAFO,SAArB;AAIA+C,aAAK,GAAGS,QAAQ,CAAC,IAAI/C,IAAJ,CAASsC,KAAT,CAAD,CAAhB;;AACA,YAAIA,KAAK,YAAYtC,IAArB,EAA2B;AACzBsC,eAAK,CAACU,UAAN;AACD;AACF;;AACD;AACAV,WAAK,CAAChD,KAAN,GAAc,KAAKA,KAAL,GAAa,CAA3B;;AACA,UAAI,OAAO4C,KAAP,KAAiB,WAAjB,IAAgCA,KAAK,GAAG,CAA5C,EAA+C;AAC7C,aAAK9C,UAAL,CAAgBuD,IAAhB,CAAqBL,KAArB;AACD,OAFD,MAEO;AACL,aAAKlD,UAAL,CAAgBwD,MAAhB,CAAuBV,KAAvB,EAA8B,CAA9B,EAAiCI,KAAjC;AACD;;AACD,WAAKR,eAAL;AACD;;;WACD,sBAAaQ,KAAb,EAAoBW,GAApB,EAAyB;AACvB,UAAIf,KAAJ;;AACA,UAAIe,GAAJ,EAAS;AACPf,aAAK,GAAG,KAAK9C,UAAL,CAAgBqC,OAAhB,CAAwBwB,GAAxB,CAAR;AACD;;AACD,WAAKjB,WAAL,CAAiBM,KAAjB,EAAwBJ,KAAxB;AACD;;;WACD,qBAAYI,KAAZ,EAAmBW,GAAnB,EAAwB;AACtB,UAAIf,KAAJ;;AACA,UAAIe,GAAJ,EAAS;AACPf,aAAK,GAAG,KAAK9C,UAAL,CAAgBqC,OAAhB,CAAwBwB,GAAxB,CAAR;AACA,YAAIf,KAAK,KAAK,CAAC,CAAf,EACEA,KAAK,IAAI,CAAT;AACH;;AACD,WAAKF,WAAL,CAAiBM,KAAjB,EAAwBJ,KAAxB;AACD;;;WACD,qBAAYI,KAAZ,EAAmB;AACjB,UAAMP,QAAQ,GAAG,KAAKW,WAAL,MAAsB,EAAvC;AACA,UAAMQ,SAAS,GAAGnB,QAAQ,CAACN,OAAT,CAAiBa,KAAK,CAAC1C,IAAvB,CAAlB;;AACA,UAAIsD,SAAS,GAAG,CAAC,CAAjB,EAAoB;AAClBnB,gBAAQ,CAACa,MAAT,CAAgBM,SAAhB,EAA2B,CAA3B;AACD;;AACD,UAAMhB,KAAK,GAAG,KAAK9C,UAAL,CAAgBqC,OAAhB,CAAwBa,KAAxB,CAAd;;AACA,UAAIJ,KAAK,GAAG,CAAC,CAAb,EAAgB;AACd,aAAK3C,KAAL,IAAc,KAAKA,KAAL,CAAW4D,cAAX,CAA0Bb,KAA1B,CAAd;AACAA,aAAK,CAACjD,MAAN,GAAe,IAAf;AACA,aAAKD,UAAL,CAAgBwD,MAAhB,CAAuBV,KAAvB,EAA8B,CAA9B;AACD;;AACD,WAAKJ,eAAL;AACD;;;WACD,2BAAkBlC,IAAlB,EAAwB;AACtB,UAAIwD,UAAU,GAAG,IAAjB;;AACA,WAAK,IAAIzE,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG,KAAKS,UAAL,CAAgBP,MAApC,EAA4CF,CAAC,EAA7C,EAAiD;AAC/C,YAAI,KAAKS,UAAL,CAAgBT,CAAhB,EAAmBiB,IAAnB,KAA4BA,IAAhC,EAAsC;AACpCwD,oBAAU,GAAG,KAAKhE,UAAL,CAAgBT,CAAhB,CAAb;AACA;AACD;AACF;;AACD,UAAIyE,UAAJ,EAAgB;AACd,aAAKZ,WAAL,CAAiBY,UAAjB;AACD;AACF;;;WACD,gBAAOC,QAAP,EAAiBC,YAAjB,EAA+B;AAAA;;AAC7B,UAAMC,IAAI,GAAG,SAAPA,IAAO,GAAM;AACjB,YAAID,YAAJ,EAAkB;AAChB,cAAIjE,MAAM,GAAG,KAAI,CAACA,MAAlB;;AACA,iBAAOA,MAAM,CAACC,KAAP,GAAe,CAAtB,EAAyB;AACvBD,kBAAM,CAACe,QAAP,GAAkB,IAAlB;AACAf,kBAAM,GAAGA,MAAM,CAACA,MAAhB;AACD;AACF;;AACD,aAAI,CAACe,QAAL,GAAgB,IAAhB;AACA,YAAIiD,QAAJ,EACEA,QAAQ;;AACV,aAAI,CAACjE,UAAL,CAAgBoE,OAAhB,CAAwB,UAACC,IAAD,EAAU;AAChCA,cAAI,CAAClD,QAAL,GAAgB,IAAhB;AACD,SAFD;AAGD,OAdD;;AAeA,UAAI,KAAKmD,cAAL,EAAJ,EAA2B;AACzB,aAAKC,QAAL,CAAc,UAAC/D,IAAD,EAAU;AACtB,cAAIwB,KAAK,CAACC,OAAN,CAAczB,IAAd,CAAJ,EAAyB;AACvB,gBAAI,KAAI,CAACb,OAAT,EAAkB;AAChB,mBAAI,CAAC6E,UAAL,CAAgB,IAAhB,EAAsB,IAAtB;AACD,aAFD,MAEO,IAAI,CAAC,KAAI,CAACrE,KAAL,CAAWC,aAAhB,EAA+B;AACpCL,2BAAa,CAAC,KAAD,CAAb;AACD;;AACDoE,gBAAI;AACL;AACF,SATD;AAUD,OAXD,MAWO;AACLA,YAAI;AACL;AACF;;;WACD,0BAAiBM,KAAjB,EAA2C;AAAA;;AAAA,UAAnBC,YAAmB,uEAAJ,EAAI;AACzCD,WAAK,CAACL,OAAN,CAAc,UAACC,IAAD,EAAU;AACtB,cAAI,CAACzB,WAAL,CAAiBa,MAAM,CAACC,MAAP,CAAc;AAAElD,cAAI,EAAE6D;AAAR,SAAd,EAA8BK,YAA9B,CAAjB,EAA8D,KAAK,CAAnE,EAAsE,IAAtE;AACD,OAFD;AAGD;;;WACD,oBAAW;AACT,WAAK1D,QAAL,GAAgB,KAAhB;AACA,WAAKhB,UAAL,CAAgBoE,OAAhB,CAAwB,UAACC,IAAD,EAAU;AAChCA,YAAI,CAAClD,QAAL,GAAgB,KAAhB;AACD,OAFD;AAGD;;;WACD,0BAAiB;AACf,aAAO,KAAKhB,KAAL,CAAWyB,IAAX,KAAoB,IAApB,IAA4B,KAAKzB,KAAL,CAAWwE,IAAvC,IAA+C,CAAC,KAAKrD,MAA5D;AACD;;;WACD,2BAAkB;AAChB,UAAI,KAAKnB,KAAL,CAAWyB,IAAX,KAAoB,IAApB,IAA4B,KAAKN,MAAL,KAAgB,IAA5C,IAAoD,OAAO,KAAKK,YAAZ,KAA6B,WAArF,EAAkG;AAChG,aAAKD,MAAL,GAAc,KAAKC,YAAnB;AACA;AACD;;AACD,UAAM3B,UAAU,GAAG,KAAKA,UAAxB;;AACA,UAAI,CAAC,KAAKG,KAAL,CAAWyB,IAAZ,IAAoB,KAAKzB,KAAL,CAAWyB,IAAX,KAAoB,IAApB,IAA4B,KAAKN,MAAL,KAAgB,IAApE,EAA0E;AACxE,aAAKI,MAAL,GAAc,CAAC1B,UAAD,IAAeA,UAAU,CAACP,MAAX,KAAsB,CAAnD;AACA;AACD;;AACD,WAAKiC,MAAL,GAAc,KAAd;AACD;;;WACD,oBAAWkD,KAAX,EAAkB5B,IAAlB,EAAwB6B,SAAxB,EAAmCC,SAAnC,EAA8C;AAAA;;AAC5C,WAAKlF,aAAL,GAAqBgF,KAAK,KAAK,MAA/B;AACA,WAAKjF,OAAL,GAAeiF,KAAK,KAAK,IAAzB;AACA,UAAI,KAAKzE,KAAL,CAAWC,aAAf,EACE;;AACF,UAAI,EAAE,KAAKkE,cAAL,MAAyB,CAAC,KAAKnE,KAAL,CAAW4E,gBAAvC,CAAJ,EAA8D;AAC5D,8BAAmC7F,aAAa,CAAC,KAAKc,UAAN,CAAhD;AAAA,YAAQZ,GAAR,mBAAQA,GAAR;AAAA,YAAaE,iBAAb,mBAAaA,iBAAb;;AACA,YAAI,CAAC,KAAKoC,MAAN,IAAgB,CAACtC,GAAjB,IAAwBE,iBAA5B,EAA+C;AAC7C,eAAKK,OAAL,GAAe,KAAf;AACAiF,eAAK,GAAG,KAAR;AACD;;AACD,YAAMI,iBAAiB,GAAG,SAApBA,iBAAoB,GAAM;AAC9B,cAAIhC,IAAJ,EAAU;AACR,gBAAMhD,UAAU,GAAG,MAAI,CAACA,UAAxB;;AACA,iBAAK,IAAIT,CAAC,GAAG,CAAR,EAAWC,CAAC,GAAGQ,UAAU,CAACP,MAA/B,EAAuCF,CAAC,GAAGC,CAA3C,EAA8CD,CAAC,EAA/C,EAAmD;AACjD,kBAAM2D,KAAK,GAAGlD,UAAU,CAACT,CAAD,CAAxB;AACAuF,uBAAS,GAAGA,SAAS,IAAIF,KAAK,KAAK,KAAnC;AACA,kBAAMK,OAAO,GAAG/B,KAAK,CAACrD,QAAN,GAAiBqD,KAAK,CAACvD,OAAvB,GAAiCmF,SAAjD;AACA5B,mBAAK,CAACsB,UAAN,CAAiBS,OAAjB,EAA0BjC,IAA1B,EAAgC,IAAhC,EAAsC8B,SAAtC;AACD;;AACD,kCAA4B5F,aAAa,CAACc,UAAD,CAAzC;AAAA,gBAAQF,IAAR,mBAAQA,IAAR;AAAA,gBAAmBoF,IAAnB,mBAAc9F,GAAd;;AACA,gBAAI,CAAC8F,IAAL,EAAW;AACT,oBAAI,CAACvF,OAAL,GAAeuF,IAAf;AACA,oBAAI,CAACtF,aAAL,GAAqBE,IAArB;AACD;AACF;AACF,SAfD;;AAgBA,YAAI,KAAKwE,cAAL,EAAJ,EAA2B;AACzB,eAAKC,QAAL,CAAc,YAAM;AAClBS,6BAAiB;AACjBjF,yBAAa,CAAC,MAAD,CAAb;AACD,WAHD,EAGG;AACDJ,mBAAO,EAAEiF,KAAK,KAAK;AADlB,WAHH;AAMA;AACD,SARD,MAQO;AACLI,2BAAiB;AAClB;AACF;;AACD,UAAM/E,MAAM,GAAG,KAAKA,MAApB;AACA,UAAI,CAACA,MAAD,IAAWA,MAAM,CAACC,KAAP,KAAiB,CAAhC,EACE;;AACF,UAAI,CAAC2E,SAAL,EAAgB;AACd9E,qBAAa,CAACE,MAAD,CAAb;AACD;AACF;;;WACD,uBAA+B;AAAA,UAAnBkF,SAAmB,uEAAP,KAAO;AAC7B,UAAI,KAAKjF,KAAL,KAAe,CAAnB,EACE,OAAO,KAAKM,IAAZ;AACF,UAAMA,IAAI,GAAG,KAAKA,IAAlB;AACA,UAAI,CAACA,IAAL,EACE,OAAO,IAAP;AACF,UAAMD,KAAK,GAAG,KAAKJ,KAAL,CAAWI,KAAzB;AACA,UAAIoC,QAAQ,GAAG,UAAf;;AACA,UAAIpC,KAAJ,EAAW;AACToC,gBAAQ,GAAGpC,KAAK,CAACoC,QAAN,IAAkB,UAA7B;AACD;;AACD,UAAInC,IAAI,CAACmC,QAAD,CAAJ,KAAmB,KAAK,CAA5B,EAA+B;AAC7BnC,YAAI,CAACmC,QAAD,CAAJ,GAAiB,IAAjB;AACD;;AACD,UAAIwC,SAAS,IAAI,CAAC3E,IAAI,CAACmC,QAAD,CAAtB,EAAkC;AAChCnC,YAAI,CAACmC,QAAD,CAAJ,GAAiB,EAAjB;AACD;;AACD,aAAOnC,IAAI,CAACmC,QAAD,CAAX;AACD;;;WACD,0BAAiB;AAAA;;AACf,UAAMyC,OAAO,GAAG,KAAK9B,WAAL,MAAsB,EAAtC;AACA,UAAM+B,OAAO,GAAG,KAAKrF,UAAL,CAAgBsF,GAAhB,CAAoB,UAACnG,IAAD;AAAA,eAAUA,IAAI,CAACqB,IAAf;AAAA,OAApB,CAAhB;AACA,UAAM+E,UAAU,GAAG,EAAnB;AACA,UAAMC,QAAQ,GAAG,EAAjB;AACAJ,aAAO,CAAChB,OAAR,CAAgB,UAACC,IAAD,EAAOvB,KAAP,EAAiB;AAC/B,YAAMV,GAAG,GAAGiC,IAAI,CAACoB,QAAD,CAAhB;AACA,YAAMC,YAAY,GAAG,CAAC,CAACtD,GAAF,IAASiD,OAAO,CAACM,SAAR,CAAkB,UAACnF,IAAD;AAAA,iBAAUA,IAAI,CAACiF,QAAD,CAAJ,KAAmBrD,GAA7B;AAAA,SAAlB,KAAuD,CAArF;;AACA,YAAIsD,YAAJ,EAAkB;AAChBH,oBAAU,CAACnD,GAAD,CAAV,GAAkB;AAAEU,iBAAK,EAALA,KAAF;AAAStC,gBAAI,EAAE6D;AAAf,WAAlB;AACD,SAFD,MAEO;AACLmB,kBAAQ,CAACjC,IAAT,CAAc;AAAET,iBAAK,EAALA,KAAF;AAAStC,gBAAI,EAAE6D;AAAf,WAAd;AACD;AACF,OARD;;AASA,UAAI,CAAC,KAAKlE,KAAL,CAAWyB,IAAhB,EAAsB;AACpByD,eAAO,CAACjB,OAAR,CAAgB,UAACC,IAAD,EAAU;AACxB,cAAI,CAACkB,UAAU,CAAClB,IAAI,CAACoB,QAAD,CAAL,CAAf,EACE,MAAI,CAACG,iBAAL,CAAuBvB,IAAvB;AACH,SAHD;AAID;;AACDmB,cAAQ,CAACpB,OAAT,CAAiB,gBAAqB;AAAA,YAAlBtB,KAAkB,QAAlBA,KAAkB;AAAA,YAAXtC,IAAW,QAAXA,IAAW;;AACpC,cAAI,CAACoC,WAAL,CAAiB;AAAEpC,cAAI,EAAJA;AAAF,SAAjB,EAA2BsC,KAA3B;AACD,OAFD;AAGA,WAAKJ,eAAL;AACD;;;WACD,kBAASuB,QAAT,EAAsC;AAAA;;AAAA,UAAnBS,YAAmB,uEAAJ,EAAI;;AACpC,UAAI,KAAKvE,KAAL,CAAWyB,IAAX,KAAoB,IAApB,IAA4B,KAAKzB,KAAL,CAAWwE,IAAvC,IAA+C,CAAC,KAAKrD,MAArD,KAAgE,CAAC,KAAKC,OAAN,IAAiBkC,MAAM,CAACoC,IAAP,CAAYnB,YAAZ,EAA0BjF,MAA3G,CAAJ,EAAwH;AACtH,aAAK8B,OAAL,GAAe,IAAf;;AACA,YAAMuE,OAAO,GAAG,SAAVA,OAAU,CAACnD,QAAD,EAAc;AAC5B,gBAAI,CAACrB,MAAL,GAAc,IAAd;AACA,gBAAI,CAACC,OAAL,GAAe,KAAf;AACA,gBAAI,CAACvB,UAAL,GAAkB,EAAlB;;AACA,gBAAI,CAAC+F,gBAAL,CAAsBpD,QAAtB,EAAgC+B,YAAhC;;AACA,gBAAI,CAAChC,eAAL;;AACA,cAAIuB,QAAJ,EAAc;AACZA,oBAAQ,CAAC+B,IAAT,CAAc,MAAd,EAAoBrD,QAApB;AACD;AACF,SATD;;AAUA,aAAKxC,KAAL,CAAWwE,IAAX,CAAgB,IAAhB,EAAsBmB,OAAtB;AACD,OAbD,MAaO;AACL,YAAI7B,QAAJ,EAAc;AACZA,kBAAQ,CAAC+B,IAAT,CAAc,IAAd;AACD;AACF;AACF","names":["getChildState","node","all","none","allWithoutDisable","i","j","length","n","checked","indeterminate","disabled","half","reInitChecked","childNodes","parent","level","store","checkStrictly","getPropertyFromData","prop","props","data","config","dataProp","nodeIdSeed","Node","options","id","text","expanded","visible","isCurrent","canFocus","name","hasOwn","loaded","loading","Error","registerNode","isLeaf","isLeafByUser","lazy","setData","defaultExpandAll","expand","Array","isArray","markNodeData","defaultExpandedKeys","key","indexOf","autoExpandParent","currentNodeKey","currentNode","_initDefaultCheckedNode","updateLeafState","children","insertChild","nodeKey","index","target","deep","some","child","contains","removeChild","batch","getChildren","push","splice","Object","assign","reactive","initialize","ref","dataIndex","deregisterNode","targetNode","callback","expandParent","done","forEach","item","shouldLoadData","loadData","setChecked","array","defaultProps","load","value","recursion","passValue","checkDescendants","handleDescendants","isCheck","all2","forceInit","newData","oldData","map","newDataMap","newNodes","NODE_KEY","isNodeExists","findIndex","removeChildByData","keys","resolve","doCreateChildren","call"],"sources":["../../../../../../../packages/components/tree/src/model/node.ts"],"sourcesContent":["import { reactive } from 'vue'\nimport { hasOwn } from '@element-plus/utils'\nimport { markNodeData, NODE_KEY } from './util'\nimport type TreeStore from './tree-store'\n\nimport type { Nullable } from '@element-plus/utils'\nimport type {\n  TreeNodeOptions,\n  TreeNodeData,\n  TreeKey,\n  FakeNode,\n  TreeNodeLoadedDefaultProps,\n  TreeNodeChildState,\n} from '../tree.type'\n\nexport const getChildState = (node: Node[]): TreeNodeChildState => {\n  let all = true\n  let none = true\n  let allWithoutDisable = true\n  for (let i = 0, j = node.length; i < j; i++) {\n    const n = node[i]\n    if (n.checked !== true || n.indeterminate) {\n      all = false\n      if (!n.disabled) {\n        allWithoutDisable = false\n      }\n    }\n    if (n.checked !== false || n.indeterminate) {\n      none = false\n    }\n  }\n\n  return { all, none, allWithoutDisable, half: !all && !none }\n}\n\nconst reInitChecked = function (node: Node): void {\n  if (node.childNodes.length === 0) return\n\n  const { all, none, half } = getChildState(node.childNodes)\n  if (all) {\n    node.checked = true\n    node.indeterminate = false\n  } else if (half) {\n    node.checked = false\n    node.indeterminate = true\n  } else if (none) {\n    node.checked = false\n    node.indeterminate = false\n  }\n\n  const parent = node.parent\n  if (!parent || parent.level === 0) return\n\n  if (!node.store.checkStrictly) {\n    reInitChecked(parent)\n  }\n}\n\nconst getPropertyFromData = function (node: Node, prop: string): any {\n  const props = node.store.props\n  const data = node.data || {}\n  const config = props[prop]\n\n  if (typeof config === 'function') {\n    return config(data, node)\n  } else if (typeof config === 'string') {\n    return data[config]\n  } else if (typeof config === 'undefined') {\n    const dataProp = data[prop]\n    return dataProp === undefined ? '' : dataProp\n  }\n}\n\nlet nodeIdSeed = 0\n\nclass Node {\n  id: number\n  text: string\n  checked: boolean\n  indeterminate: boolean\n  data: TreeNodeData\n  expanded: boolean\n  parent: Node\n  visible: boolean\n  isCurrent: boolean\n  store: TreeStore\n  isLeafByUser: boolean\n  isLeaf: boolean\n  canFocus: boolean\n\n  level: number\n  loaded: boolean\n  childNodes: Node[]\n  loading: boolean\n\n  constructor(options: TreeNodeOptions) {\n    this.id = nodeIdSeed++\n    this.text = null\n    this.checked = false\n    this.indeterminate = false\n    this.data = null\n    this.expanded = false\n    this.parent = null\n    this.visible = true\n    this.isCurrent = false\n    this.canFocus = false\n\n    for (const name in options) {\n      if (hasOwn(options, name)) {\n        this[name] = options[name]\n      }\n    }\n\n    // internal\n    this.level = 0\n    this.loaded = false\n    this.childNodes = []\n    this.loading = false\n\n    if (this.parent) {\n      this.level = this.parent.level + 1\n    }\n  }\n\n  initialize() {\n    const store = this.store\n    if (!store) {\n      throw new Error('[Node]store is required!')\n    }\n    store.registerNode(this)\n\n    const props = store.props\n    if (props && typeof props.isLeaf !== 'undefined') {\n      const isLeaf = getPropertyFromData(this, 'isLeaf')\n      if (typeof isLeaf === 'boolean') {\n        this.isLeafByUser = isLeaf\n      }\n    }\n\n    if (store.lazy !== true && this.data) {\n      this.setData(this.data)\n\n      if (store.defaultExpandAll) {\n        this.expanded = true\n        this.canFocus = true\n      }\n    } else if (this.level > 0 && store.lazy && store.defaultExpandAll) {\n      this.expand()\n    }\n    if (!Array.isArray(this.data)) {\n      markNodeData(this, this.data)\n    }\n    if (!this.data) return\n\n    const defaultExpandedKeys = store.defaultExpandedKeys\n    const key = store.key\n\n    if (\n      key &&\n      defaultExpandedKeys &&\n      defaultExpandedKeys.indexOf(this.key) !== -1\n    ) {\n      this.expand(null, store.autoExpandParent)\n    }\n\n    if (\n      key &&\n      store.currentNodeKey !== undefined &&\n      this.key === store.currentNodeKey\n    ) {\n      store.currentNode = this\n      store.currentNode.isCurrent = true\n    }\n\n    if (store.lazy) {\n      store._initDefaultCheckedNode(this)\n    }\n\n    this.updateLeafState()\n    if (this.parent && (this.level === 1 || this.parent.expanded === true))\n      this.canFocus = true\n  }\n\n  setData(data: TreeNodeData): void {\n    if (!Array.isArray(data)) {\n      markNodeData(this, data)\n    }\n\n    this.data = data\n    this.childNodes = []\n\n    let children\n    if (this.level === 0 && this.data instanceof Array) {\n      children = this.data\n    } else {\n      children = getPropertyFromData(this, 'children') || []\n    }\n\n    for (let i = 0, j = children.length; i < j; i++) {\n      this.insertChild({ data: children[i] })\n    }\n  }\n\n  get label(): string {\n    return getPropertyFromData(this, 'label')\n  }\n\n  get key(): TreeKey {\n    const nodeKey = this.store.key\n    if (this.data) return this.data[nodeKey]\n    return null\n  }\n\n  get disabled(): boolean {\n    return getPropertyFromData(this, 'disabled')\n  }\n\n  get nextSibling(): Nullable<Node> {\n    const parent = this.parent\n    if (parent) {\n      const index = parent.childNodes.indexOf(this)\n      if (index > -1) {\n        return parent.childNodes[index + 1]\n      }\n    }\n    return null\n  }\n\n  get previousSibling(): Nullable<Node> {\n    const parent = this.parent\n    if (parent) {\n      const index = parent.childNodes.indexOf(this)\n      if (index > -1) {\n        return index > 0 ? parent.childNodes[index - 1] : null\n      }\n    }\n    return null\n  }\n\n  contains(target: Node, deep = true): boolean {\n    return (this.childNodes || []).some(\n      (child) => child === target || (deep && child.contains(target))\n    )\n  }\n\n  remove(): void {\n    const parent = this.parent\n    if (parent) {\n      parent.removeChild(this)\n    }\n  }\n\n  insertChild(child?: FakeNode | Node, index?: number, batch?: boolean): void {\n    if (!child) throw new Error('InsertChild error: child is required.')\n\n    if (!(child instanceof Node)) {\n      if (!batch) {\n        const children = this.getChildren(true)\n        if (children.indexOf(child.data) === -1) {\n          if (typeof index === 'undefined' || index < 0) {\n            children.push(child.data)\n          } else {\n            children.splice(index, 0, child.data)\n          }\n        }\n      }\n      Object.assign(child, {\n        parent: this,\n        store: this.store,\n      })\n      child = reactive(new Node(child as TreeNodeOptions))\n      if (child instanceof Node) {\n        child.initialize()\n      }\n    }\n\n    ;(child as Node).level = this.level + 1\n\n    if (typeof index === 'undefined' || index < 0) {\n      this.childNodes.push(child as Node)\n    } else {\n      this.childNodes.splice(index, 0, child as Node)\n    }\n\n    this.updateLeafState()\n  }\n\n  insertBefore(child: FakeNode | Node, ref: Node): void {\n    let index\n    if (ref) {\n      index = this.childNodes.indexOf(ref)\n    }\n    this.insertChild(child, index)\n  }\n\n  insertAfter(child: FakeNode | Node, ref: Node): void {\n    let index\n    if (ref) {\n      index = this.childNodes.indexOf(ref)\n      if (index !== -1) index += 1\n    }\n    this.insertChild(child, index)\n  }\n\n  removeChild(child: Node): void {\n    const children = this.getChildren() || []\n    const dataIndex = children.indexOf(child.data)\n    if (dataIndex > -1) {\n      children.splice(dataIndex, 1)\n    }\n\n    const index = this.childNodes.indexOf(child)\n\n    if (index > -1) {\n      this.store && this.store.deregisterNode(child)\n      child.parent = null\n      this.childNodes.splice(index, 1)\n    }\n\n    this.updateLeafState()\n  }\n\n  removeChildByData(data: TreeNodeData): void {\n    let targetNode: Node = null\n\n    for (let i = 0; i < this.childNodes.length; i++) {\n      if (this.childNodes[i].data === data) {\n        targetNode = this.childNodes[i]\n        break\n      }\n    }\n\n    if (targetNode) {\n      this.removeChild(targetNode)\n    }\n  }\n\n  expand(callback?: () => void, expandParent?: boolean): void {\n    const done = (): void => {\n      if (expandParent) {\n        let parent = this.parent\n        while (parent.level > 0) {\n          parent.expanded = true\n          parent = parent.parent\n        }\n      }\n      this.expanded = true\n      if (callback) callback()\n      this.childNodes.forEach((item) => {\n        item.canFocus = true\n      })\n    }\n\n    if (this.shouldLoadData()) {\n      this.loadData((data) => {\n        if (Array.isArray(data)) {\n          if (this.checked) {\n            this.setChecked(true, true)\n          } else if (!this.store.checkStrictly) {\n            reInitChecked(this)\n          }\n          done()\n        }\n      })\n    } else {\n      done()\n    }\n  }\n\n  doCreateChildren(\n    array: TreeNodeData[],\n    defaultProps: TreeNodeLoadedDefaultProps = {}\n  ): void {\n    array.forEach((item) => {\n      this.insertChild(\n        Object.assign({ data: item }, defaultProps),\n        undefined,\n        true\n      )\n    })\n  }\n\n  collapse(): void {\n    this.expanded = false\n    this.childNodes.forEach((item) => {\n      item.canFocus = false\n    })\n  }\n\n  shouldLoadData(): boolean {\n    return this.store.lazy === true && this.store.load && !this.loaded\n  }\n\n  updateLeafState(): void {\n    if (\n      this.store.lazy === true &&\n      this.loaded !== true &&\n      typeof this.isLeafByUser !== 'undefined'\n    ) {\n      this.isLeaf = this.isLeafByUser\n      return\n    }\n    const childNodes = this.childNodes\n    if (\n      !this.store.lazy ||\n      (this.store.lazy === true && this.loaded === true)\n    ) {\n      this.isLeaf = !childNodes || childNodes.length === 0\n      return\n    }\n    this.isLeaf = false\n  }\n\n  setChecked(\n    value?: boolean | string,\n    deep?: boolean,\n    recursion?: boolean,\n    passValue?: boolean\n  ) {\n    this.indeterminate = value === 'half'\n    this.checked = value === true\n\n    if (this.store.checkStrictly) return\n\n    if (!(this.shouldLoadData() && !this.store.checkDescendants)) {\n      const { all, allWithoutDisable } = getChildState(this.childNodes)\n\n      if (!this.isLeaf && !all && allWithoutDisable) {\n        this.checked = false\n        value = false\n      }\n\n      const handleDescendants = (): void => {\n        if (deep) {\n          const childNodes = this.childNodes\n          for (let i = 0, j = childNodes.length; i < j; i++) {\n            const child = childNodes[i]\n            passValue = passValue || value !== false\n            const isCheck = child.disabled ? child.checked : passValue\n            child.setChecked(isCheck, deep, true, passValue)\n          }\n          const { half, all } = getChildState(childNodes)\n          if (!all) {\n            this.checked = all\n            this.indeterminate = half\n          }\n        }\n      }\n\n      if (this.shouldLoadData()) {\n        // Only work on lazy load data.\n        this.loadData(\n          () => {\n            handleDescendants()\n            reInitChecked(this)\n          },\n          {\n            checked: value !== false,\n          }\n        )\n        return\n      } else {\n        handleDescendants()\n      }\n    }\n\n    const parent = this.parent\n    if (!parent || parent.level === 0) return\n\n    if (!recursion) {\n      reInitChecked(parent)\n    }\n  }\n\n  getChildren(forceInit = false): TreeNodeData | TreeNodeData[] {\n    // this is data\n    if (this.level === 0) return this.data\n    const data = this.data\n    if (!data) return null\n\n    const props = this.store.props\n    let children = 'children'\n    if (props) {\n      children = props.children || 'children'\n    }\n\n    if (data[children] === undefined) {\n      data[children] = null\n    }\n\n    if (forceInit && !data[children]) {\n      data[children] = []\n    }\n\n    return data[children]\n  }\n\n  updateChildren(): void {\n    const newData = (this.getChildren() || []) as TreeNodeData[]\n    const oldData = this.childNodes.map((node) => node.data)\n\n    const newDataMap = {}\n    const newNodes = []\n\n    newData.forEach((item, index) => {\n      const key = item[NODE_KEY]\n      const isNodeExists =\n        !!key && oldData.findIndex((data) => data[NODE_KEY] === key) >= 0\n      if (isNodeExists) {\n        newDataMap[key] = { index, data: item }\n      } else {\n        newNodes.push({ index, data: item })\n      }\n    })\n\n    if (!this.store.lazy) {\n      oldData.forEach((item) => {\n        if (!newDataMap[item[NODE_KEY]]) this.removeChildByData(item)\n      })\n    }\n\n    newNodes.forEach(({ index, data }) => {\n      this.insertChild({ data }, index)\n    })\n\n    this.updateLeafState()\n  }\n\n  loadData(\n    callback: (node: Node) => void,\n    defaultProps: TreeNodeLoadedDefaultProps = {}\n  ) {\n    if (\n      this.store.lazy === true &&\n      this.store.load &&\n      !this.loaded &&\n      (!this.loading || Object.keys(defaultProps).length)\n    ) {\n      this.loading = true\n\n      const resolve = (children) => {\n        this.loaded = true\n        this.loading = false\n        this.childNodes = []\n\n        this.doCreateChildren(children, defaultProps)\n\n        this.updateLeafState()\n        if (callback) {\n          callback.call(this, children)\n        }\n      }\n\n      this.store.load(this, resolve)\n    } else {\n      if (callback) {\n        callback.call(this)\n      }\n    }\n  }\n}\n\nexport default Node\n"]},"metadata":{},"sourceType":"module"}