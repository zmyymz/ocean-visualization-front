{"ast":null,"code":"// algorithm: http://fox-toolkit.org/ftp/fasthalffloatconversion.pdf\nimport { NativeArrayBuffer, NativeFloat32Array, NativeUint32Array } from \"./primordials.mjs\";\nconst buffer = new NativeArrayBuffer(4);\nconst floatView = new NativeFloat32Array(buffer);\nconst uint32View = new NativeUint32Array(buffer);\nconst baseTable = new NativeUint32Array(512);\nconst shiftTable = new NativeUint32Array(512);\n\nfor (let i = 0; i < 256; ++i) {\n  const e = i - 127; // very small number (0, -0)\n\n  if (e < -27) {\n    baseTable[i] = 0x0000;\n    baseTable[i | 0x100] = 0x8000;\n    shiftTable[i] = 24;\n    shiftTable[i | 0x100] = 24; // small number (denorm)\n  } else if (e < -14) {\n    baseTable[i] = 0x0400 >> -e - 14;\n    baseTable[i | 0x100] = 0x0400 >> -e - 14 | 0x8000;\n    shiftTable[i] = -e - 1;\n    shiftTable[i | 0x100] = -e - 1; // normal number\n  } else if (e <= 15) {\n    baseTable[i] = e + 15 << 10;\n    baseTable[i | 0x100] = e + 15 << 10 | 0x8000;\n    shiftTable[i] = 13;\n    shiftTable[i | 0x100] = 13; // large number (Infinity, -Infinity)\n  } else if (e < 128) {\n    baseTable[i] = 0x7c00;\n    baseTable[i | 0x100] = 0xfc00;\n    shiftTable[i] = 24;\n    shiftTable[i | 0x100] = 24; // stay (NaN, Infinity, -Infinity)\n  } else {\n    baseTable[i] = 0x7c00;\n    baseTable[i | 0x100] = 0xfc00;\n    shiftTable[i] = 13;\n    shiftTable[i | 0x100] = 13;\n  }\n}\n/**\n * round a number to a half float number bits\n *\n * @param {unknown} num - double float\n * @returns {number} half float number bits\n */\n\n\nexport function roundToFloat16Bits(num) {\n  floatView[0] =\n  /** @type {any} */\n  num;\n  const f = uint32View[0];\n  const e = f >> 23 & 0x1ff;\n  return baseTable[e] + ((f & 0x007fffff) >> shiftTable[e]);\n}\nconst mantissaTable = new NativeUint32Array(2048);\nconst exponentTable = new NativeUint32Array(64);\nconst offsetTable = new NativeUint32Array(64);\n\nfor (let i = 1; i < 1024; ++i) {\n  let m = i << 13; // zero pad mantissa bits\n\n  let e = 0; // zero exponent\n  // normalized\n\n  while ((m & 0x00800000) === 0) {\n    m <<= 1;\n    e -= 0x00800000; // decrement exponent\n  }\n\n  m &= ~0x00800000; // clear leading 1 bit\n\n  e += 0x38800000; // adjust bias\n\n  mantissaTable[i] = m | e;\n}\n\nfor (let i = 1024; i < 2048; ++i) {\n  mantissaTable[i] = 0x38000000 + (i - 1024 << 13);\n}\n\nfor (let i = 1; i < 31; ++i) {\n  exponentTable[i] = i << 23;\n}\n\nexponentTable[31] = 0x47800000;\nexponentTable[32] = 0x80000000;\n\nfor (let i = 33; i < 63; ++i) {\n  exponentTable[i] = 0x80000000 + (i - 32 << 23);\n}\n\nexponentTable[63] = 0xc7800000;\n\nfor (let i = 1; i < 64; ++i) {\n  if (i !== 32) {\n    offsetTable[i] = 1024;\n  }\n}\n/**\n * convert a half float number bits to a number\n *\n * @param {number} float16bits - half float number bits\n * @returns {number} double float\n */\n\n\nexport function convertToNumber(float16bits) {\n  const m = float16bits >> 10;\n  uint32View[0] = mantissaTable[offsetTable[m] + (float16bits & 0x3ff)] + exponentTable[m];\n  return floatView[0];\n}","map":{"version":3,"sources":["D:/Java/JavaEE/IdeaProjects/ocean-vis/node_modules/@petamoriken/float16/src/_util/converter.mjs"],"names":["NativeArrayBuffer","NativeFloat32Array","NativeUint32Array","buffer","floatView","uint32View","baseTable","shiftTable","i","e","roundToFloat16Bits","num","f","mantissaTable","exponentTable","offsetTable","m","convertToNumber","float16bits"],"mappings":"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","sourcesContent":["// algorithm: http://fox-toolkit.org/ftp/fasthalffloatconversion.pdf\n\nimport {\n  NativeArrayBuffer,\n  NativeFloat32Array,\n  NativeUint32Array,\n} from \"./primordials.mjs\";\n\nconst buffer = new NativeArrayBuffer(4);\nconst floatView = new NativeFloat32Array(buffer);\nconst uint32View = new NativeUint32Array(buffer);\n\nconst baseTable = new NativeUint32Array(512);\nconst shiftTable = new NativeUint32Array(512);\n\nfor (let i = 0; i < 256; ++i) {\n  const e = i - 127;\n\n  // very small number (0, -0)\n  if (e < -27) {\n    baseTable[i]         = 0x0000;\n    baseTable[i | 0x100] = 0x8000;\n    shiftTable[i]         = 24;\n    shiftTable[i | 0x100] = 24;\n\n  // small number (denorm)\n  } else if (e < -14) {\n    baseTable[i]         =  0x0400 >> (-e - 14);\n    baseTable[i | 0x100] = (0x0400 >> (-e - 14)) | 0x8000;\n    shiftTable[i]         = -e - 1;\n    shiftTable[i | 0x100] = -e - 1;\n\n  // normal number\n  } else if (e <= 15) {\n    baseTable[i]         =  (e + 15) << 10;\n    baseTable[i | 0x100] = ((e + 15) << 10) | 0x8000;\n    shiftTable[i]         = 13;\n    shiftTable[i | 0x100] = 13;\n\n  // large number (Infinity, -Infinity)\n  } else if (e < 128) {\n    baseTable[i]         = 0x7c00;\n    baseTable[i | 0x100] = 0xfc00;\n    shiftTable[i]         = 24;\n    shiftTable[i | 0x100] = 24;\n\n  // stay (NaN, Infinity, -Infinity)\n  } else {\n    baseTable[i]         = 0x7c00;\n    baseTable[i | 0x100] = 0xfc00;\n    shiftTable[i]         = 13;\n    shiftTable[i | 0x100] = 13;\n  }\n}\n\n/**\n * round a number to a half float number bits\n *\n * @param {unknown} num - double float\n * @returns {number} half float number bits\n */\nexport function roundToFloat16Bits(num) {\n  floatView[0] = /** @type {any} */ (num);\n  const f = uint32View[0];\n  const e = (f >> 23) & 0x1ff;\n  return baseTable[e] + ((f & 0x007fffff) >> shiftTable[e]);\n}\n\nconst mantissaTable = new NativeUint32Array(2048);\nconst exponentTable = new NativeUint32Array(64);\nconst offsetTable = new NativeUint32Array(64);\n\nfor (let i = 1; i < 1024; ++i) {\n  let m = i << 13;    // zero pad mantissa bits\n  let e = 0;          // zero exponent\n\n  // normalized\n  while((m & 0x00800000) === 0) {\n    m <<= 1;\n    e -= 0x00800000;  // decrement exponent\n  }\n\n  m &= ~0x00800000;   // clear leading 1 bit\n  e += 0x38800000;    // adjust bias\n\n  mantissaTable[i] = m | e;\n}\nfor (let i = 1024; i < 2048; ++i) {\n  mantissaTable[i] = 0x38000000 + ((i - 1024) << 13);\n}\n\nfor (let i = 1; i < 31; ++i) {\n  exponentTable[i] = i << 23;\n}\nexponentTable[31] = 0x47800000;\nexponentTable[32] = 0x80000000;\nfor (let i = 33; i < 63; ++i) {\n  exponentTable[i] = 0x80000000 + ((i - 32) << 23);\n}\nexponentTable[63] = 0xc7800000;\n\nfor (let i = 1; i < 64; ++i) {\n  if (i !== 32) {\n    offsetTable[i] = 1024;\n  }\n}\n\n/**\n * convert a half float number bits to a number\n *\n * @param {number} float16bits - half float number bits\n * @returns {number} double float\n */\nexport function convertToNumber(float16bits) {\n  const m = float16bits >> 10;\n  uint32View[0] = mantissaTable[offsetTable[m] + (float16bits & 0x3ff)] + exponentTable[m];\n  return floatView[0];\n}\n"]},"metadata":{},"sourceType":"module"}