{"ast":null,"code":"import \"core-js/modules/es.array.filter.js\";\nimport \"core-js/modules/es.object.to-string.js\";\nimport \"core-js/modules/es.regexp.to-string.js\";\nimport \"core-js/modules/es.array.includes.js\";\nimport \"core-js/modules/es.string.includes.js\";\nimport \"core-js/modules/es.regexp.exec.js\";\nimport \"core-js/modules/es.string.replace.js\";\nimport \"core-js/modules/es.array.concat.js\";\nimport \"core-js/modules/es.array.map.js\";\nimport \"core-js/modules/web.dom-collections.for-each.js\";\nimport { getCurrentInstance, computed, watch } from 'vue';\nvar CHECKED_CHANGE_EVENT = \"checked-change\";\nvar useCheckProps = {\n  data: {\n    type: Array,\n    default: function _default() {\n      return [];\n    }\n  },\n  optionRender: Function,\n  placeholder: String,\n  title: String,\n  filterable: Boolean,\n  format: Object,\n  filterMethod: Function,\n  defaultChecked: Array,\n  props: Object\n};\n\nvar useCheck = function useCheck(props, panelState) {\n  var _getCurrentInstance = getCurrentInstance(),\n      emit = _getCurrentInstance.emit;\n\n  var labelProp = computed(function () {\n    return props.props.label || \"label\";\n  });\n  var keyProp = computed(function () {\n    return props.props.key || \"key\";\n  });\n  var disabledProp = computed(function () {\n    return props.props.disabled || \"disabled\";\n  });\n  var filteredData = computed(function () {\n    return props.data.filter(function (item) {\n      if (typeof props.filterMethod === \"function\") {\n        return props.filterMethod(panelState.query, item);\n      } else {\n        var label = item[labelProp.value] || item[keyProp.value].toString();\n        return label.toLowerCase().includes(panelState.query.toLowerCase());\n      }\n    });\n  });\n  var checkableData = computed(function () {\n    return filteredData.value.filter(function (item) {\n      return !item[disabledProp.value];\n    });\n  });\n  var checkedSummary = computed(function () {\n    var checkedLength = panelState.checked.length;\n    var dataLength = props.data.length;\n    var _props$format = props.format,\n        noChecked = _props$format.noChecked,\n        hasChecked = _props$format.hasChecked;\n\n    if (noChecked && hasChecked) {\n      return checkedLength > 0 ? hasChecked.replace(/\\${checked}/g, checkedLength.toString()).replace(/\\${total}/g, dataLength.toString()) : noChecked.replace(/\\${total}/g, dataLength.toString());\n    } else {\n      return \"\".concat(checkedLength, \"/\").concat(dataLength);\n    }\n  });\n  var isIndeterminate = computed(function () {\n    var checkedLength = panelState.checked.length;\n    return checkedLength > 0 && checkedLength < checkableData.value.length;\n  });\n\n  var updateAllChecked = function updateAllChecked() {\n    var checkableDataKeys = checkableData.value.map(function (item) {\n      return item[keyProp.value];\n    });\n    panelState.allChecked = checkableDataKeys.length > 0 && checkableDataKeys.every(function (item) {\n      return panelState.checked.includes(item);\n    });\n  };\n\n  var handleAllCheckedChange = function handleAllCheckedChange(value) {\n    panelState.checked = value ? checkableData.value.map(function (item) {\n      return item[keyProp.value];\n    }) : [];\n  };\n\n  watch(function () {\n    return panelState.checked;\n  }, function (val, oldVal) {\n    updateAllChecked();\n\n    if (panelState.checkChangeByUser) {\n      var movedKeys = val.concat(oldVal).filter(function (v) {\n        return !val.includes(v) || !oldVal.includes(v);\n      });\n      emit(CHECKED_CHANGE_EVENT, val, movedKeys);\n    } else {\n      emit(CHECKED_CHANGE_EVENT, val);\n      panelState.checkChangeByUser = true;\n    }\n  });\n  watch(checkableData, function () {\n    updateAllChecked();\n  });\n  watch(function () {\n    return props.data;\n  }, function () {\n    var checked = [];\n    var filteredDataKeys = filteredData.value.map(function (item) {\n      return item[keyProp.value];\n    });\n    panelState.checked.forEach(function (item) {\n      if (filteredDataKeys.includes(item)) {\n        checked.push(item);\n      }\n    });\n    panelState.checkChangeByUser = false;\n    panelState.checked = checked;\n  });\n  watch(function () {\n    return props.defaultChecked;\n  }, function (val, oldVal) {\n    if (oldVal && val.length === oldVal.length && val.every(function (item) {\n      return oldVal.includes(item);\n    })) return;\n    var checked = [];\n    var checkableDataKeys = checkableData.value.map(function (item) {\n      return item[keyProp.value];\n    });\n    val.forEach(function (item) {\n      if (checkableDataKeys.includes(item)) {\n        checked.push(item);\n      }\n    });\n    panelState.checkChangeByUser = false;\n    panelState.checked = checked;\n  }, {\n    immediate: true\n  });\n  return {\n    labelProp: labelProp,\n    keyProp: keyProp,\n    disabledProp: disabledProp,\n    filteredData: filteredData,\n    checkableData: checkableData,\n    checkedSummary: checkedSummary,\n    isIndeterminate: isIndeterminate,\n    updateAllChecked: updateAllChecked,\n    handleAllCheckedChange: handleAllCheckedChange\n  };\n};\n\nexport { CHECKED_CHANGE_EVENT, useCheck, useCheckProps };","map":{"version":3,"mappings":"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","names":["CHECKED_CHANGE_EVENT","useCheckProps","data","type","Array","default","optionRender","Function","placeholder","String","title","filterable","Boolean","format","Object","filterMethod","defaultChecked","props","useCheck","panelState","getCurrentInstance","emit","labelProp","computed","label","keyProp","key","disabledProp","disabled","filteredData","filter","item","query","value","toString","toLowerCase","includes","checkableData","checkedSummary","checkedLength","checked","length","dataLength","noChecked","hasChecked","replace","isIndeterminate","updateAllChecked","checkableDataKeys","map","allChecked","every","handleAllCheckedChange","watch","val","oldVal","checkChangeByUser","movedKeys","concat","v","filteredDataKeys","forEach","push","immediate"],"sources":["../../../../../../packages/components/transfer/src/useCheck.ts"],"sourcesContent":["import { computed, getCurrentInstance, watch } from 'vue'\n\nimport type { ExtractPropTypes } from 'vue'\nimport type { TransferPanelState, Key } from './transfer'\n\nexport const CHECKED_CHANGE_EVENT = 'checked-change'\n\nexport const useCheckProps = {\n  data: {\n    type: Array,\n    default() {\n      return []\n    },\n  },\n  optionRender: Function,\n  placeholder: String,\n  title: String,\n  filterable: Boolean,\n  format: Object,\n  filterMethod: Function,\n  defaultChecked: Array,\n  props: Object,\n}\n\nexport const useCheck = (\n  props: ExtractPropTypes<typeof useCheckProps>,\n  panelState: TransferPanelState\n) => {\n  const { emit } = getCurrentInstance()\n\n  const labelProp = computed(() => props.props.label || 'label')\n\n  const keyProp = computed(() => props.props.key || 'key')\n\n  const disabledProp = computed(() => props.props.disabled || 'disabled')\n\n  const filteredData = computed(() => {\n    return props.data.filter((item) => {\n      if (typeof props.filterMethod === 'function') {\n        return props.filterMethod(panelState.query, item)\n      } else {\n        const label = item[labelProp.value] || item[keyProp.value].toString()\n        return label.toLowerCase().includes(panelState.query.toLowerCase())\n      }\n    })\n  })\n\n  const checkableData = computed(() => {\n    return filteredData.value.filter((item) => !item[disabledProp.value])\n  })\n\n  const checkedSummary = computed(() => {\n    const checkedLength = panelState.checked.length\n    const dataLength = props.data.length\n    const { noChecked, hasChecked } = props.format\n\n    if (noChecked && hasChecked) {\n      return checkedLength > 0\n        ? hasChecked\n            .replace(/\\${checked}/g, checkedLength.toString())\n            .replace(/\\${total}/g, dataLength.toString())\n        : noChecked.replace(/\\${total}/g, dataLength.toString())\n    } else {\n      return `${checkedLength}/${dataLength}`\n    }\n  })\n\n  const isIndeterminate = computed(() => {\n    const checkedLength = panelState.checked.length\n    return checkedLength > 0 && checkedLength < checkableData.value.length\n  })\n\n  const updateAllChecked = () => {\n    const checkableDataKeys = checkableData.value.map(\n      (item) => item[keyProp.value]\n    )\n    panelState.allChecked =\n      checkableDataKeys.length > 0 &&\n      checkableDataKeys.every((item) => panelState.checked.includes(item))\n  }\n\n  const handleAllCheckedChange = (value: Key[]) => {\n    panelState.checked = value\n      ? checkableData.value.map((item) => item[keyProp.value])\n      : []\n  }\n\n  watch(\n    () => panelState.checked,\n    (val, oldVal) => {\n      updateAllChecked()\n\n      if (panelState.checkChangeByUser) {\n        const movedKeys = val\n          .concat(oldVal)\n          .filter((v) => !val.includes(v) || !oldVal.includes(v))\n        emit(CHECKED_CHANGE_EVENT, val, movedKeys)\n      } else {\n        emit(CHECKED_CHANGE_EVENT, val)\n        panelState.checkChangeByUser = true\n      }\n    }\n  )\n\n  watch(checkableData, () => {\n    updateAllChecked()\n  })\n\n  watch(\n    () => props.data,\n    () => {\n      const checked = []\n      const filteredDataKeys = filteredData.value.map(\n        (item) => item[keyProp.value]\n      )\n      panelState.checked.forEach((item) => {\n        if (filteredDataKeys.includes(item)) {\n          checked.push(item)\n        }\n      })\n      panelState.checkChangeByUser = false\n      panelState.checked = checked\n    }\n  )\n\n  watch(\n    () => props.defaultChecked,\n    (val, oldVal) => {\n      if (\n        oldVal &&\n        val.length === oldVal.length &&\n        val.every((item) => oldVal.includes(item))\n      )\n        return\n\n      const checked = []\n      const checkableDataKeys = checkableData.value.map(\n        (item) => item[keyProp.value]\n      )\n\n      val.forEach((item) => {\n        if (checkableDataKeys.includes(item)) {\n          checked.push(item)\n        }\n      })\n      panelState.checkChangeByUser = false\n      panelState.checked = checked\n    },\n    {\n      immediate: true,\n    }\n  )\n\n  return {\n    labelProp,\n    keyProp,\n    disabledProp,\n    filteredData,\n    checkableData,\n    checkedSummary,\n    isIndeterminate,\n    updateAllChecked,\n    handleAllCheckedChange,\n  }\n}\n"]},"metadata":{},"sourceType":"module"}