{"ast":null,"code":"import \"core-js/modules/es.error.cause.js\";\n\n/*\nol-mapbox-style - Use Mapbox Style objects with OpenLayers\nCopyright 2016-present ol-mapbox-style contributors\nLicense: https://raw.githubusercontent.com/openlayers/ol-mapbox-style/master/LICENSE\n*/\nimport GeoJSON from 'ol/format/GeoJSON.js';\nimport MVT from 'ol/format/MVT.js';\nimport Map from 'ol/Map.js';\nimport TileGrid from 'ol/tilegrid/TileGrid.js';\nimport TileJSON from 'ol/source/TileJSON.js';\nimport TileLayer from 'ol/layer/Tile.js';\nimport VectorLayer from 'ol/layer/Vector.js';\nimport VectorSource from 'ol/source/Vector.js';\nimport VectorTileLayer from 'ol/layer/VectorTile.js';\nimport VectorTileSource from 'ol/source/VectorTile.js';\nimport View from 'ol/View.js';\nimport applyStyleFunction, { _colorWithOpacity, getValue } from './stylefunction.js';\nimport googleFonts from 'webfont-matcher/lib/fonts/google.js';\nimport mb2css from 'mapbox-to-css-font';\nimport { Color } from '@mapbox/mapbox-gl-style-spec';\nimport { assign, defaultResolutions } from './util.js';\nimport { createXYZ } from 'ol/tilegrid.js';\nimport { fromLonLat } from 'ol/proj.js';\nimport { unByKey } from 'ol/Observable.js';\n/**\n * @typedef {import(\"ol/Map\").default} PluggableMap\n * @typedef {import(\"ol/layer/Layer\").default} Layer\n * @typedef {import(\"ol/source/Source\").default} Source\n * @private\n */\n\nvar tilejsonCache = {};\nvar fontFamilyRegEx = /font-family: ?([^;]*);/;\nvar stripQuotesRegEx = /(\"|')/g;\nvar loadedFontFamilies;\n\nfunction hasFontFamily(family) {\n  if (!loadedFontFamilies) {\n    loadedFontFamilies = {};\n    var styleSheets = document.styleSheets;\n\n    for (var i = 0, ii = styleSheets.length; i < ii; ++i) {\n      var styleSheet =\n      /** @type {CSSStyleSheet} */\n      styleSheets[i];\n\n      try {\n        var cssRules = styleSheet.rules || styleSheet.cssRules;\n\n        if (cssRules) {\n          for (var j = 0, jj = cssRules.length; j < jj; ++j) {\n            var cssRule = cssRules[j];\n\n            if (cssRule.type == 5) {\n              var match = cssRule.cssText.match(fontFamilyRegEx);\n              loadedFontFamilies[match[1].replace(stripQuotesRegEx, '')] = true;\n            }\n          }\n        }\n      } catch (e) {// empty catch block\n      }\n    }\n  }\n\n  return family in loadedFontFamilies;\n}\n\nvar processedFontFamilies = {};\nvar googleFamilies = googleFonts.getNames();\n/**\n * @private\n * @param {Array} fonts Fonts.\n * @return {Array} Processed fonts.\n */\n\nfunction getFonts(fonts) {\n  var fontsKey = fonts.toString();\n\n  if (fontsKey in processedFontFamilies) {\n    return fonts;\n  }\n\n  var googleFontDescriptions = fonts.map(function (font) {\n    var parts = mb2css(font, 1).split(' ');\n    return [parts.slice(3).join(' ').replace(/\"/g, ''), parts[1] + parts[0]];\n  });\n\n  for (var i = 0, ii = googleFontDescriptions.length; i < ii; ++i) {\n    var googleFontDescription = googleFontDescriptions[i];\n    var family = googleFontDescription[0];\n\n    if (!hasFontFamily(family) && googleFamilies.indexOf(family) !== -1) {\n      var fontUrl = 'https://fonts.googleapis.com/css?family=' + family.replace(/ /g, '+') + ':' + googleFontDescription[1];\n\n      if (!document.querySelector('link[href=\"' + fontUrl + '\"]')) {\n        var markup = document.createElement('link');\n        markup.href = fontUrl;\n        markup.rel = 'stylesheet';\n        document.head.appendChild(markup);\n      }\n    }\n  }\n\n  processedFontFamilies[fontsKey] = true;\n  return fonts;\n}\n\nvar spriteRegEx = /^(.*)(\\?.*)$/;\n\nfunction withPath(url, path) {\n  if (path && url.indexOf('.') === 0) {\n    url = path + url;\n  }\n\n  return url;\n}\n\nfunction toSpriteUrl(url, path, extension) {\n  url = withPath(url, path);\n  var parts = url.match(spriteRegEx);\n  return parts ? parts[1] + extension + (parts.length > 2 ? parts[2] : '') : url + extension;\n}\n/**\n * ```js\n * import {applyStyle} from 'ol-mapbox-style';\n * ```\n *\n * Applies a style function to an `ol.layer.VectorTile` or `ol.layer.Vector`\n * with an `ol.source.VectorTile` or an `ol.source.Vector`. The style function\n * will render all layers from the `glStyle` object that use the specified\n * `source`, or a subset of layers from the same source. The source needs to be\n * a `\"type\": \"vector\"` or `\"type\": \"geojson\"` source.\n *\n * Two additional properties will be set on the provided layer:\n *\n *  * `mapbox-source`: The `id` of the Mapbox Style document's source that the\n *    OpenLayers layer was created from. Usually `apply()` creates one\n *    OpenLayers layer per Mapbox Style source, unless the layer stack has\n *    layers from different sources in between.\n *  * `mapbox-layers`: The `id`s of the Mapbox Style document's layers that are\n *    included in the OpenLayers layer.\n *\n * @param {VectorTileLayer|VectorLayer} layer OpenLayers layer.\n * @param {string|Object} glStyle Mapbox Style object.\n * @param {string|Array<string>} source `source` key or an array of layer `id`s from the\n * Mapbox Style object. When a `source` key is provided, all layers for the\n * specified source will be included in the style function. When layer `id`s\n * are provided, they must be from layers that use the same source.\n * @param {string} [path=undefined] Path of the style file. Only required when\n * a relative path is used with the `\"sprite\"` property of the style.\n * @param {Array<number>} [resolutions=undefined] Resolutions for mapping resolution to zoom level.\n * @return {Promise} Promise which will be resolved when the style can be used\n * for rendering.\n */\n\n\nexport function applyStyle(layer, glStyle, source, path, resolutions) {\n  return new Promise(function (resolve, reject) {\n    // TODO: figure out where best place to check source type is\n    // Note that the source arg is an array of gl layer ids and each must be\n    // dereferenced to get source type to validate\n    if (typeof glStyle != 'object') {\n      glStyle = JSON.parse(glStyle);\n    }\n\n    if (glStyle.version != 8) {\n      return reject(new Error('glStyle version 8 required.'));\n    }\n\n    if (!(layer instanceof VectorLayer || layer instanceof VectorTileLayer)) {\n      return reject(new Error('Can only apply to VectorLayer or VectorTileLayer'));\n    }\n\n    var spriteScale, spriteData, spriteImageUrl, style;\n\n    function onChange() {\n      if (!style && (!glStyle.sprite || spriteData)) {\n        style = applyStyleFunction(layer, glStyle, source, resolutions, spriteData, spriteImageUrl, getFonts);\n\n        if (!layer.getStyle()) {\n          reject(new Error(\"Nothing to show for source [\".concat(source, \"]\")));\n        } else {\n          resolve();\n        }\n      } else if (style) {\n        layer.setStyle(style);\n        resolve();\n      } else {\n        reject(new Error('Something went wrong trying to apply style.'));\n      }\n    }\n\n    if (glStyle.sprite) {\n      spriteScale = window.devicePixelRatio >= 1.5 ? 0.5 : 1;\n      var sizeFactor_1 = spriteScale == 0.5 ? '@2x' : '';\n      var spriteUrl_1 = toSpriteUrl(glStyle.sprite, path, sizeFactor_1 + '.json');\n      fetch(spriteUrl_1, {\n        credentials: 'same-origin'\n      }).then(function (response) {\n        if (!response.ok && sizeFactor_1 !== '') {\n          spriteUrl_1 = toSpriteUrl(glStyle.sprite, path, '.json');\n          return fetch(spriteUrl_1, {\n            credentials: 'same-origin'\n          });\n        } else {\n          return response;\n        }\n      }).then(function (response) {\n        if (response.ok) {\n          return response.json();\n        } else {\n          reject(new Error(\"Problem fetching sprite from \".concat(spriteUrl_1, \": \").concat(response.statusText)));\n        }\n      }).then(function (spritesJson) {\n        if (spritesJson === undefined) {\n          return reject(new Error('No sprites found.'));\n        }\n\n        spriteData = spritesJson;\n        spriteImageUrl = toSpriteUrl(glStyle.sprite, path, sizeFactor_1 + '.png');\n        onChange();\n      }).catch(function (err) {\n        reject(new Error(\"Sprites cannot be loaded: \".concat(spriteUrl_1, \": \").concat(err.message)));\n      });\n    } else {\n      onChange();\n    }\n  });\n}\nvar emptyObj = {};\n\nfunction setBackground(mapOrLayer, layer) {\n  var background = {\n    id: layer.id,\n    type: layer.type\n  };\n  var functionCache = {};\n\n  function updateStyle(resolution) {\n    var layout = layer.layout || {};\n    var paint = layer.paint || {};\n    background['paint'] = paint;\n    var zoom = typeof mapOrLayer.getSource === 'function' ? mapOrLayer.getSource().getTileGrid().getZForResolution(resolution) : mapOrLayer.getView().getZoom();\n    var element = typeof mapOrLayer.getTargetElement === 'function' ? mapOrLayer.getTargetElement() : undefined;\n    var bg, opacity;\n\n    if (paint['background-color'] !== undefined) {\n      bg = getValue(background, 'paint', 'background-color', zoom, emptyObj, functionCache);\n\n      if (element) {\n        element.style.background = Color.parse(bg).toString();\n      }\n    }\n\n    if (paint['background-opacity'] !== undefined) {\n      opacity = getValue(background, 'paint', 'background-opacity', zoom, emptyObj, functionCache);\n\n      if (element) {\n        element.style.opacity = opacity;\n      }\n    }\n\n    if (layout.visibility == 'none') {\n      if (element) {\n        element.style.backgroundColor = '';\n        element.style.opacity = '';\n      }\n\n      return undefined;\n    }\n\n    return _colorWithOpacity(bg, opacity);\n  }\n\n  if (typeof mapOrLayer.getTargetElement === 'function') {\n    if (mapOrLayer.getTargetElement()) {\n      updateStyle();\n    }\n\n    mapOrLayer.on(['change:resolution', 'change:target'], updateStyle);\n  } else if (typeof mapOrLayer.setBackground === 'function') {\n    mapOrLayer.setBackground(updateStyle);\n  } else {\n    throw new Error('Unable to apply background.');\n  }\n}\n/**\n * ```js\n * import {applyBackground} from 'ol-mapbox-style';\n * ```\n * Applies properties of the Mapbox Style's first `background` layer to the\n * provided map or VectorTile layer.\n * @param {PluggableMap|VectorTileLayer} mapOrLayer OpenLayers Map or VectorTile layer.\n * @param {Object} glStyle Mapbox Style object.\n */\n\n\nexport function applyBackground(mapOrLayer, glStyle) {\n  glStyle.layers.some(function (l) {\n    if (l.type == 'background') {\n      setBackground(mapOrLayer, l);\n      return true;\n    }\n  });\n}\n\nfunction getSourceIdByRef(layers, ref) {\n  var sourceId;\n  layers.some(function (layer) {\n    if (layer.id == ref) {\n      sourceId = layer.source;\n      return true;\n    }\n  });\n  return sourceId;\n}\n\nfunction extentFromTileJSON(tileJSON) {\n  var bounds = tileJSON.bounds;\n\n  if (bounds) {\n    var ll = fromLonLat([bounds[0], bounds[1]]);\n    var tr = fromLonLat([bounds[2], bounds[3]]);\n    return [ll[0], ll[1], tr[0], tr[1]];\n  }\n}\n/**\n * Creates an OpenLayers VectorTile source for a gl source entry.\n * @param {Object} glSource \"source\" entry from a Mapbox Style object.\n * @param {string|undefined} url URL to use for the source. This is expected to be the complete http(s) url,\n * with access key applied.When not provided, `glSource.tiles` has to be set.\n * @return {Promise<import(\"ol/source/VectorTile\").default>} Promise resolving to a VectorTile source.\n * @private\n */\n\n\nexport function setupVectorSource(glSource, url) {\n  glSource = assign({}, glSource);\n  var cacheKey = [url, JSON.stringify(glSource)].toString();\n  var tilejson = tilejsonCache[cacheKey];\n\n  if (!tilejson) {\n    tilejson = new TileJSON({\n      url: glSource.tiles ? undefined : url,\n      tileJSON: glSource.tiles ? glSource : undefined\n    });\n    tilejsonCache[cacheKey] = tilejson;\n  }\n\n  return new Promise(function (resolve) {\n    var key = tilejson.on('change', function () {\n      var state = tilejson.getState();\n\n      if (state === 'ready') {\n        var tileJSONDoc = tilejson.getTileJSON();\n        var tiles = Array.isArray(tileJSONDoc.tiles) ? tileJSONDoc.tiles : [tileJSONDoc.tiles];\n\n        if (url) {\n          for (var i = 0, ii = tiles.length; i < ii; ++i) {\n            tiles[i] = decodeURI(new URL(tiles[i], url).href);\n          }\n        }\n\n        var tileGrid = tilejson.getTileGrid();\n        var extent = extentFromTileJSON(tileJSONDoc);\n        var minZoom = tileJSONDoc.minzoom || 0;\n        var maxZoom = tileJSONDoc.maxzoom || 22;\n        var source = tilejson.get('ol-source');\n\n        if (source === undefined) {\n          source = new VectorTileSource({\n            attributions: tilejson.getAttributions(),\n            format: new MVT(),\n            tileGrid: new TileGrid({\n              origin: tileGrid.getOrigin(0),\n              extent: extent || tileGrid.getExtent(),\n              minZoom: minZoom,\n              resolutions: defaultResolutions.slice(0, maxZoom + 1),\n              tileSize: 512\n            }),\n            urls: tiles\n          });\n          tilejson.set('ol-source', source);\n        }\n\n        unByKey(key);\n        resolve(source);\n      } else if (state === 'error') {\n        tilejson.set('ol-source', null);\n        unByKey(key);\n        resolve(undefined);\n      }\n    });\n\n    if (tilejson.getState() === 'ready') {\n      tilejson.changed();\n    }\n  });\n}\n\nfunction setupVectorLayer(glSource, url) {\n  var layer = new VectorTileLayer({\n    declutter: true,\n    visible: false\n  });\n  setupVectorSource(glSource, url).then(function (source) {\n    layer.setSource(source);\n  });\n  return layer;\n}\n\nfunction setupRasterLayer(glSource, url) {\n  var layer = new TileLayer();\n  var source = new TileJSON({\n    transition: 0,\n    url: glSource.tiles ? undefined : url,\n    tileJSON: glSource.tiles ? glSource : undefined,\n    crossOrigin: 'anonymous'\n  });\n  var key = source.on('change', function () {\n    var state = source.getState();\n\n    if (state === 'ready') {\n      unByKey(key);\n      var tileJSONDoc =\n      /** @type {Object} */\n      source.getTileJSON();\n      var extent = extentFromTileJSON(tileJSONDoc);\n      var tileGrid = source.getTileGrid();\n      var tileSize = glSource.tileSize || tileJSONDoc.tileSize || 512;\n      var minZoom = tileJSONDoc.minzoom || 0;\n      var maxZoom = tileJSONDoc.maxzoom || 22; // Only works when using ES modules\n      //@ts-ignore\n\n      source.tileGrid = new TileGrid({\n        origin: tileGrid.getOrigin(0),\n        extent: extent || tileGrid.getExtent(),\n        minZoom: minZoom,\n        resolutions: createXYZ({\n          maxZoom: maxZoom,\n          tileSize: tileSize\n        }).getResolutions(),\n        tileSize: tileSize\n      });\n      layer.setSource(source);\n    } else if (state === 'error') {\n      unByKey(key);\n      layer.setSource(undefined);\n    }\n  });\n  source.setTileLoadFunction(function (tile, src) {\n    if (src.indexOf('{bbox-epsg-3857}') != -1) {\n      var bbox = source.getTileGrid().getTileCoordExtent(tile.getTileCoord());\n      src = src.replace('{bbox-epsg-3857}', bbox.toString());\n    }\n\n    var img =\n    /** @type {import(\"ol/ImageTile\").default} */\n    tile.getImage();\n    /** @type {HTMLImageElement} */\n\n    img.src = src;\n  });\n  return layer;\n}\n\nvar geoJsonFormat = new GeoJSON();\n\nfunction setupGeoJSONLayer(glSource, path) {\n  var data = glSource.data;\n  var features, geoJsonUrl;\n\n  if (typeof data == 'string') {\n    geoJsonUrl = withPath(data, path);\n  } else {\n    features = geoJsonFormat.readFeatures(data, {\n      featureProjection: 'EPSG:3857'\n    });\n  }\n\n  return new VectorLayer({\n    source: new VectorSource({\n      attributions: glSource.attribution,\n      features: features,\n      format: geoJsonFormat,\n      url: geoJsonUrl\n    }),\n    visible: false\n  });\n}\n\nfunction updateRasterLayerProperties(glLayer, layer, view, functionCache) {\n  var zoom = view.getZoom();\n  var opacity = getValue(glLayer, 'paint', 'raster-opacity', zoom, emptyObj, functionCache);\n  layer.setOpacity(opacity);\n}\n\nfunction processStyle(glStyle, map, baseUrl, host, path, accessToken) {\n  if (accessToken === void 0) {\n    accessToken = '';\n  }\n\n  var promises = [];\n  var view = map.getView();\n\n  if (!view.isDef() && !view.getRotation() && !view.getResolutions()) {\n    view = new View(assign(view.getProperties(), {\n      maxResolution: defaultResolutions[0]\n    }));\n    map.setView(view);\n  }\n\n  if ('center' in glStyle && !view.getCenter()) {\n    view.setCenter(fromLonLat(glStyle.center));\n  }\n\n  if ('zoom' in glStyle && view.getZoom() === undefined) {\n    view.setResolution(defaultResolutions[0] / Math.pow(2, glStyle.zoom));\n  }\n\n  if (!view.getCenter() || view.getZoom() === undefined) {\n    view.fit(view.getProjection().getExtent(), {\n      nearest: true,\n      size: map.getSize()\n    });\n  }\n\n  if (glStyle.sprite) {\n    if (glStyle.sprite.indexOf('mapbox://') == 0) {\n      glStyle.sprite = baseUrl + '/sprite' + accessToken;\n    } else if (glStyle.sprite.indexOf('http') != 0) {\n      glStyle.sprite = (host ? host + path : '') + glStyle.sprite + accessToken;\n    }\n  }\n\n  var glLayers = glStyle.layers;\n  var layerIds = [];\n  var glLayer, glSource, glSourceId, id, layer, url;\n\n  var _loop_1 = function (i, ii) {\n    glLayer = glLayers[i];\n    var type = glLayer.type;\n\n    if (type == 'heatmap' || type == 'hillshade') {//FIXME Unsupported layer type\n    } else if (type == 'background') {\n      setBackground(map, glLayer);\n    } else {\n      id = glLayer.source || getSourceIdByRef(glLayers, glLayer.ref); // this technique assumes gl layers will be in a particular order\n\n      if (id != glSourceId) {\n        if (layerIds.length) {\n          promises.push(finalizeLayer(layer, layerIds, glStyle, path, map));\n          layerIds = [];\n        }\n\n        glSource = glStyle.sources[id];\n        url = glSource.url;\n\n        if (url) {\n          url = withPath(url, path);\n\n          if (url.indexOf('mapbox://') == 0) {\n            var mapid_1 = url.replace('mapbox://', '');\n            glSource.tiles = ['a', 'b', 'c', 'd'].map(function (host) {\n              return 'https://' + host + '.tiles.mapbox.com/v4/' + mapid_1 + '/{z}/{x}/{y}.' + (glSource.type == 'vector' ? 'vector.pbf' : 'png') + accessToken;\n            });\n          } else if (url.indexOf('/') === 0 && host.indexOf('http') === 0) {\n            url = host + url;\n          }\n        }\n\n        if (glSource.tiles) {\n          glSource.tiles = glSource.tiles.map(function (url) {\n            return withPath(url, path);\n          });\n        }\n\n        if (glSource.type == 'vector') {\n          layer = setupVectorLayer(glSource, url);\n        } else if (glSource.type == 'raster') {\n          layer = setupRasterLayer(glSource, url);\n          layer.setVisible(glLayer.layout ? glLayer.layout.visibility !== 'none' : true);\n          var functionCache = {};\n          view.on('change:resolution', updateRasterLayerProperties.bind(this_1, glLayer, layer, view, functionCache));\n          updateRasterLayerProperties(glLayer, layer, view, functionCache);\n        } else if (glSource.type == 'geojson') {\n          layer = setupGeoJSONLayer(glSource, path);\n        }\n\n        glSourceId = id;\n\n        if (layer) {\n          layer.set('mapbox-source', glSourceId);\n        }\n      }\n\n      layerIds.push(glLayer.id);\n    }\n  };\n\n  var this_1 = this;\n\n  for (var i = 0, ii = glLayers.length; i < ii; ++i) {\n    _loop_1(i, ii);\n  }\n\n  promises.push(finalizeLayer(layer, layerIds, glStyle, path, map));\n  map.set('mapbox-style', glStyle);\n  return Promise.all(promises);\n}\n/**\n * ```js\n * import olms from 'ol-mapbox-style';\n * ```\n *\n * Loads and applies a Mapbox Style object to an OpenLayers Map. This includes\n * the map background, the layers, the center and the zoom.\n *\n * The center and zoom will only be set if present in the Mapbox Style document,\n * and if not already set on the OpenLayers map.\n *\n * Layers will be added to the OpenLayers map, without affecting any layers that\n * might already be set on the map.\n *\n * Layers added by `apply()` will have two additional properties:\n *\n *  * `mapbox-source`: The `id` of the Mapbox Style document's source that the\n *    OpenLayers layer was created from. Usually `apply()` creates one\n *    OpenLayers layer per Mapbox Style source, unless the layer stack has\n *    layers from different sources in between.\n *  * `mapbox-layers`: The `id`s of the Mapbox Style document's layers that are\n *    included in the OpenLayers layer.\n *\n * This function sets an additional `mapbox-style` property on the OpenLayers\n * map instance, which holds the Mapbox Style object.\n *\n * @param {PluggableMap|HTMLElement|string} map Either an existing OpenLayers Map\n * instance, or a HTML element, or the id of a HTML element that will be the\n * target of a new OpenLayers Map.\n * @param {string|Object} style JSON style object or style url pointing to a\n * Mapbox Style object. When using Mapbox APIs, the url must contain an access\n * token and look like\n * `https://api.mapbox.com/styles/v1/mapbox/bright-v9?access_token=[your_access_token_here]`.\n * When passed as JSON style object, all OpenLayers layers created by `apply()`\n * will be immediately available, but they may not have a source yet (i.e. when\n * they are defined by a TileJSON url in the Mapbox Style document). When passed\n * as style url, layers will be added to the map when the Mapbox Style document\n * is loaded and parsed.\n * @return {Promise} A promise that resolves after all layers have been added to\n * the OpenLayers Map instance, their sources set, and their styles applied. the\n * `resolve` callback will be called with the OpenLayers Map instance as\n * argument.\n */\n\n\nexport default function olms(map, style) {\n  var promise,\n      accessToken = '',\n      baseUrl = '',\n      host = '',\n      path = '';\n\n  if (typeof map === 'string' || map instanceof HTMLElement) {\n    map = new Map({\n      target: map\n    });\n  }\n\n  if (typeof style === 'string') {\n    var parts = style.match(spriteRegEx);\n\n    if (parts) {\n      baseUrl = parts[1];\n      accessToken = parts.length > 2 ? parts[2] : '';\n    }\n\n    promise = new Promise(function (resolve, reject) {\n      fetch(style, {\n        credentials: 'same-origin'\n      }).then(function (response) {\n        return response.json();\n      }).then(function (glStyle) {\n        var a =\n        /** @type {HTMLAnchorElement} */\n        document.createElement('A');\n        a.href = style;\n        var href = a.href;\n        path = a.pathname.split('/').slice(0, -1).join('/') + '/';\n        host = href.substr(0, href.indexOf(path));\n        processStyle(glStyle, map, baseUrl, host, path, accessToken).then(function () {\n          resolve(map);\n        }).catch(reject);\n      }).catch(function (err) {\n        reject(new Error(\"Could not load \".concat(style, \": \").concat(err.message)));\n      });\n    });\n  } else {\n    promise = new Promise(function (resolve, reject) {\n      processStyle(style, map).then(function () {\n        resolve(map);\n      }).catch(reject);\n    });\n  }\n\n  return promise;\n}\n/**\n * ```js\n * import {apply} from 'ol-mapbox-style';\n * ```\n * Like `olms`, but returns an `ol/Map` instance instead of a `Promise`.\n *\n * @param {PluggableMap|HTMLElement|string} map Either an existing OpenLayers Map\n * instance, or a HTML element, or the id of a HTML element that will be the\n * target of a new OpenLayers Map.\n * @param {string|Object} style JSON style object or style url pointing to a\n * Mapbox Style object. When using Mapbox APIs, the url must contain an access\n * token and look like\n * `https://api.mapbox.com/styles/v1/mapbox/bright-v9?access_token=[your_access_token_here]`.\n * When passed as JSON style object, all OpenLayers layers created by `apply()`\n * will be immediately available, but they may not have a source yet (i.e. when\n * they are defined by a TileJSON url in the Mapbox Style document). When passed\n * as style url, layers will be added to the map when the Mapbox Style document\n * is loaded and parsed.\n * @return {PluggableMap} The OpenLayers Map instance that will be populated with the\n * contents described in the Mapbox Style object.\n */\n\nexport function apply(map, style) {\n  if (typeof map === 'string' || map instanceof HTMLElement) {\n    map = new Map({\n      target: map\n    });\n  }\n\n  setTimeout(function () {\n    olms(map, style);\n  }, 0);\n  return map;\n}\n/**\n * If layerIds is not empty, applies the style specified in glStyle to the layer,\n * and adds the layer to the map.\n *\n * The layer may not yet have a source when the function is called.  If so, the style\n * is applied to the layer via a once listener on the 'change:source' event.\n *\n * @param {Layer} layer An OpenLayers layer instance.\n * @param {Array<string>} layerIds Array containing layer ids of already-processed layers.\n * @param {Object} glStyle Style as a JSON object.\n * @param {string|undefined} path The path part of the style URL. Only required\n * when a relative path is used with the `\"sprite\"` property of the style.\n * @param {PluggableMap} map OpenLayers Map.\n * @return {Promise} Returns a promise that resolves after the source has\n * been set on the specified layer, and the style has been applied.\n * @private\n */\n\nfunction finalizeLayer(layer, layerIds, glStyle, path, map) {\n  var minZoom = 24;\n  var maxZoom = 0;\n  var glLayers = glStyle.layers;\n\n  for (var i = 0, ii = glLayers.length; i < ii; ++i) {\n    var glLayer = glLayers[i];\n\n    if (layerIds.indexOf(glLayer.id) !== -1) {\n      minZoom = Math.min('minzoom' in glLayer ? glLayer.minzoom : 0, minZoom);\n      maxZoom = Math.max('maxzoom' in glLayer ? glLayer.maxzoom : 24, maxZoom);\n    }\n  }\n\n  return new Promise(function (resolve, reject) {\n    var setStyle = function () {\n      var source = layer.getSource();\n\n      if (!source || source.getState() === 'error') {\n        reject(new Error('Error accessing data for source ' + layer.get('mapbox-source')));\n        return;\n      }\n\n      if ('getTileGrid' in source) {\n        var tileGrid =\n        /** @type {import(\"ol/source/Tile.js\").default|import(\"ol/source/VectorTile.js\").default} */\n        source.getTileGrid();\n\n        if (tileGrid) {\n          var sourceMinZoom = tileGrid.getMinZoom();\n\n          if (minZoom > 0 || sourceMinZoom > 0) {\n            layer.setMaxResolution(Math.min(defaultResolutions[minZoom], tileGrid.getResolution(sourceMinZoom)) + 1e-9);\n          }\n\n          if (maxZoom < 24) {\n            layer.setMinResolution(defaultResolutions[maxZoom] + 1e-9);\n          }\n        }\n      }\n\n      if (source instanceof VectorSource || source instanceof VectorTileSource) {\n        applyStyle(\n        /** @type {import(\"ol/layer/Vector\").default|import(\"ol/layer/VectorTile\").default} */\n        layer, glStyle, layerIds, path).then(function () {\n          layer.setVisible(true);\n          resolve();\n        }, function (e) {\n          reject(e);\n        });\n      } else {\n        resolve();\n      }\n    };\n\n    layer.set('mapbox-layers', layerIds);\n\n    if (map.getLayers().getArray().indexOf(layer) === -1) {\n      map.addLayer(layer);\n    }\n\n    if (layer.getSource()) {\n      setStyle();\n    } else {\n      layer.once('change:source', setStyle);\n    }\n  });\n}\n/**\n * ```js\n * import {getLayer} from 'ol-mapbox-style';\n * ```\n * Get the OpenLayers layer instance that contains the provided Mapbox Style\n * `layer`. Note that multiple Mapbox Style layers are combined in a single\n * OpenLayers layer instance when they use the same Mapbox Style `source`.\n * @param {PluggableMap} map OpenLayers Map.\n * @param {string} layerId Mapbox Style layer id.\n * @return {Layer} OpenLayers layer instance.\n */\n\n\nexport function getLayer(map, layerId) {\n  var layers = map.getLayers().getArray();\n\n  for (var i = 0, ii = layers.length; i < ii; ++i) {\n    var mapboxLayers = layers[i].get('mapbox-layers');\n\n    if (mapboxLayers && mapboxLayers.indexOf(layerId) !== -1) {\n      return (\n        /** @type {Layer} */\n        layers[i]\n      );\n    }\n  }\n}\n/**\n * ```js\n * import {getLayers} from 'ol-mapbox-style';\n * ```\n * Get the OpenLayers layer instances for the provided Mapbox Style `source`.\n * @param {PluggableMap} map OpenLayers Map.\n * @param {string} sourceId Mapbox Style source id.\n * @return {Array<Layer>} OpenLayers layer instances.\n */\n\nexport function getLayers(map, sourceId) {\n  var result = [];\n  var layers = map.getLayers().getArray();\n\n  for (var i = 0, ii = layers.length; i < ii; ++i) {\n    if (layers[i].get('mapbox-source') === sourceId) {\n      result.push(\n      /** @type {Layer} */\n      layers[i]);\n    }\n  }\n\n  return result;\n}\n/**\n * ```js\n * import {getSource} from 'ol-mapbox-style';\n * ```\n * Get the OpenLayers source instance for the provided Mapbox Style `source`.\n * @param {PluggableMap} map OpenLayers Map.\n * @param {string} sourceId Mapbox Style source id.\n * @return {Source} OpenLayers source instance.\n */\n\nexport function getSource(map, sourceId) {\n  var layers = map.getLayers().getArray();\n\n  for (var i = 0, ii = layers.length; i < ii; ++i) {\n    var source =\n    /** @type {Layer} */\n    layers[i].getSource();\n\n    if (layers[i].get('mapbox-source') === sourceId) {\n      return source;\n    }\n  }\n}\nexport { finalizeLayer as _finalizeLayer, getFonts as _getFonts };","map":{"version":3,"mappings":"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","names":["GeoJSON","MVT","Map","TileGrid","TileJSON","TileLayer","VectorLayer","VectorSource","VectorTileLayer","VectorTileSource","View","applyStyleFunction","_colorWithOpacity","getValue","googleFonts","mb2css","Color","assign","defaultResolutions","createXYZ","fromLonLat","unByKey","tilejsonCache","fontFamilyRegEx","stripQuotesRegEx","loadedFontFamilies","hasFontFamily","family","styleSheets","document","i","ii","length","styleSheet","cssRules","rules","j","jj","cssRule","type","match","cssText","replace","e","processedFontFamilies","googleFamilies","getNames","getFonts","fonts","fontsKey","toString","googleFontDescriptions","map","font","parts","split","slice","join","googleFontDescription","indexOf","fontUrl","querySelector","markup","createElement","href","rel","head","appendChild","spriteRegEx","withPath","url","path","toSpriteUrl","extension","applyStyle","layer","glStyle","source","resolutions","Promise","resolve","reject","JSON","parse","version","Error","spriteScale","spriteData","spriteImageUrl","style","onChange","sprite","getStyle","setStyle","window","devicePixelRatio","sizeFactor_1","spriteUrl_1","fetch","credentials","then","response","ok","json","concat","statusText","spritesJson","undefined","catch","err","message","emptyObj","setBackground","mapOrLayer","background","id","functionCache","updateStyle","resolution","layout","paint","zoom","getSource","getTileGrid","getZForResolution","getView","getZoom","element","getTargetElement","bg","opacity","visibility","backgroundColor","on","applyBackground","layers","some","l","getSourceIdByRef","ref","sourceId","extentFromTileJSON","tileJSON","bounds","ll","tr","setupVectorSource","glSource","cacheKey","stringify","tilejson","tiles","key","state","getState","tileJSONDoc","getTileJSON","Array","isArray","decodeURI","URL","tileGrid","extent","minZoom","minzoom","maxZoom","maxzoom","get","attributions","getAttributions","format","origin","getOrigin","getExtent","tileSize","urls","set","changed","setupVectorLayer","declutter","visible","setSource","setupRasterLayer","transition","crossOrigin","getResolutions","setTileLoadFunction","tile","src","bbox","getTileCoordExtent","getTileCoord","img","getImage","geoJsonFormat","setupGeoJSONLayer","data","features","geoJsonUrl","readFeatures","featureProjection","attribution","updateRasterLayerProperties","glLayer","view","setOpacity","processStyle","baseUrl","host","accessToken","promises","isDef","getRotation","getProperties","maxResolution","setView","getCenter","setCenter","center","setResolution","Math","pow","fit","getProjection","nearest","size","getSize","glLayers","layerIds","glSourceId","push","finalizeLayer","sources","mapid_1","setVisible","bind","this_1","all","olms","promise","HTMLElement","target","a","pathname","substr","apply","setTimeout","min","max","sourceMinZoom","getMinZoom","setMaxResolution","getResolution","setMinResolution","getLayers","getArray","addLayer","once","getLayer","layerId","mapboxLayers","result","_finalizeLayer","_getFonts"],"sourceRoot":"","sources":["../src/index.js"],"sourcesContent":[null]},"metadata":{},"sourceType":"module"}