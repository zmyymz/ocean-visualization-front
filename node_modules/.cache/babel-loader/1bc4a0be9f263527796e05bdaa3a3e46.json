{"ast":null,"code":"import \"core-js/modules/es.error.cause.js\";\nimport \"core-js/modules/es.array.join.js\";\nimport \"core-js/modules/es.regexp.exec.js\";\nimport \"core-js/modules/es.string.split.js\";\nimport \"core-js/modules/es.array.slice.js\";\nimport \"core-js/modules/es.array.splice.js\";\nimport EventType from 'ol/events/EventType.js';\nimport { labelCache } from 'ol/render/canvas.js';\nimport { listen } from 'ol/events.js';\n/**\n * Polyfill for Object.assign().  Assigns enumerable and own properties from\n * one or more source objects to a target object.\n * See https://developer.mozilla.org/en/docs/Web/JavaScript/Reference/Global_Objects/Object/assign.\n *\n * @param {!Object} target The target object.\n * @param {...Object} var_sources The source object(s).\n * @return {!Object} The modified target object.\n */\n\nexport var assign = typeof Object.assign === 'function' ? Object.assign : function (target, var_sources) {\n  if (target === undefined || target === null) {\n    throw new TypeError('Cannot convert undefined or null to object');\n  }\n\n  var output = Object(target);\n\n  for (var i = 1, ii = arguments.length; i < ii; ++i) {\n    var source = arguments[i];\n\n    if (source !== undefined && source !== null) {\n      for (var key in source) {\n        if (source.hasOwnProperty(key)) {\n          output[key] = source[key];\n        }\n      }\n    }\n  }\n\n  return output;\n};\nexport function deg2rad(degrees) {\n  return degrees * Math.PI / 180;\n}\nexport var defaultResolutions = function () {\n  var resolutions = [];\n\n  for (var res = 78271.51696402048; resolutions.length <= 24; res /= 2) {\n    resolutions.push(res);\n  }\n\n  return resolutions;\n}();\n/**\n * @param {number} width Width of the canvas.\n * @param {number} height Height of the canvas.\n * @return {HTMLCanvasElement} Canvas.\n */\n\nexport function createCanvas(width, height) {\n  if (typeof WorkerGlobalScope !== 'undefined' && self instanceof WorkerGlobalScope && typeof OffscreenCanvas !== 'undefined') {\n    // eslint-disable-line\n    return (\n      /** @type {?} */\n      new OffscreenCanvas(width, height)\n    );\n  } else {\n    var canvas = document.createElement('canvas');\n    canvas.width = width;\n    canvas.height = height;\n    return canvas;\n  }\n}\nexport function getZoomForResolution(resolution, resolutions) {\n  var i = 0;\n  var ii = resolutions.length;\n\n  for (; i < ii; ++i) {\n    var candidate = resolutions[i];\n\n    if (candidate < resolution && i + 1 < ii) {\n      var zoomFactor = resolutions[i] / resolutions[i + 1];\n      return i + Math.log(resolutions[i] / resolution) / Math.log(zoomFactor);\n    }\n  }\n\n  return ii - 1;\n}\nvar hairSpacePool = Array(256).join(\"\\u200A\");\nexport function applyLetterSpacing(text, letterSpacing) {\n  if (letterSpacing >= 0.05) {\n    var textWithLetterSpacing = '';\n    var lines = text.split('\\n');\n    var joinSpaceString = hairSpacePool.slice(0, Math.round(letterSpacing / 0.1));\n\n    for (var l = 0, ll = lines.length; l < ll; ++l) {\n      if (l > 0) {\n        textWithLetterSpacing += '\\n';\n      }\n\n      textWithLetterSpacing += lines[l].split('').join(joinSpaceString);\n    }\n\n    return textWithLetterSpacing;\n  }\n\n  return text;\n}\nvar measureContext;\n\nfunction getMeasureContext() {\n  if (!measureContext) {\n    measureContext = createCanvas(1, 1).getContext('2d');\n  }\n\n  return measureContext;\n}\n\nfunction measureText(text, letterSpacing) {\n  return getMeasureContext().measureText(text).width + (text.length - 1) * letterSpacing;\n}\n\nvar measureCache = {};\n\nif (labelCache) {\n  // Only available when using ES modules\n  //@ts-ignore\n  listen(labelCache, EventType.CLEAR, function () {\n    measureCache = {};\n  });\n}\n\nexport function wrapText(text, font, em, letterSpacing) {\n  if (text.indexOf('\\n') !== -1) {\n    var hardLines = text.split('\\n');\n    var lines = [];\n\n    for (var i = 0, ii = hardLines.length; i < ii; ++i) {\n      lines.push(wrapText(hardLines[i], font, em, letterSpacing));\n    }\n\n    return lines.join('\\n');\n  }\n\n  var key = em + ',' + font + ',' + text + ',' + letterSpacing;\n  var wrappedText = measureCache[key];\n\n  if (!wrappedText) {\n    var words = text.split(' ');\n\n    if (words.length > 1) {\n      var ctx = getMeasureContext();\n      ctx.font = font;\n      var oneEm = ctx.measureText('M').width;\n      var maxWidth = oneEm * em;\n      var line = '';\n      var lines = []; // Pass 1 - wrap lines to not exceed maxWidth\n\n      for (var i = 0, ii = words.length; i < ii; ++i) {\n        var word = words[i];\n        var testLine = line + (line ? ' ' : '') + word;\n\n        if (measureText(testLine, letterSpacing) <= maxWidth) {\n          line = testLine;\n        } else {\n          if (line) {\n            lines.push(line);\n          }\n\n          line = word;\n        }\n      }\n\n      if (line) {\n        lines.push(line);\n      } // Pass 2 - add lines with a width of less than 30% of maxWidth to the previous or next line\n\n\n      for (var i = 0, ii = lines.length; i < ii && ii > 1; ++i) {\n        var line_1 = lines[i];\n\n        if (measureText(line_1, letterSpacing) < maxWidth * 0.35) {\n          var prevWidth = i > 0 ? measureText(lines[i - 1], letterSpacing) : Infinity;\n          var nextWidth = i < ii - 1 ? measureText(lines[i + 1], letterSpacing) : Infinity;\n          lines.splice(i, 1);\n          ii -= 1;\n\n          if (prevWidth < nextWidth) {\n            lines[i - 1] += ' ' + line_1;\n            i -= 1;\n          } else {\n            lines[i] = line_1 + ' ' + lines[i];\n          }\n        }\n      } // Pass 3 - try to fill 80% of maxWidth for each line\n\n\n      for (var i = 0, ii = lines.length - 1; i < ii; ++i) {\n        var line_2 = lines[i];\n        var next = lines[i + 1];\n\n        if (measureText(line_2, letterSpacing) > maxWidth * 0.7 && measureText(next, letterSpacing) < maxWidth * 0.6) {\n          var lineWords = line_2.split(' ');\n          var lastWord = lineWords.pop();\n\n          if (measureText(lastWord, letterSpacing) < maxWidth * 0.2) {\n            lines[i] = lineWords.join(' ');\n            lines[i + 1] = lastWord + ' ' + next;\n          }\n\n          ii -= 1;\n        }\n      }\n\n      wrappedText = lines.join('\\n');\n    } else {\n      wrappedText = text;\n    }\n\n    wrappedText = applyLetterSpacing(wrappedText, letterSpacing);\n    measureCache[key] = wrappedText;\n  }\n\n  return wrappedText;\n}","map":{"version":3,"mappings":"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","names":["EventType","labelCache","listen","assign","Object","target","var_sources","undefined","TypeError","output","i","ii","arguments","length","source","key","hasOwnProperty","deg2rad","degrees","Math","PI","defaultResolutions","resolutions","res","push","createCanvas","width","height","WorkerGlobalScope","self","OffscreenCanvas","canvas","document","createElement","getZoomForResolution","resolution","candidate","zoomFactor","log","hairSpacePool","Array","join","applyLetterSpacing","text","letterSpacing","textWithLetterSpacing","lines","split","joinSpaceString","slice","round","l","ll","measureContext","getMeasureContext","getContext","measureText","measureCache","CLEAR","wrapText","font","em","indexOf","hardLines","wrappedText","words","ctx","oneEm","maxWidth","line","word","testLine","line_1","prevWidth","Infinity","nextWidth","splice","line_2","next","lineWords","lastWord","pop"],"sourceRoot":"","sources":["../src/util.js"],"sourcesContent":[null]},"metadata":{},"sourceType":"module"}