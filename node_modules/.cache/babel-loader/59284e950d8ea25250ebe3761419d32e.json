{"ast":null,"code":"import fs from 'fs';\nimport { BaseSource } from './basesource.js';\n\nfunction closeAsync(fd) {\n  return new Promise((resolve, reject) => {\n    fs.close(fd, err => {\n      if (err) {\n        reject(err);\n      } else {\n        resolve();\n      }\n    });\n  });\n}\n\nfunction openAsync(path, flags, mode = undefined) {\n  return new Promise((resolve, reject) => {\n    fs.open(path, flags, mode, (err, fd) => {\n      if (err) {\n        reject(err);\n      } else {\n        resolve(fd);\n      }\n    });\n  });\n}\n\nfunction readAsync(...args) {\n  return new Promise((resolve, reject) => {\n    fs.read(...args, (err, bytesRead, buffer) => {\n      if (err) {\n        reject(err);\n      } else {\n        resolve({\n          bytesRead,\n          buffer\n        });\n      }\n    });\n  });\n}\n\nclass FileSource extends BaseSource {\n  constructor(path) {\n    super();\n    this.path = path;\n    this.openRequest = openAsync(path, 'r');\n  }\n\n  async fetchSlice(slice) {\n    // TODO: use `signal`\n    const fd = await this.openRequest;\n    const {\n      buffer\n    } = await readAsync(fd, Buffer.alloc(slice.length), 0, slice.length, slice.offset);\n    return buffer.buffer;\n  }\n\n  async close() {\n    const fd = await this.openRequest;\n    await closeAsync(fd);\n  }\n\n}\n\nexport function makeFileSource(path) {\n  return new FileSource(path);\n}","map":{"version":3,"sources":["D:/Java/JavaEE/IdeaProjects/ocean-vis/node_modules/geotiff/dist-module/source/file.js"],"names":["fs","BaseSource","closeAsync","fd","Promise","resolve","reject","close","err","openAsync","path","flags","mode","undefined","open","readAsync","args","read","bytesRead","buffer","FileSource","constructor","openRequest","fetchSlice","slice","Buffer","alloc","length","offset","makeFileSource"],"mappings":"AAAA,OAAOA,EAAP,MAAe,IAAf;AACA,SAASC,UAAT,QAA2B,iBAA3B;;AAEA,SAASC,UAAT,CAAoBC,EAApB,EAAwB;AACtB,SAAO,IAAIC,OAAJ,CAAY,CAACC,OAAD,EAAUC,MAAV,KAAqB;AACtCN,IAAAA,EAAE,CAACO,KAAH,CAASJ,EAAT,EAAcK,GAAD,IAAS;AACpB,UAAIA,GAAJ,EAAS;AACPF,QAAAA,MAAM,CAACE,GAAD,CAAN;AACD,OAFD,MAEO;AACLH,QAAAA,OAAO;AACR;AACF,KAND;AAOD,GARM,CAAP;AASD;;AAED,SAASI,SAAT,CAAmBC,IAAnB,EAAyBC,KAAzB,EAAgCC,IAAI,GAAGC,SAAvC,EAAkD;AAChD,SAAO,IAAIT,OAAJ,CAAY,CAACC,OAAD,EAAUC,MAAV,KAAqB;AACtCN,IAAAA,EAAE,CAACc,IAAH,CAAQJ,IAAR,EAAcC,KAAd,EAAqBC,IAArB,EAA2B,CAACJ,GAAD,EAAML,EAAN,KAAa;AACtC,UAAIK,GAAJ,EAAS;AACPF,QAAAA,MAAM,CAACE,GAAD,CAAN;AACD,OAFD,MAEO;AACLH,QAAAA,OAAO,CAACF,EAAD,CAAP;AACD;AACF,KAND;AAOD,GARM,CAAP;AASD;;AAED,SAASY,SAAT,CAAmB,GAAGC,IAAtB,EAA4B;AAC1B,SAAO,IAAIZ,OAAJ,CAAY,CAACC,OAAD,EAAUC,MAAV,KAAqB;AACtCN,IAAAA,EAAE,CAACiB,IAAH,CAAQ,GAAGD,IAAX,EAAiB,CAACR,GAAD,EAAMU,SAAN,EAAiBC,MAAjB,KAA4B;AAC3C,UAAIX,GAAJ,EAAS;AACPF,QAAAA,MAAM,CAACE,GAAD,CAAN;AACD,OAFD,MAEO;AACLH,QAAAA,OAAO,CAAC;AAAEa,UAAAA,SAAF;AAAaC,UAAAA;AAAb,SAAD,CAAP;AACD;AACF,KAND;AAOD,GARM,CAAP;AASD;;AAED,MAAMC,UAAN,SAAyBnB,UAAzB,CAAoC;AAClCoB,EAAAA,WAAW,CAACX,IAAD,EAAO;AAChB;AACA,SAAKA,IAAL,GAAYA,IAAZ;AACA,SAAKY,WAAL,GAAmBb,SAAS,CAACC,IAAD,EAAO,GAAP,CAA5B;AACD;;AAEe,QAAVa,UAAU,CAACC,KAAD,EAAQ;AACtB;AACA,UAAMrB,EAAE,GAAG,MAAM,KAAKmB,WAAtB;AACA,UAAM;AAAEH,MAAAA;AAAF,QAAa,MAAMJ,SAAS,CAChCZ,EADgC,EAEhCsB,MAAM,CAACC,KAAP,CAAaF,KAAK,CAACG,MAAnB,CAFgC,EAGhC,CAHgC,EAIhCH,KAAK,CAACG,MAJ0B,EAKhCH,KAAK,CAACI,MAL0B,CAAlC;AAOA,WAAOT,MAAM,CAACA,MAAd;AACD;;AAEU,QAALZ,KAAK,GAAG;AACZ,UAAMJ,EAAE,GAAG,MAAM,KAAKmB,WAAtB;AACA,UAAMpB,UAAU,CAACC,EAAD,CAAhB;AACD;;AAvBiC;;AA0BpC,OAAO,SAAS0B,cAAT,CAAwBnB,IAAxB,EAA8B;AACnC,SAAO,IAAIU,UAAJ,CAAeV,IAAf,CAAP;AACD","sourcesContent":["import fs from 'fs';\nimport { BaseSource } from './basesource.js';\n\nfunction closeAsync(fd) {\n  return new Promise((resolve, reject) => {\n    fs.close(fd, (err) => {\n      if (err) {\n        reject(err);\n      } else {\n        resolve();\n      }\n    });\n  });\n}\n\nfunction openAsync(path, flags, mode = undefined) {\n  return new Promise((resolve, reject) => {\n    fs.open(path, flags, mode, (err, fd) => {\n      if (err) {\n        reject(err);\n      } else {\n        resolve(fd);\n      }\n    });\n  });\n}\n\nfunction readAsync(...args) {\n  return new Promise((resolve, reject) => {\n    fs.read(...args, (err, bytesRead, buffer) => {\n      if (err) {\n        reject(err);\n      } else {\n        resolve({ bytesRead, buffer });\n      }\n    });\n  });\n}\n\nclass FileSource extends BaseSource {\n  constructor(path) {\n    super();\n    this.path = path;\n    this.openRequest = openAsync(path, 'r');\n  }\n\n  async fetchSlice(slice) {\n    // TODO: use `signal`\n    const fd = await this.openRequest;\n    const { buffer } = await readAsync(\n      fd,\n      Buffer.alloc(slice.length),\n      0,\n      slice.length,\n      slice.offset,\n    );\n    return buffer.buffer;\n  }\n\n  async close() {\n    const fd = await this.openRequest;\n    await closeAsync(fd);\n  }\n}\n\nexport function makeFileSource(path) {\n  return new FileSource(path);\n}\n"]},"metadata":{},"sourceType":"module"}