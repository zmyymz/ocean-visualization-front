{"ast":null,"code":"import \"core-js/modules/es.regexp.constructor.js\";\nimport \"core-js/modules/es.regexp.dot-all.js\";\nimport \"core-js/modules/es.regexp.exec.js\";\nimport \"core-js/modules/es.regexp.sticky.js\";\nimport \"core-js/modules/es.regexp.to-string.js\";\nimport \"core-js/modules/es.regexp.test.js\";\nimport \"core-js/modules/es.object.to-string.js\";\nimport \"core-js/modules/es.string.split.js\";\nimport \"core-js/modules/es.array.fill.js\";\nimport \"core-js/modules/es.array.map.js\";\n\n/**\n * @module ol/render/canvas/Executor\n */\nimport CanvasInstruction from './Instruction.js';\nimport { TEXT_ALIGN } from './TextBuilder.js';\nimport { WORKER_OFFSCREEN_CANVAS } from '../../has.js';\nimport { apply as applyTransform, compose as composeTransform, create as createTransform, setFromArray as transformSetFromArray } from '../../transform.js';\nimport { createEmpty, createOrUpdate, intersects } from '../../extent.js';\nimport { defaultPadding, defaultTextAlign, defaultTextBaseline, drawImageOrLabel, getTextDimensions, measureAndCacheTextWidth } from '../canvas.js';\nimport { drawTextOnPath } from '../../geom/flat/textpath.js';\nimport { equals } from '../../array.js';\nimport { lineStringLength } from '../../geom/flat/length.js';\nimport { transform2D } from '../../geom/flat/transform.js';\n/**\n * @typedef {Object} BBox\n * @property {number} minX Minimal x.\n * @property {number} minY Minimal y.\n * @property {number} maxX Maximal x.\n * @property {number} maxY Maximal y\n * @property {*} value Value.\n */\n\n/**\n * @typedef {Object} ImageOrLabelDimensions\n * @property {number} drawImageX DrawImageX.\n * @property {number} drawImageY DrawImageY.\n * @property {number} drawImageW DrawImageW.\n * @property {number} drawImageH DrawImageH.\n * @property {number} originX OriginX.\n * @property {number} originY OriginY.\n * @property {Array<number>} scale Scale.\n * @property {BBox} declutterBox DeclutterBox.\n * @property {import(\"../../transform.js\").Transform} canvasTransform CanvasTransform.\n */\n\n/**\n * @typedef {{0: CanvasRenderingContext2D, 1: number, 2: import(\"../canvas.js\").Label|HTMLImageElement|HTMLCanvasElement|HTMLVideoElement, 3: ImageOrLabelDimensions, 4: number, 5: Array<*>, 6: Array<*>}} ReplayImageOrLabelArgs\n */\n\n/**\n * @template T\n * @typedef {function(import(\"../../Feature.js\").FeatureLike, import(\"../../geom/SimpleGeometry.js\").default): T} FeatureCallback\n */\n\n/**\n * @type {import(\"../../extent.js\").Extent}\n */\n\nvar tmpExtent = createEmpty();\n/** @type {import(\"../../coordinate.js\").Coordinate} */\n\nvar p1 = [];\n/** @type {import(\"../../coordinate.js\").Coordinate} */\n\nvar p2 = [];\n/** @type {import(\"../../coordinate.js\").Coordinate} */\n\nvar p3 = [];\n/** @type {import(\"../../coordinate.js\").Coordinate} */\n\nvar p4 = [];\n/**\n * @param {ReplayImageOrLabelArgs} replayImageOrLabelArgs Arguments to replayImageOrLabel\n * @return {BBox} Declutter bbox.\n */\n\nfunction getDeclutterBox(replayImageOrLabelArgs) {\n  return replayImageOrLabelArgs[3].declutterBox;\n}\n\nvar rtlRegEx = new RegExp(\n/* eslint-disable prettier/prettier */\n'[' + String.fromCharCode(0x00591) + '-' + String.fromCharCode(0x008ff) + String.fromCharCode(0x0fb1d) + '-' + String.fromCharCode(0x0fdff) + String.fromCharCode(0x0fe70) + '-' + String.fromCharCode(0x0fefc) + String.fromCharCode(0x10800) + '-' + String.fromCharCode(0x10fff) + String.fromCharCode(0x1e800) + '-' + String.fromCharCode(0x1efff) + ']'\n/* eslint-enable prettier/prettier */\n);\n/**\n * @param {string} text Text.\n * @param {string} align Alignment.\n * @return {number} Text alignment.\n */\n\nfunction horizontalTextAlign(text, align) {\n  if ((align === 'start' || align === 'end') && !rtlRegEx.test(text)) {\n    align = align === 'start' ? 'left' : 'right';\n  }\n\n  return TEXT_ALIGN[align];\n}\n/**\n * @param {Array<string>} acc Accumulator.\n * @param {string} line Line of text.\n * @param {number} i Index\n * @return {Array<string>} Accumulator.\n */\n\n\nfunction createTextChunks(acc, line, i) {\n  if (i > 0) {\n    acc.push('\\n', '');\n  }\n\n  acc.push(line, '');\n  return acc;\n}\n\nvar Executor =\n/** @class */\nfunction () {\n  /**\n   * @param {number} resolution Resolution.\n   * @param {number} pixelRatio Pixel ratio.\n   * @param {boolean} overlaps The replay can have overlapping geometries.\n   * @param {import(\"../canvas.js\").SerializableInstructions} instructions The serializable instructions\n   */\n  function Executor(resolution, pixelRatio, overlaps, instructions) {\n    /**\n     * @protected\n     * @type {boolean}\n     */\n    this.overlaps = overlaps;\n    /**\n     * @protected\n     * @type {number}\n     */\n\n    this.pixelRatio = pixelRatio;\n    /**\n     * @protected\n     * @const\n     * @type {number}\n     */\n\n    this.resolution = resolution;\n    /**\n     * @private\n     * @type {boolean}\n     */\n\n    this.alignFill_;\n    /**\n     * @protected\n     * @type {Array<*>}\n     */\n\n    this.instructions = instructions.instructions;\n    /**\n     * @protected\n     * @type {Array<number>}\n     */\n\n    this.coordinates = instructions.coordinates;\n    /**\n     * @private\n     * @type {!Object<number,import(\"../../coordinate.js\").Coordinate|Array<import(\"../../coordinate.js\").Coordinate>|Array<Array<import(\"../../coordinate.js\").Coordinate>>>}\n     */\n\n    this.coordinateCache_ = {};\n    /**\n     * @private\n     * @type {!import(\"../../transform.js\").Transform}\n     */\n\n    this.renderedTransform_ = createTransform();\n    /**\n     * @protected\n     * @type {Array<*>}\n     */\n\n    this.hitDetectionInstructions = instructions.hitDetectionInstructions;\n    /**\n     * @private\n     * @type {Array<number>}\n     */\n\n    this.pixelCoordinates_ = null;\n    /**\n     * @private\n     * @type {number}\n     */\n\n    this.viewRotation_ = 0;\n    /**\n     * @type {!Object<string, import(\"../canvas.js\").FillState>}\n     */\n\n    this.fillStates = instructions.fillStates || {};\n    /**\n     * @type {!Object<string, import(\"../canvas.js\").StrokeState>}\n     */\n\n    this.strokeStates = instructions.strokeStates || {};\n    /**\n     * @type {!Object<string, import(\"../canvas.js\").TextState>}\n     */\n\n    this.textStates = instructions.textStates || {};\n    /**\n     * @private\n     * @type {Object<string, Object<string, number>>}\n     */\n\n    this.widths_ = {};\n    /**\n     * @private\n     * @type {Object<string, import(\"../canvas.js\").Label>}\n     */\n\n    this.labels_ = {};\n  }\n  /**\n   * @param {string|Array<string>} text Text.\n   * @param {string} textKey Text style key.\n   * @param {string} fillKey Fill style key.\n   * @param {string} strokeKey Stroke style key.\n   * @return {import(\"../canvas.js\").Label} Label.\n   */\n\n\n  Executor.prototype.createLabel = function (text, textKey, fillKey, strokeKey) {\n    var key = text + textKey + fillKey + strokeKey;\n\n    if (this.labels_[key]) {\n      return this.labels_[key];\n    }\n\n    var strokeState = strokeKey ? this.strokeStates[strokeKey] : null;\n    var fillState = fillKey ? this.fillStates[fillKey] : null;\n    var textState = this.textStates[textKey];\n    var pixelRatio = this.pixelRatio;\n    var scale = [textState.scale[0] * pixelRatio, textState.scale[1] * pixelRatio];\n    var textIsArray = Array.isArray(text);\n    var align = horizontalTextAlign(textIsArray ? text[0] : text, textState.textAlign || defaultTextAlign);\n    var strokeWidth = strokeKey && strokeState.lineWidth ? strokeState.lineWidth : 0;\n    var chunks = textIsArray ? text : text.split('\\n').reduce(createTextChunks, []);\n\n    var _a = getTextDimensions(textState, chunks),\n        width = _a.width,\n        height = _a.height,\n        widths = _a.widths,\n        heights = _a.heights,\n        lineWidths = _a.lineWidths;\n\n    var renderWidth = width + strokeWidth;\n    var contextInstructions = []; // make canvas 2 pixels wider to account for italic text width measurement errors\n\n    var w = (renderWidth + 2) * scale[0];\n    var h = (height + strokeWidth) * scale[1];\n    /** @type {import(\"../canvas.js\").Label} */\n\n    var label = {\n      width: w < 0 ? Math.floor(w) : Math.ceil(w),\n      height: h < 0 ? Math.floor(h) : Math.ceil(h),\n      contextInstructions: contextInstructions\n    };\n\n    if (scale[0] != 1 || scale[1] != 1) {\n      contextInstructions.push('scale', scale);\n    }\n\n    if (strokeKey) {\n      contextInstructions.push('strokeStyle', strokeState.strokeStyle);\n      contextInstructions.push('lineWidth', strokeWidth);\n      contextInstructions.push('lineCap', strokeState.lineCap);\n      contextInstructions.push('lineJoin', strokeState.lineJoin);\n      contextInstructions.push('miterLimit', strokeState.miterLimit); // eslint-disable-next-line\n\n      var Context = WORKER_OFFSCREEN_CANVAS ? OffscreenCanvasRenderingContext2D : CanvasRenderingContext2D;\n\n      if (Context.prototype.setLineDash) {\n        contextInstructions.push('setLineDash', [strokeState.lineDash]);\n        contextInstructions.push('lineDashOffset', strokeState.lineDashOffset);\n      }\n    }\n\n    if (fillKey) {\n      contextInstructions.push('fillStyle', fillState.fillStyle);\n    }\n\n    contextInstructions.push('textBaseline', 'middle');\n    contextInstructions.push('textAlign', 'center');\n    var leftRight = 0.5 - align;\n    var x = align * renderWidth + leftRight * strokeWidth;\n    var strokeInstructions = [];\n    var fillInstructions = [];\n    var lineHeight = 0;\n    var lineOffset = 0;\n    var widthHeightIndex = 0;\n    var lineWidthIndex = 0;\n    var previousFont;\n\n    for (var i = 0, ii = chunks.length; i < ii; i += 2) {\n      var text_1 = chunks[i];\n\n      if (text_1 === '\\n') {\n        lineOffset += lineHeight;\n        lineHeight = 0;\n        x = align * renderWidth + leftRight * strokeWidth;\n        ++lineWidthIndex;\n        continue;\n      }\n\n      var font = chunks[i + 1] || textState.font;\n\n      if (font !== previousFont) {\n        if (strokeKey) {\n          strokeInstructions.push('font', font);\n        }\n\n        if (fillKey) {\n          fillInstructions.push('font', font);\n        }\n\n        previousFont = font;\n      }\n\n      lineHeight = Math.max(lineHeight, heights[widthHeightIndex]);\n      var fillStrokeArgs = [text_1, x + leftRight * widths[widthHeightIndex] + align * (widths[widthHeightIndex] - lineWidths[lineWidthIndex]), 0.5 * (strokeWidth + lineHeight) + lineOffset];\n      x += widths[widthHeightIndex];\n\n      if (strokeKey) {\n        strokeInstructions.push('strokeText', fillStrokeArgs);\n      }\n\n      if (fillKey) {\n        fillInstructions.push('fillText', fillStrokeArgs);\n      }\n\n      ++widthHeightIndex;\n    }\n\n    Array.prototype.push.apply(contextInstructions, strokeInstructions);\n    Array.prototype.push.apply(contextInstructions, fillInstructions);\n    this.labels_[key] = label;\n    return label;\n  };\n  /**\n   * @param {CanvasRenderingContext2D} context Context.\n   * @param {import(\"../../coordinate.js\").Coordinate} p1 1st point of the background box.\n   * @param {import(\"../../coordinate.js\").Coordinate} p2 2nd point of the background box.\n   * @param {import(\"../../coordinate.js\").Coordinate} p3 3rd point of the background box.\n   * @param {import(\"../../coordinate.js\").Coordinate} p4 4th point of the background box.\n   * @param {Array<*>} fillInstruction Fill instruction.\n   * @param {Array<*>} strokeInstruction Stroke instruction.\n   */\n\n\n  Executor.prototype.replayTextBackground_ = function (context, p1, p2, p3, p4, fillInstruction, strokeInstruction) {\n    context.beginPath();\n    context.moveTo.apply(context, p1);\n    context.lineTo.apply(context, p2);\n    context.lineTo.apply(context, p3);\n    context.lineTo.apply(context, p4);\n    context.lineTo.apply(context, p1);\n\n    if (fillInstruction) {\n      this.alignFill_ =\n      /** @type {boolean} */\n      fillInstruction[2];\n      this.fill_(context);\n    }\n\n    if (strokeInstruction) {\n      this.setStrokeStyle_(context,\n      /** @type {Array<*>} */\n      strokeInstruction);\n      context.stroke();\n    }\n  };\n  /**\n   * @private\n   * @param {number} sheetWidth Width of the sprite sheet.\n   * @param {number} sheetHeight Height of the sprite sheet.\n   * @param {number} centerX X.\n   * @param {number} centerY Y.\n   * @param {number} width Width.\n   * @param {number} height Height.\n   * @param {number} anchorX Anchor X.\n   * @param {number} anchorY Anchor Y.\n   * @param {number} originX Origin X.\n   * @param {number} originY Origin Y.\n   * @param {number} rotation Rotation.\n   * @param {import(\"../../size.js\").Size} scale Scale.\n   * @param {boolean} snapToPixel Snap to pixel.\n   * @param {Array<number>} padding Padding.\n   * @param {boolean} fillStroke Background fill or stroke.\n   * @param {import(\"../../Feature.js\").FeatureLike} feature Feature.\n   * @return {ImageOrLabelDimensions} Dimensions for positioning and decluttering the image or label.\n   */\n\n\n  Executor.prototype.calculateImageOrLabelDimensions_ = function (sheetWidth, sheetHeight, centerX, centerY, width, height, anchorX, anchorY, originX, originY, rotation, scale, snapToPixel, padding, fillStroke, feature) {\n    anchorX *= scale[0];\n    anchorY *= scale[1];\n    var x = centerX - anchorX;\n    var y = centerY - anchorY;\n    var w = width + originX > sheetWidth ? sheetWidth - originX : width;\n    var h = height + originY > sheetHeight ? sheetHeight - originY : height;\n    var boxW = padding[3] + w * scale[0] + padding[1];\n    var boxH = padding[0] + h * scale[1] + padding[2];\n    var boxX = x - padding[3];\n    var boxY = y - padding[0];\n\n    if (fillStroke || rotation !== 0) {\n      p1[0] = boxX;\n      p4[0] = boxX;\n      p1[1] = boxY;\n      p2[1] = boxY;\n      p2[0] = boxX + boxW;\n      p3[0] = p2[0];\n      p3[1] = boxY + boxH;\n      p4[1] = p3[1];\n    }\n\n    var transform;\n\n    if (rotation !== 0) {\n      transform = composeTransform(createTransform(), centerX, centerY, 1, 1, rotation, -centerX, -centerY);\n      applyTransform(transform, p1);\n      applyTransform(transform, p2);\n      applyTransform(transform, p3);\n      applyTransform(transform, p4);\n      createOrUpdate(Math.min(p1[0], p2[0], p3[0], p4[0]), Math.min(p1[1], p2[1], p3[1], p4[1]), Math.max(p1[0], p2[0], p3[0], p4[0]), Math.max(p1[1], p2[1], p3[1], p4[1]), tmpExtent);\n    } else {\n      createOrUpdate(Math.min(boxX, boxX + boxW), Math.min(boxY, boxY + boxH), Math.max(boxX, boxX + boxW), Math.max(boxY, boxY + boxH), tmpExtent);\n    }\n\n    if (snapToPixel) {\n      x = Math.round(x);\n      y = Math.round(y);\n    }\n\n    return {\n      drawImageX: x,\n      drawImageY: y,\n      drawImageW: w,\n      drawImageH: h,\n      originX: originX,\n      originY: originY,\n      declutterBox: {\n        minX: tmpExtent[0],\n        minY: tmpExtent[1],\n        maxX: tmpExtent[2],\n        maxY: tmpExtent[3],\n        value: feature\n      },\n      canvasTransform: transform,\n      scale: scale\n    };\n  };\n  /**\n   * @private\n   * @param {CanvasRenderingContext2D} context Context.\n   * @param {number} contextScale Scale of the context.\n   * @param {import(\"../canvas.js\").Label|HTMLImageElement|HTMLCanvasElement|HTMLVideoElement} imageOrLabel Image.\n   * @param {ImageOrLabelDimensions} dimensions Dimensions.\n   * @param {number} opacity Opacity.\n   * @param {Array<*>} fillInstruction Fill instruction.\n   * @param {Array<*>} strokeInstruction Stroke instruction.\n   * @return {boolean} The image or label was rendered.\n   */\n\n\n  Executor.prototype.replayImageOrLabel_ = function (context, contextScale, imageOrLabel, dimensions, opacity, fillInstruction, strokeInstruction) {\n    var fillStroke = !!(fillInstruction || strokeInstruction);\n    var box = dimensions.declutterBox;\n    var canvas = context.canvas;\n    var strokePadding = strokeInstruction ? strokeInstruction[2] * dimensions.scale[0] / 2 : 0;\n    var intersects = box.minX - strokePadding <= canvas.width / contextScale && box.maxX + strokePadding >= 0 && box.minY - strokePadding <= canvas.height / contextScale && box.maxY + strokePadding >= 0;\n\n    if (intersects) {\n      if (fillStroke) {\n        this.replayTextBackground_(context, p1, p2, p3, p4,\n        /** @type {Array<*>} */\n        fillInstruction,\n        /** @type {Array<*>} */\n        strokeInstruction);\n      }\n\n      drawImageOrLabel(context, dimensions.canvasTransform, opacity, imageOrLabel, dimensions.originX, dimensions.originY, dimensions.drawImageW, dimensions.drawImageH, dimensions.drawImageX, dimensions.drawImageY, dimensions.scale);\n    }\n\n    return true;\n  };\n  /**\n   * @private\n   * @param {CanvasRenderingContext2D} context Context.\n   */\n\n\n  Executor.prototype.fill_ = function (context) {\n    if (this.alignFill_) {\n      var origin_1 = applyTransform(this.renderedTransform_, [0, 0]);\n      var repeatSize = 512 * this.pixelRatio;\n      context.save();\n      context.translate(origin_1[0] % repeatSize, origin_1[1] % repeatSize);\n      context.rotate(this.viewRotation_);\n    }\n\n    context.fill();\n\n    if (this.alignFill_) {\n      context.restore();\n    }\n  };\n  /**\n   * @private\n   * @param {CanvasRenderingContext2D} context Context.\n   * @param {Array<*>} instruction Instruction.\n   */\n\n\n  Executor.prototype.setStrokeStyle_ = function (context, instruction) {\n    context['strokeStyle'] =\n    /** @type {import(\"../../colorlike.js\").ColorLike} */\n    instruction[1];\n    context.lineWidth =\n    /** @type {number} */\n    instruction[2];\n    context.lineCap =\n    /** @type {CanvasLineCap} */\n    instruction[3];\n    context.lineJoin =\n    /** @type {CanvasLineJoin} */\n    instruction[4];\n    context.miterLimit =\n    /** @type {number} */\n    instruction[5];\n\n    if (context.setLineDash) {\n      context.lineDashOffset =\n      /** @type {number} */\n      instruction[7];\n      context.setLineDash(\n      /** @type {Array<number>} */\n      instruction[6]);\n    }\n  };\n  /**\n   * @private\n   * @param {string|Array<string>} text The text to draw.\n   * @param {string} textKey The key of the text state.\n   * @param {string} strokeKey The key for the stroke state.\n   * @param {string} fillKey The key for the fill state.\n   * @return {{label: import(\"../canvas.js\").Label, anchorX: number, anchorY: number}} The text image and its anchor.\n   */\n\n\n  Executor.prototype.drawLabelWithPointPlacement_ = function (text, textKey, strokeKey, fillKey) {\n    var textState = this.textStates[textKey];\n    var label = this.createLabel(text, textKey, fillKey, strokeKey);\n    var strokeState = this.strokeStates[strokeKey];\n    var pixelRatio = this.pixelRatio;\n    var align = horizontalTextAlign(Array.isArray(text) ? text[0] : text, textState.textAlign || defaultTextAlign);\n    var baseline = TEXT_ALIGN[textState.textBaseline || defaultTextBaseline];\n    var strokeWidth = strokeState && strokeState.lineWidth ? strokeState.lineWidth : 0; // Remove the 2 pixels we added in createLabel() for the anchor\n\n    var width = label.width / pixelRatio - 2 * textState.scale[0];\n    var anchorX = align * width + 2 * (0.5 - align) * strokeWidth;\n    var anchorY = baseline * label.height / pixelRatio + 2 * (0.5 - baseline) * strokeWidth;\n    return {\n      label: label,\n      anchorX: anchorX,\n      anchorY: anchorY\n    };\n  };\n  /**\n   * @private\n   * @param {CanvasRenderingContext2D} context Context.\n   * @param {number} contextScale Scale of the context.\n   * @param {import(\"../../transform.js\").Transform} transform Transform.\n   * @param {Array<*>} instructions Instructions array.\n   * @param {boolean} snapToPixel Snap point symbols and text to integer pixels.\n   * @param {FeatureCallback<T>} [opt_featureCallback] Feature callback.\n   * @param {import(\"../../extent.js\").Extent} [opt_hitExtent] Only check\n   *     features that intersect this extent.\n   * @param {import(\"rbush\").default} [opt_declutterTree] Declutter tree.\n   * @return {T|undefined} Callback result.\n   * @template T\n   */\n\n\n  Executor.prototype.execute_ = function (context, contextScale, transform, instructions, snapToPixel, opt_featureCallback, opt_hitExtent, opt_declutterTree) {\n    /** @type {Array<number>} */\n    var pixelCoordinates;\n\n    if (this.pixelCoordinates_ && equals(transform, this.renderedTransform_)) {\n      pixelCoordinates = this.pixelCoordinates_;\n    } else {\n      if (!this.pixelCoordinates_) {\n        this.pixelCoordinates_ = [];\n      }\n\n      pixelCoordinates = transform2D(this.coordinates, 0, this.coordinates.length, 2, transform, this.pixelCoordinates_);\n      transformSetFromArray(this.renderedTransform_, transform);\n    }\n\n    var i = 0; // instruction index\n\n    var ii = instructions.length; // end of instructions\n\n    var d = 0; // data index\n\n    var dd; // end of per-instruction data\n\n    var anchorX, anchorY, prevX, prevY, roundX, roundY, image, text, textKey, strokeKey, fillKey;\n    var pendingFill = 0;\n    var pendingStroke = 0;\n    var lastFillInstruction = null;\n    var lastStrokeInstruction = null;\n    var coordinateCache = this.coordinateCache_;\n    var viewRotation = this.viewRotation_;\n    var viewRotationFromTransform = Math.round(Math.atan2(-transform[1], transform[0]) * 1e12) / 1e12;\n    var state =\n    /** @type {import(\"../../render.js\").State} */\n    {\n      context: context,\n      pixelRatio: this.pixelRatio,\n      resolution: this.resolution,\n      rotation: viewRotation\n    }; // When the batch size gets too big, performance decreases. 200 is a good\n    // balance between batch size and number of fill/stroke instructions.\n\n    var batchSize = this.instructions != instructions || this.overlaps ? 0 : 200;\n    var\n    /** @type {import(\"../../Feature.js\").FeatureLike} */\n    feature;\n    var x, y, currentGeometry;\n\n    while (i < ii) {\n      var instruction = instructions[i];\n      var type =\n      /** @type {import(\"./Instruction.js\").default} */\n      instruction[0];\n\n      switch (type) {\n        case CanvasInstruction.BEGIN_GEOMETRY:\n          feature =\n          /** @type {import(\"../../Feature.js\").FeatureLike} */\n          instruction[1];\n          currentGeometry = instruction[3];\n\n          if (!feature.getGeometry()) {\n            i =\n            /** @type {number} */\n            instruction[2];\n          } else if (opt_hitExtent !== undefined && !intersects(opt_hitExtent, currentGeometry.getExtent())) {\n            i =\n            /** @type {number} */\n            instruction[2] + 1;\n          } else {\n            ++i;\n          }\n\n          break;\n\n        case CanvasInstruction.BEGIN_PATH:\n          if (pendingFill > batchSize) {\n            this.fill_(context);\n            pendingFill = 0;\n          }\n\n          if (pendingStroke > batchSize) {\n            context.stroke();\n            pendingStroke = 0;\n          }\n\n          if (!pendingFill && !pendingStroke) {\n            context.beginPath();\n            prevX = NaN;\n            prevY = NaN;\n          }\n\n          ++i;\n          break;\n\n        case CanvasInstruction.CIRCLE:\n          d =\n          /** @type {number} */\n          instruction[1];\n          var x1 = pixelCoordinates[d];\n          var y1 = pixelCoordinates[d + 1];\n          var x2 = pixelCoordinates[d + 2];\n          var y2 = pixelCoordinates[d + 3];\n          var dx = x2 - x1;\n          var dy = y2 - y1;\n          var r = Math.sqrt(dx * dx + dy * dy);\n          context.moveTo(x1 + r, y1);\n          context.arc(x1, y1, r, 0, 2 * Math.PI, true);\n          ++i;\n          break;\n\n        case CanvasInstruction.CLOSE_PATH:\n          context.closePath();\n          ++i;\n          break;\n\n        case CanvasInstruction.CUSTOM:\n          d =\n          /** @type {number} */\n          instruction[1];\n          dd = instruction[2];\n          var geometry =\n          /** @type {import(\"../../geom/SimpleGeometry.js\").default} */\n          instruction[3];\n          var renderer = instruction[4];\n          var fn = instruction.length == 6 ? instruction[5] : undefined;\n          state.geometry = geometry;\n          state.feature = feature;\n\n          if (!(i in coordinateCache)) {\n            coordinateCache[i] = [];\n          }\n\n          var coords = coordinateCache[i];\n\n          if (fn) {\n            fn(pixelCoordinates, d, dd, 2, coords);\n          } else {\n            coords[0] = pixelCoordinates[d];\n            coords[1] = pixelCoordinates[d + 1];\n            coords.length = 2;\n          }\n\n          renderer(coords, state);\n          ++i;\n          break;\n\n        case CanvasInstruction.DRAW_IMAGE:\n          d =\n          /** @type {number} */\n          instruction[1];\n          dd =\n          /** @type {number} */\n          instruction[2];\n          image =\n          /** @type {HTMLCanvasElement|HTMLVideoElement|HTMLImageElement} */\n          instruction[3]; // Remaining arguments in DRAW_IMAGE are in alphabetical order\n\n          anchorX =\n          /** @type {number} */\n          instruction[4];\n          anchorY =\n          /** @type {number} */\n          instruction[5];\n          var height =\n          /** @type {number} */\n          instruction[6];\n          var opacity =\n          /** @type {number} */\n          instruction[7];\n          var originX =\n          /** @type {number} */\n          instruction[8];\n          var originY =\n          /** @type {number} */\n          instruction[9];\n          var rotateWithView =\n          /** @type {boolean} */\n          instruction[10];\n          var rotation =\n          /** @type {number} */\n          instruction[11];\n          var scale =\n          /** @type {import(\"../../size.js\").Size} */\n          instruction[12];\n          var width =\n          /** @type {number} */\n          instruction[13];\n          var declutterImageWithText =\n          /** @type {import(\"../canvas.js\").DeclutterImageWithText} */\n          instruction[14];\n\n          if (!image && instruction.length >= 19) {\n            // create label images\n            text =\n            /** @type {string} */\n            instruction[18];\n            textKey =\n            /** @type {string} */\n            instruction[19];\n            strokeKey =\n            /** @type {string} */\n            instruction[20];\n            fillKey =\n            /** @type {string} */\n            instruction[21];\n            var labelWithAnchor = this.drawLabelWithPointPlacement_(text, textKey, strokeKey, fillKey);\n            image = labelWithAnchor.label;\n            instruction[3] = image;\n            var textOffsetX =\n            /** @type {number} */\n            instruction[22];\n            anchorX = (labelWithAnchor.anchorX - textOffsetX) * this.pixelRatio;\n            instruction[4] = anchorX;\n            var textOffsetY =\n            /** @type {number} */\n            instruction[23];\n            anchorY = (labelWithAnchor.anchorY - textOffsetY) * this.pixelRatio;\n            instruction[5] = anchorY;\n            height = image.height;\n            instruction[6] = height;\n            width = image.width;\n            instruction[13] = width;\n          }\n\n          var geometryWidths = void 0;\n\n          if (instruction.length > 24) {\n            geometryWidths =\n            /** @type {number} */\n            instruction[24];\n          }\n\n          var padding = void 0,\n              backgroundFill = void 0,\n              backgroundStroke = void 0;\n\n          if (instruction.length > 16) {\n            padding =\n            /** @type {Array<number>} */\n            instruction[15];\n            backgroundFill =\n            /** @type {boolean} */\n            instruction[16];\n            backgroundStroke =\n            /** @type {boolean} */\n            instruction[17];\n          } else {\n            padding = defaultPadding;\n            backgroundFill = false;\n            backgroundStroke = false;\n          }\n\n          if (rotateWithView && viewRotationFromTransform) {\n            // Canvas is expected to be rotated to reverse view rotation.\n            rotation += viewRotation;\n          } else if (!rotateWithView && !viewRotationFromTransform) {\n            // Canvas is not rotated, images need to be rotated back to be north-up.\n            rotation -= viewRotation;\n          }\n\n          var widthIndex = 0;\n\n          for (; d < dd; d += 2) {\n            if (geometryWidths && geometryWidths[widthIndex++] < width / this.pixelRatio) {\n              continue;\n            }\n\n            var dimensions = this.calculateImageOrLabelDimensions_(image.width, image.height, pixelCoordinates[d], pixelCoordinates[d + 1], width, height, anchorX, anchorY, originX, originY, rotation, scale, snapToPixel, padding, backgroundFill || backgroundStroke, feature);\n            /** @type {ReplayImageOrLabelArgs} */\n\n            var args = [context, contextScale, image, dimensions, opacity, backgroundFill ?\n            /** @type {Array<*>} */\n            lastFillInstruction : null, backgroundStroke ?\n            /** @type {Array<*>} */\n            lastStrokeInstruction : null];\n            var imageArgs = void 0;\n            var imageDeclutterBox = void 0;\n\n            if (opt_declutterTree && declutterImageWithText) {\n              var index = dd - d;\n\n              if (!declutterImageWithText[index]) {\n                // We now have the image for an image+text combination.\n                declutterImageWithText[index] = args; // Don't render anything for now, wait for the text.\n\n                continue;\n              }\n\n              imageArgs = declutterImageWithText[index];\n              delete declutterImageWithText[index];\n              imageDeclutterBox = getDeclutterBox(imageArgs);\n\n              if (opt_declutterTree.collides(imageDeclutterBox)) {\n                continue;\n              }\n            }\n\n            if (opt_declutterTree && opt_declutterTree.collides(dimensions.declutterBox)) {\n              continue;\n            }\n\n            if (imageArgs) {\n              // We now have image and text for an image+text combination.\n              if (opt_declutterTree) {\n                opt_declutterTree.insert(imageDeclutterBox);\n              } // Render the image before we render the text.\n\n\n              this.replayImageOrLabel_.apply(this, imageArgs);\n            }\n\n            if (opt_declutterTree) {\n              opt_declutterTree.insert(dimensions.declutterBox);\n            }\n\n            this.replayImageOrLabel_.apply(this, args);\n          }\n\n          ++i;\n          break;\n\n        case CanvasInstruction.DRAW_CHARS:\n          var begin =\n          /** @type {number} */\n          instruction[1];\n          var end =\n          /** @type {number} */\n          instruction[2];\n          var baseline =\n          /** @type {number} */\n          instruction[3];\n          var overflow =\n          /** @type {number} */\n          instruction[4];\n          fillKey =\n          /** @type {string} */\n          instruction[5];\n          var maxAngle =\n          /** @type {number} */\n          instruction[6];\n          var measurePixelRatio =\n          /** @type {number} */\n          instruction[7];\n          var offsetY =\n          /** @type {number} */\n          instruction[8];\n          strokeKey =\n          /** @type {string} */\n          instruction[9];\n          var strokeWidth =\n          /** @type {number} */\n          instruction[10];\n          text =\n          /** @type {string} */\n          instruction[11];\n          textKey =\n          /** @type {string} */\n          instruction[12];\n          var pixelRatioScale = [\n          /** @type {number} */\n          instruction[13],\n          /** @type {number} */\n          instruction[13]];\n          var textState = this.textStates[textKey];\n          var font = textState.font;\n          var textScale = [textState.scale[0] * measurePixelRatio, textState.scale[1] * measurePixelRatio];\n          var cachedWidths = void 0;\n\n          if (font in this.widths_) {\n            cachedWidths = this.widths_[font];\n          } else {\n            cachedWidths = {};\n            this.widths_[font] = cachedWidths;\n          }\n\n          var pathLength = lineStringLength(pixelCoordinates, begin, end, 2);\n          var textLength = Math.abs(textScale[0]) * measureAndCacheTextWidth(font, text, cachedWidths);\n\n          if (overflow || textLength <= pathLength) {\n            var textAlign = this.textStates[textKey].textAlign;\n            var startM = (pathLength - textLength) * TEXT_ALIGN[textAlign];\n            var parts = drawTextOnPath(pixelCoordinates, begin, end, 2, text, startM, maxAngle, Math.abs(textScale[0]), measureAndCacheTextWidth, font, cachedWidths, viewRotationFromTransform ? 0 : this.viewRotation_);\n\n            drawChars: if (parts) {\n              /** @type {Array<ReplayImageOrLabelArgs>} */\n              var replayImageOrLabelArgs = [];\n              var c = void 0,\n                  cc = void 0,\n                  chars = void 0,\n                  label = void 0,\n                  part = void 0;\n\n              if (strokeKey) {\n                for (c = 0, cc = parts.length; c < cc; ++c) {\n                  part = parts[c]; // x, y, anchorX, rotation, chunk\n\n                  chars =\n                  /** @type {string} */\n                  part[4];\n                  label = this.createLabel(chars, textKey, '', strokeKey);\n                  anchorX =\n                  /** @type {number} */\n                  part[2] + (textScale[0] < 0 ? -strokeWidth : strokeWidth);\n                  anchorY = baseline * label.height + (0.5 - baseline) * 2 * strokeWidth * textScale[1] / textScale[0] - offsetY;\n                  var dimensions = this.calculateImageOrLabelDimensions_(label.width, label.height, part[0], part[1], label.width, label.height, anchorX, anchorY, 0, 0, part[3], pixelRatioScale, false, defaultPadding, false, feature);\n\n                  if (opt_declutterTree && opt_declutterTree.collides(dimensions.declutterBox)) {\n                    break drawChars;\n                  }\n\n                  replayImageOrLabelArgs.push([context, contextScale, label, dimensions, 1, null, null]);\n                }\n              }\n\n              if (fillKey) {\n                for (c = 0, cc = parts.length; c < cc; ++c) {\n                  part = parts[c]; // x, y, anchorX, rotation, chunk\n\n                  chars =\n                  /** @type {string} */\n                  part[4];\n                  label = this.createLabel(chars, textKey, fillKey, '');\n                  anchorX =\n                  /** @type {number} */\n                  part[2];\n                  anchorY = baseline * label.height - offsetY;\n                  var dimensions = this.calculateImageOrLabelDimensions_(label.width, label.height, part[0], part[1], label.width, label.height, anchorX, anchorY, 0, 0, part[3], pixelRatioScale, false, defaultPadding, false, feature);\n\n                  if (opt_declutterTree && opt_declutterTree.collides(dimensions.declutterBox)) {\n                    break drawChars;\n                  }\n\n                  replayImageOrLabelArgs.push([context, contextScale, label, dimensions, 1, null, null]);\n                }\n              }\n\n              if (opt_declutterTree) {\n                opt_declutterTree.load(replayImageOrLabelArgs.map(getDeclutterBox));\n              }\n\n              for (var i_1 = 0, ii_1 = replayImageOrLabelArgs.length; i_1 < ii_1; ++i_1) {\n                this.replayImageOrLabel_.apply(this, replayImageOrLabelArgs[i_1]);\n              }\n            }\n          }\n\n          ++i;\n          break;\n\n        case CanvasInstruction.END_GEOMETRY:\n          if (opt_featureCallback !== undefined) {\n            feature =\n            /** @type {import(\"../../Feature.js\").FeatureLike} */\n            instruction[1];\n            var result = opt_featureCallback(feature, currentGeometry);\n\n            if (result) {\n              return result;\n            }\n          }\n\n          ++i;\n          break;\n\n        case CanvasInstruction.FILL:\n          if (batchSize) {\n            pendingFill++;\n          } else {\n            this.fill_(context);\n          }\n\n          ++i;\n          break;\n\n        case CanvasInstruction.MOVE_TO_LINE_TO:\n          d =\n          /** @type {number} */\n          instruction[1];\n          dd =\n          /** @type {number} */\n          instruction[2];\n          x = pixelCoordinates[d];\n          y = pixelCoordinates[d + 1];\n          roundX = x + 0.5 | 0;\n          roundY = y + 0.5 | 0;\n\n          if (roundX !== prevX || roundY !== prevY) {\n            context.moveTo(x, y);\n            prevX = roundX;\n            prevY = roundY;\n          }\n\n          for (d += 2; d < dd; d += 2) {\n            x = pixelCoordinates[d];\n            y = pixelCoordinates[d + 1];\n            roundX = x + 0.5 | 0;\n            roundY = y + 0.5 | 0;\n\n            if (d == dd - 2 || roundX !== prevX || roundY !== prevY) {\n              context.lineTo(x, y);\n              prevX = roundX;\n              prevY = roundY;\n            }\n          }\n\n          ++i;\n          break;\n\n        case CanvasInstruction.SET_FILL_STYLE:\n          lastFillInstruction = instruction;\n          this.alignFill_ = instruction[2];\n\n          if (pendingFill) {\n            this.fill_(context);\n            pendingFill = 0;\n\n            if (pendingStroke) {\n              context.stroke();\n              pendingStroke = 0;\n            }\n          }\n\n          context.fillStyle =\n          /** @type {import(\"../../colorlike.js\").ColorLike} */\n          instruction[1];\n          ++i;\n          break;\n\n        case CanvasInstruction.SET_STROKE_STYLE:\n          lastStrokeInstruction = instruction;\n\n          if (pendingStroke) {\n            context.stroke();\n            pendingStroke = 0;\n          }\n\n          this.setStrokeStyle_(context,\n          /** @type {Array<*>} */\n          instruction);\n          ++i;\n          break;\n\n        case CanvasInstruction.STROKE:\n          if (batchSize) {\n            pendingStroke++;\n          } else {\n            context.stroke();\n          }\n\n          ++i;\n          break;\n\n        default:\n          ++i; // consume the instruction anyway, to avoid an infinite loop\n\n          break;\n      }\n    }\n\n    if (pendingFill) {\n      this.fill_(context);\n    }\n\n    if (pendingStroke) {\n      context.stroke();\n    }\n\n    return undefined;\n  };\n  /**\n   * @param {CanvasRenderingContext2D} context Context.\n   * @param {number} contextScale Scale of the context.\n   * @param {import(\"../../transform.js\").Transform} transform Transform.\n   * @param {number} viewRotation View rotation.\n   * @param {boolean} snapToPixel Snap point symbols and text to integer pixels.\n   * @param {import(\"rbush\").default} [opt_declutterTree] Declutter tree.\n   */\n\n\n  Executor.prototype.execute = function (context, contextScale, transform, viewRotation, snapToPixel, opt_declutterTree) {\n    this.viewRotation_ = viewRotation;\n    this.execute_(context, contextScale, transform, this.instructions, snapToPixel, undefined, undefined, opt_declutterTree);\n  };\n  /**\n   * @param {CanvasRenderingContext2D} context Context.\n   * @param {import(\"../../transform.js\").Transform} transform Transform.\n   * @param {number} viewRotation View rotation.\n   * @param {FeatureCallback<T>} [opt_featureCallback] Feature callback.\n   * @param {import(\"../../extent.js\").Extent} [opt_hitExtent] Only check\n   *     features that intersect this extent.\n   * @return {T|undefined} Callback result.\n   * @template T\n   */\n\n\n  Executor.prototype.executeHitDetection = function (context, transform, viewRotation, opt_featureCallback, opt_hitExtent) {\n    this.viewRotation_ = viewRotation;\n    return this.execute_(context, 1, transform, this.hitDetectionInstructions, true, opt_featureCallback, opt_hitExtent);\n  };\n\n  return Executor;\n}();\n\nexport default Executor;","map":{"version":3,"mappings":"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","names":["CanvasInstruction","TEXT_ALIGN","WORKER_OFFSCREEN_CANVAS","apply","applyTransform","compose","composeTransform","create","createTransform","setFromArray","transformSetFromArray","createEmpty","createOrUpdate","intersects","defaultPadding","defaultTextAlign","defaultTextBaseline","drawImageOrLabel","getTextDimensions","measureAndCacheTextWidth","drawTextOnPath","equals","lineStringLength","transform2D","tmpExtent","p1","p2","p3","p4","getDeclutterBox","replayImageOrLabelArgs","declutterBox","rtlRegEx","RegExp","String","fromCharCode","horizontalTextAlign","text","align","test","createTextChunks","acc","line","i","push","resolution","pixelRatio","overlaps","instructions","alignFill_","coordinates","coordinateCache_","renderedTransform_","hitDetectionInstructions","pixelCoordinates_","viewRotation_","fillStates","strokeStates","textStates","widths_","labels_","Executor","textKey","fillKey","strokeKey","key","strokeState","fillState","textState","scale","textIsArray","Array","isArray","textAlign","strokeWidth","lineWidth","chunks","split","reduce","width","height","widths","heights","lineWidths","renderWidth","contextInstructions","w","h","label","Math","floor","ceil","strokeStyle","lineCap","lineJoin","miterLimit","Context","OffscreenCanvasRenderingContext2D","CanvasRenderingContext2D","prototype","setLineDash","lineDash","lineDashOffset","fillStyle","leftRight","x","strokeInstructions","fillInstructions","lineHeight","lineOffset","widthHeightIndex","lineWidthIndex","previousFont","ii","length","text_1","font","max","fillStrokeArgs","context","fillInstruction","strokeInstruction","beginPath","moveTo","lineTo","fill_","setStrokeStyle_","stroke","sheetWidth","sheetHeight","centerX","centerY","anchorX","anchorY","originX","originY","rotation","snapToPixel","padding","fillStroke","feature","y","boxW","boxH","boxX","boxY","transform","min","round","drawImageX","drawImageY","drawImageW","drawImageH","minX","minY","maxX","maxY","value","canvasTransform","contextScale","imageOrLabel","dimensions","opacity","box","canvas","strokePadding","replayTextBackground_","origin_1","repeatSize","save","translate","rotate","fill","restore","instruction","createLabel","baseline","textBaseline","opt_featureCallback","opt_hitExtent","opt_declutterTree","pixelCoordinates","d","dd","prevX","prevY","roundX","roundY","image","pendingFill","pendingStroke","lastFillInstruction","lastStrokeInstruction","coordinateCache","viewRotation","viewRotationFromTransform","atan2","state","batchSize","currentGeometry","type","BEGIN_GEOMETRY","getGeometry","undefined","getExtent","BEGIN_PATH","NaN","CIRCLE","x1","y1","x2","y2","dx","dy","r","sqrt","arc","PI","CLOSE_PATH","closePath","CUSTOM","geometry","renderer","fn","coords","DRAW_IMAGE","rotateWithView","declutterImageWithText","labelWithAnchor","drawLabelWithPointPlacement_","textOffsetX","textOffsetY","geometryWidths","backgroundFill","backgroundStroke","widthIndex","calculateImageOrLabelDimensions_","args","imageArgs","imageDeclutterBox","index","collides","insert","replayImageOrLabel_","DRAW_CHARS","begin","end","overflow","maxAngle","measurePixelRatio","offsetY","pixelRatioScale","textScale","cachedWidths","pathLength","textLength","abs","startM","parts","drawChars","c","cc","chars","part","load","map","i_1","ii_1","END_GEOMETRY","result","FILL","MOVE_TO_LINE_TO","SET_FILL_STYLE","SET_STROKE_STYLE","STROKE","execute_"],"sourceRoot":"","sources":["../../src/render/canvas/Executor.js"],"sourcesContent":[null]},"metadata":{},"sourceType":"module"}