{"ast":null,"code":"import { inject, ref, h } from 'vue';\nimport { debounce } from 'lodash-unified';\nimport '../../../../utils/index.mjs';\nimport { getCell, getColumnByCell, createTablePopper } from '../util.mjs';\nimport { TABLE_INJECTION_KEY } from '../tokens.mjs';\nimport { hasClass, getStyle } from '../../../../utils/dom/style.mjs';\n\nfunction useEvents(props) {\n  var parent = inject(TABLE_INJECTION_KEY);\n  var tooltipContent = ref(\"\");\n  var tooltipTrigger = ref(h(\"div\"));\n\n  var handleEvent = function handleEvent(event, row, name) {\n    var _a;\n\n    var table = parent;\n    var cell = getCell(event);\n    var column;\n    var namespace = (_a = table == null ? void 0 : table.vnode.el) == null ? void 0 : _a.dataset.prefix;\n\n    if (cell) {\n      column = getColumnByCell({\n        columns: props.store.states.columns.value\n      }, cell, namespace);\n\n      if (column) {\n        table == null ? void 0 : table.emit(\"cell-\".concat(name), row, column, cell, event);\n      }\n    }\n\n    table == null ? void 0 : table.emit(\"row-\".concat(name), row, column, event);\n  };\n\n  var handleDoubleClick = function handleDoubleClick(event, row) {\n    handleEvent(event, row, \"dblclick\");\n  };\n\n  var handleClick = function handleClick(event, row) {\n    props.store.commit(\"setCurrentRow\", row);\n    handleEvent(event, row, \"click\");\n  };\n\n  var handleContextMenu = function handleContextMenu(event, row) {\n    handleEvent(event, row, \"contextmenu\");\n  };\n\n  var handleMouseEnter = debounce(function (index) {\n    props.store.commit(\"setHoverRow\", index);\n  }, 30);\n  var handleMouseLeave = debounce(function () {\n    props.store.commit(\"setHoverRow\", null);\n  }, 30);\n\n  var handleCellMouseEnter = function handleCellMouseEnter(event, row) {\n    var _a;\n\n    var table = parent;\n    var cell = getCell(event);\n    var namespace = (_a = table == null ? void 0 : table.vnode.el) == null ? void 0 : _a.dataset.prefix;\n\n    if (cell) {\n      var column = getColumnByCell({\n        columns: props.store.states.columns.value\n      }, cell, namespace);\n      var hoverState = table.hoverState = {\n        cell: cell,\n        column: column,\n        row: row\n      };\n      table == null ? void 0 : table.emit(\"cell-mouse-enter\", hoverState.row, hoverState.column, hoverState.cell, event);\n    }\n\n    var cellChild = event.target.querySelector(\".cell\");\n\n    if (!(hasClass(cellChild, \"\".concat(namespace, \"-tooltip\")) && cellChild.childNodes.length)) {\n      return;\n    }\n\n    var range = document.createRange();\n    range.setStart(cellChild, 0);\n    range.setEnd(cellChild, cellChild.childNodes.length);\n    var rangeWidth = range.getBoundingClientRect().width;\n    var padding = (parseInt(getStyle(cellChild, \"paddingLeft\"), 10) || 0) + (parseInt(getStyle(cellChild, \"paddingRight\"), 10) || 0);\n\n    if (rangeWidth + padding > cellChild.offsetWidth || cellChild.scrollWidth > cellChild.offsetWidth) {\n      createTablePopper(cell, cell.innerText || cell.textContent, {\n        placement: \"top\",\n        strategy: \"fixed\"\n      }, row.tooltipEffect);\n    }\n  };\n\n  var handleCellMouseLeave = function handleCellMouseLeave(event) {\n    var cell = getCell(event);\n    if (!cell) return;\n    var oldHoverState = parent == null ? void 0 : parent.hoverState;\n    parent == null ? void 0 : parent.emit(\"cell-mouse-leave\", oldHoverState == null ? void 0 : oldHoverState.row, oldHoverState == null ? void 0 : oldHoverState.column, oldHoverState == null ? void 0 : oldHoverState.cell, event);\n  };\n\n  return {\n    handleDoubleClick: handleDoubleClick,\n    handleClick: handleClick,\n    handleContextMenu: handleContextMenu,\n    handleMouseEnter: handleMouseEnter,\n    handleMouseLeave: handleMouseLeave,\n    handleCellMouseEnter: handleCellMouseEnter,\n    handleCellMouseLeave: handleCellMouseLeave,\n    tooltipContent: tooltipContent,\n    tooltipTrigger: tooltipTrigger\n  };\n}\n\nexport { useEvents as default };","map":{"version":3,"mappings":"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","names":["useEvents","props","parent","inject","TABLE_INJECTION_KEY","tooltipContent","ref","tooltipTrigger","h","handleEvent","event","row","name","_a","table","cell","getCell","column","namespace","vnode","el","dataset","prefix","getColumnByCell","columns","store","states","value","emit","handleDoubleClick","handleClick","commit","handleContextMenu","handleMouseEnter","debounce","index","handleMouseLeave","handleCellMouseEnter","hoverState","cellChild","target","querySelector","hasClass","childNodes","length","range","document","createRange","setStart","setEnd","rangeWidth","getBoundingClientRect","width","padding","parseInt","getStyle","offsetWidth","scrollWidth","createTablePopper","innerText","textContent","placement","strategy","tooltipEffect","handleCellMouseLeave","oldHoverState"],"sources":["../../../../../../../packages/components/table/src/table-body/events-helper.ts"],"sourcesContent":["import { ref, h, inject } from 'vue'\nimport { debounce } from 'lodash-unified'\nimport { getStyle, hasClass } from '@element-plus/utils'\nimport { createTablePopper, getCell, getColumnByCell } from '../util'\nimport { TABLE_INJECTION_KEY } from '../tokens'\nimport type { TableColumnCtx } from '../table-column/defaults'\nimport type { TableBodyProps } from './defaults'\n\nfunction useEvents<T>(props: Partial<TableBodyProps<T>>) {\n  const parent = inject(TABLE_INJECTION_KEY)\n  const tooltipContent = ref('')\n  const tooltipTrigger = ref(h('div'))\n  const handleEvent = (event: Event, row: T, name: string) => {\n    const table = parent\n    const cell = getCell(event)\n    let column: TableColumnCtx<T>\n    const namespace = table?.vnode.el?.dataset.prefix\n    if (cell) {\n      column = getColumnByCell(\n        {\n          columns: props.store.states.columns.value,\n        },\n        cell,\n        namespace\n      )\n      if (column) {\n        table?.emit(`cell-${name}`, row, column, cell, event)\n      }\n    }\n    table?.emit(`row-${name}`, row, column, event)\n  }\n  const handleDoubleClick = (event: Event, row: T) => {\n    handleEvent(event, row, 'dblclick')\n  }\n  const handleClick = (event: Event, row: T) => {\n    props.store.commit('setCurrentRow', row)\n    handleEvent(event, row, 'click')\n  }\n  const handleContextMenu = (event: Event, row: T) => {\n    handleEvent(event, row, 'contextmenu')\n  }\n  const handleMouseEnter = debounce(function (index: number) {\n    props.store.commit('setHoverRow', index)\n  }, 30)\n  const handleMouseLeave = debounce(function () {\n    props.store.commit('setHoverRow', null)\n  }, 30)\n  const handleCellMouseEnter = (\n    event: MouseEvent,\n    row: T & { tooltipEffect: string }\n  ) => {\n    const table = parent\n    const cell = getCell(event)\n    const namespace = table?.vnode.el?.dataset.prefix\n    if (cell) {\n      const column = getColumnByCell(\n        {\n          columns: props.store.states.columns.value,\n        },\n        cell,\n        namespace\n      )\n      const hoverState = (table.hoverState = { cell, column, row })\n      table?.emit(\n        'cell-mouse-enter',\n        hoverState.row,\n        hoverState.column,\n        hoverState.cell,\n        event\n      )\n    }\n\n    // 判断是否text-overflow, 如果是就显示tooltip\n    const cellChild = (event.target as HTMLElement).querySelector(\n      '.cell'\n    ) as HTMLElement\n    if (\n      !(\n        hasClass(cellChild, `${namespace}-tooltip`) &&\n        cellChild.childNodes.length\n      )\n    ) {\n      return\n    }\n    // use range width instead of scrollWidth to determine whether the text is overflowing\n    // to address a potential FireFox bug: https://bugzilla.mozilla.org/show_bug.cgi?id=1074543#c3\n    const range = document.createRange()\n    range.setStart(cellChild, 0)\n    range.setEnd(cellChild, cellChild.childNodes.length)\n    const rangeWidth = range.getBoundingClientRect().width\n    const padding =\n      (parseInt(getStyle(cellChild, 'paddingLeft'), 10) || 0) +\n      (parseInt(getStyle(cellChild, 'paddingRight'), 10) || 0)\n    if (\n      rangeWidth + padding > cellChild.offsetWidth ||\n      cellChild.scrollWidth > cellChild.offsetWidth\n    ) {\n      createTablePopper(\n        cell,\n        cell.innerText || cell.textContent,\n        {\n          placement: 'top',\n          strategy: 'fixed',\n        },\n        row.tooltipEffect\n      )\n    }\n  }\n  const handleCellMouseLeave = (event) => {\n    const cell = getCell(event)\n    if (!cell) return\n\n    const oldHoverState = parent?.hoverState\n    parent?.emit(\n      'cell-mouse-leave',\n      oldHoverState?.row,\n      oldHoverState?.column,\n      oldHoverState?.cell,\n      event\n    )\n  }\n\n  return {\n    handleDoubleClick,\n    handleClick,\n    handleContextMenu,\n    handleMouseEnter,\n    handleMouseLeave,\n    handleCellMouseEnter,\n    handleCellMouseLeave,\n    tooltipContent,\n    tooltipTrigger,\n  }\n}\n\nexport default useEvents\n"]},"metadata":{},"sourceType":"module"}