{"ast":null,"code":"import \"core-js/modules/es.error.cause.js\";\n\nvar __extends = this && this.__extends || function () {\n  var extendStatics = function (d, b) {\n    extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p];\n    };\n\n    return extendStatics(d, b);\n  };\n\n  return function (d, b) {\n    if (typeof b !== \"function\" && b !== null) throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\n    extendStatics(d, b);\n\n    function __() {\n      this.constructor = d;\n    }\n\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\n/**\n * @module ol/renderer/Map\n */\n\n\nimport Disposable from '../Disposable.js';\nimport { TRUE } from '../functions.js';\nimport { abstract } from '../util.js';\nimport { compose as composeTransform, makeInverse } from '../transform.js';\nimport { getWidth } from '../extent.js';\nimport { shared as iconImageCache } from '../style/IconImageCache.js';\nimport { inView } from '../layer/Layer.js';\nimport { wrapX } from '../coordinate.js';\n/**\n * @typedef HitMatch\n * @property {import(\"../Feature.js\").FeatureLike} feature Feature.\n * @property {import(\"../layer/Layer.js\").default} layer Layer.\n * @property {import(\"../geom/SimpleGeometry.js\").default} geometry Geometry.\n * @property {number} distanceSq Squared distance.\n * @property {import(\"./vector.js\").FeatureCallback<T>} callback Callback.\n * @template T\n */\n\n/**\n * @abstract\n */\n\nvar MapRenderer =\n/** @class */\nfunction (_super) {\n  __extends(MapRenderer, _super);\n  /**\n   * @param {import(\"../PluggableMap.js\").default} map Map.\n   */\n\n\n  function MapRenderer(map) {\n    var _this = _super.call(this) || this;\n    /**\n     * @private\n     * @type {import(\"../PluggableMap.js\").default}\n     */\n\n\n    _this.map_ = map;\n    return _this;\n  }\n  /**\n   * @abstract\n   * @param {import(\"../render/EventType.js\").default} type Event type.\n   * @param {import(\"../PluggableMap.js\").FrameState} frameState Frame state.\n   */\n\n\n  MapRenderer.prototype.dispatchRenderEvent = function (type, frameState) {\n    abstract();\n  };\n  /**\n   * @param {import(\"../PluggableMap.js\").FrameState} frameState FrameState.\n   * @protected\n   */\n\n\n  MapRenderer.prototype.calculateMatrices2D = function (frameState) {\n    var viewState = frameState.viewState;\n    var coordinateToPixelTransform = frameState.coordinateToPixelTransform;\n    var pixelToCoordinateTransform = frameState.pixelToCoordinateTransform;\n    composeTransform(coordinateToPixelTransform, frameState.size[0] / 2, frameState.size[1] / 2, 1 / viewState.resolution, -1 / viewState.resolution, -viewState.rotation, -viewState.center[0], -viewState.center[1]);\n    makeInverse(pixelToCoordinateTransform, coordinateToPixelTransform);\n  };\n  /**\n   * @param {import(\"../coordinate.js\").Coordinate} coordinate Coordinate.\n   * @param {import(\"../PluggableMap.js\").FrameState} frameState FrameState.\n   * @param {number} hitTolerance Hit tolerance in pixels.\n   * @param {boolean} checkWrapped Check for wrapped geometries.\n   * @param {import(\"./vector.js\").FeatureCallback<T>} callback Feature callback.\n   * @param {S} thisArg Value to use as `this` when executing `callback`.\n   * @param {function(this: U, import(\"../layer/Layer.js\").default): boolean} layerFilter Layer filter\n   *     function, only layers which are visible and for which this function\n   *     returns `true` will be tested for features.  By default, all visible\n   *     layers will be tested.\n   * @param {U} thisArg2 Value to use as `this` when executing `layerFilter`.\n   * @return {T|undefined} Callback result.\n   * @template S,T,U\n   */\n\n\n  MapRenderer.prototype.forEachFeatureAtCoordinate = function (coordinate, frameState, hitTolerance, checkWrapped, callback, thisArg, layerFilter, thisArg2) {\n    var result;\n    var viewState = frameState.viewState;\n    /**\n     * @param {boolean} managed Managed layer.\n     * @param {import(\"../Feature.js\").FeatureLike} feature Feature.\n     * @param {import(\"../layer/Layer.js\").default} layer Layer.\n     * @param {import(\"../geom/Geometry.js\").default} geometry Geometry.\n     * @return {T|undefined} Callback result.\n     */\n\n    function forEachFeatureAtCoordinate(managed, feature, layer, geometry) {\n      return callback.call(thisArg, feature, managed ? layer : null, geometry);\n    }\n\n    var projection = viewState.projection;\n    var translatedCoordinate = wrapX(coordinate.slice(), projection);\n    var offsets = [[0, 0]];\n\n    if (projection.canWrapX() && checkWrapped) {\n      var projectionExtent = projection.getExtent();\n      var worldWidth = getWidth(projectionExtent);\n      offsets.push([-worldWidth, 0], [worldWidth, 0]);\n    }\n\n    var layerStates = frameState.layerStatesArray;\n    var numLayers = layerStates.length;\n    var matches =\n    /** @type {Array<HitMatch<T>>} */\n    [];\n    var tmpCoord = [];\n\n    for (var i = 0; i < offsets.length; i++) {\n      for (var j = numLayers - 1; j >= 0; --j) {\n        var layerState = layerStates[j];\n        var layer = layerState.layer;\n\n        if (layer.hasRenderer() && inView(layerState, viewState) && layerFilter.call(thisArg2, layer)) {\n          var layerRenderer = layer.getRenderer();\n          var source = layer.getSource();\n\n          if (layerRenderer && source) {\n            var coordinates = source.getWrapX() ? translatedCoordinate : coordinate;\n            var callback_1 = forEachFeatureAtCoordinate.bind(null, layerState.managed);\n            tmpCoord[0] = coordinates[0] + offsets[i][0];\n            tmpCoord[1] = coordinates[1] + offsets[i][1];\n            result = layerRenderer.forEachFeatureAtCoordinate(tmpCoord, frameState, hitTolerance, callback_1, matches);\n          }\n\n          if (result) {\n            return result;\n          }\n        }\n      }\n    }\n\n    if (matches.length === 0) {\n      return undefined;\n    }\n\n    var order = 1 / matches.length;\n    matches.forEach(function (m, i) {\n      return m.distanceSq += i * order;\n    });\n    matches.sort(function (a, b) {\n      return a.distanceSq - b.distanceSq;\n    });\n    matches.some(function (m) {\n      return result = m.callback(m.feature, m.layer, m.geometry);\n    });\n    return result;\n  };\n  /**\n   * @abstract\n   * @param {import(\"../pixel.js\").Pixel} pixel Pixel.\n   * @param {import(\"../PluggableMap.js\").FrameState} frameState FrameState.\n   * @param {number} hitTolerance Hit tolerance in pixels.\n   * @param {function(import(\"../layer/Layer.js\").default<import(\"../source/Source\").default>, (Uint8ClampedArray|Uint8Array)): T} callback Layer\n   *     callback.\n   * @param {function(import(\"../layer/Layer.js\").default<import(\"../source/Source\").default>): boolean} layerFilter Layer filter\n   *     function, only layers which are visible and for which this function\n   *     returns `true` will be tested for features.  By default, all visible\n   *     layers will be tested.\n   * @return {T|undefined} Callback result.\n   * @template T\n   */\n\n\n  MapRenderer.prototype.forEachLayerAtPixel = function (pixel, frameState, hitTolerance, callback, layerFilter) {\n    return abstract();\n  };\n  /**\n   * @param {import(\"../coordinate.js\").Coordinate} coordinate Coordinate.\n   * @param {import(\"../PluggableMap.js\").FrameState} frameState FrameState.\n   * @param {number} hitTolerance Hit tolerance in pixels.\n   * @param {boolean} checkWrapped Check for wrapped geometries.\n   * @param {function(this: U, import(\"../layer/Layer.js\").default): boolean} layerFilter Layer filter\n   *     function, only layers which are visible and for which this function\n   *     returns `true` will be tested for features.  By default, all visible\n   *     layers will be tested.\n   * @param {U} thisArg Value to use as `this` when executing `layerFilter`.\n   * @return {boolean} Is there a feature at the given coordinate?\n   * @template U\n   */\n\n\n  MapRenderer.prototype.hasFeatureAtCoordinate = function (coordinate, frameState, hitTolerance, checkWrapped, layerFilter, thisArg) {\n    var hasFeature = this.forEachFeatureAtCoordinate(coordinate, frameState, hitTolerance, checkWrapped, TRUE, this, layerFilter, thisArg);\n    return hasFeature !== undefined;\n  };\n  /**\n   * @return {import(\"../PluggableMap.js\").default} Map.\n   */\n\n\n  MapRenderer.prototype.getMap = function () {\n    return this.map_;\n  };\n  /**\n   * Render.\n   * @abstract\n   * @param {?import(\"../PluggableMap.js\").FrameState} frameState Frame state.\n   */\n\n\n  MapRenderer.prototype.renderFrame = function (frameState) {\n    abstract();\n  };\n  /**\n   * @param {import(\"../PluggableMap.js\").FrameState} frameState Frame state.\n   * @protected\n   */\n\n\n  MapRenderer.prototype.scheduleExpireIconCache = function (frameState) {\n    if (iconImageCache.canExpireCache()) {\n      frameState.postRenderFunctions.push(expireIconCache);\n    }\n  };\n\n  return MapRenderer;\n}(Disposable);\n/**\n * @param {import(\"../PluggableMap.js\").default} map Map.\n * @param {import(\"../PluggableMap.js\").FrameState} frameState Frame state.\n */\n\n\nfunction expireIconCache(map, frameState) {\n  iconImageCache.expire();\n}\n\nexport default MapRenderer;","map":{"version":3,"mappings":"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","names":["Disposable","TRUE","abstract","compose","composeTransform","makeInverse","getWidth","shared","iconImageCache","inView","wrapX","__extends","map","_super","_this","map_","MapRenderer","type","frameState","viewState","coordinateToPixelTransform","pixelToCoordinateTransform","size","resolution","rotation","center","coordinate","hitTolerance","checkWrapped","callback","thisArg","layerFilter","thisArg2","result","forEachFeatureAtCoordinate","managed","feature","layer","geometry","call","projection","translatedCoordinate","slice","offsets","canWrapX","projectionExtent","getExtent","worldWidth","push","layerStates","layerStatesArray","numLayers","length","matches","tmpCoord","i","j","layerState","hasRenderer","layerRenderer","getRenderer","source","getSource","coordinates","getWrapX","callback_1","bind","undefined","order","forEach","m","distanceSq","sort","a","b","some","pixel","hasFeature","canExpireCache","postRenderFunctions","expireIconCache","expire"],"sourceRoot":"","sources":["../src/renderer/Map.js"],"sourcesContent":[null]},"metadata":{},"sourceType":"module"}